"use strict";var bt=Object.defineProperty;var Ss=Object.getOwnPropertyDescriptor;var As=Object.getOwnPropertyNames;var Ts=Object.prototype.hasOwnProperty;var Bs=(o,e,t)=>e in o?bt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e)=>bt(o,"name",{value:e,configurable:!0});var Ls=(o,e)=>{for(var t in e)bt(o,t,{get:e[t],enumerable:!0})},Hs=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of As(e))!Ts.call(o,s)&&s!==t&&bt(o,s,{get:()=>e[s],enumerable:!(i=Ss(e,s))||i.enumerable});return o};var Rs=o=>Hs(bt({},"__esModule",{value:!0}),o);var F=(o,e,t)=>(Bs(o,typeof e!="symbol"?e+"":e,t),t);var Xn={};Ls(Xn,{AbsLayout:()=>Yt,Application:()=>xe,AutoComplete:()=>ai,AutoLayout:()=>Xt,AutoRecord:()=>ct,BaseButton:()=>lt,BaseComponent:()=>ae,BasicEvent:()=>S,Button:()=>z,CSSParser:()=>nt,Calendar:()=>Mt,Canvas:()=>li,CardView:()=>Be,CheckBox:()=>ke,Clipboard:()=>Nt,Color:()=>V,ColorPicker:()=>dt,ColorPickerBox:()=>He,ColorPickerEditor:()=>ui,ComboBox:()=>Ie,Component:()=>u,ComputedStyle:()=>Ne,Container:()=>O,DataProxy:()=>At,DataStore:()=>Le,DataView:()=>Tt,Dialog:()=>De,EvBtnClick:()=>qi,EvCancel:()=>bs,EvChange:()=>M,EvClick:()=>ne,EvContextMenu:()=>pe,EvDataChange:()=>mt,EvDblClick:()=>ye,EvDrag:()=>Bi,EvError:()=>Li,EvFocus:()=>qt,EvGridCheck:()=>ks,EvLoaded:()=>Dt,EvMessage:()=>zs,EvMove:()=>ji,EvOverlayResize:()=>fs,EvSelectionChange:()=>ie,EvSize:()=>Q,EvTimer:()=>Ti,EvViewChange:()=>St,EventSource:()=>me,FileUpload:()=>Lt,Flex:()=>Ee,Form:()=>ut,GridLayout:()=>Zt,GridView:()=>xi,HLayout:()=>w,HtmlString:()=>K,Icon:()=>L,Image:()=>Re,ImageUpload:()=>fi,Input:()=>j,Label:()=>I,Link:()=>bi,ListView:()=>Pt,Masonry:()=>ei,Md5:()=>Pe,Menu:()=>te,MenuBar:()=>ri,MenuItem:()=>ue,MenuSeparator:()=>si,MenuTitle:()=>ni,MessageBox:()=>Me,NetworkError:()=>Je,Panel:()=>vi,Point:()=>ee,Popup:()=>q,PopupCalendar:()=>ht,PopupListView:()=>Te,PromptDialogBox:()=>$e,PropertyEditor:()=>wi,RadioBtn:()=>ft,Rating:()=>Ei,React:()=>$n,Record:()=>Ge,Rect:()=>X,Router:()=>at,SVGComponent:()=>Fi,SVGGradient:()=>gt,SVGGroup:()=>ze,SVGItem:()=>Se,SVGPath:()=>zt,SVGPathBuilder:()=>Rt,SVGShape:()=>_t,SVGText:()=>Vt,ScrollView:()=>Qt,Separator:()=>rt,Settings:()=>ot,SideBarView:()=>yi,Size:()=>fe,SizerOverlay:()=>_e,Space:()=>Gt,Spreadsheet:()=>pt,Stylesheet:()=>he,TSXComponent:()=>Ai,TabBar:()=>Ii,TabView:()=>Di,TableLayout:()=>Jt,TextArea:()=>Pi,TextEdit:()=>U,Toaster:()=>Mi,ToggleButton:()=>oi,Tooltip:()=>Ue,TreeView:()=>Si,VLayout:()=>H,_date_set_locale:()=>qs,_tr:()=>k,_x4_unitless:()=>$t,addTranslation:()=>zi,ajax:()=>$i,ajaxAsJSON:()=>Dn,ajaxAsText:()=>Pn,ajaxRequest:()=>Gi,asap:()=>ce,bool_formatter:()=>Nn,calcAge:()=>Qs,camelCase:()=>Ks,clamp:()=>it,classNames:()=>Kt,crc32:()=>sn,createLanguage:()=>Hi,data:()=>ws,date_calc_weeknum:()=>Ut,date_clone:()=>et,date_diff:()=>Xs,date_format:()=>Ys,date_formatter:()=>Vn,date_hash:()=>Qe,date_sql_utc:()=>Js,date_to_sql:()=>Zs,deferCall:()=>Ni,downloadData:()=>Oi,dragManager:()=>Sn,drawText:()=>Tn,escapeHtml:()=>Ct,flyWrap:()=>J,formatIntlDate:()=>G,generatePassword:()=>on,getAvailableLanguages:()=>Ns,getCurrentLanguage:()=>Ws,getMousePos:()=>re,html:()=>st,initTooltips:()=>gn,installHMR:()=>an,isArray:()=>$,isFunction:()=>Z,isHtmlString:()=>le,isLanguage:()=>Ri,isLiteralObject:()=>Wi,isNumber:()=>tt,isString:()=>B,isTouchDevice:()=>vt,markdownToHtml:()=>tn,mix:()=>rn,money_formatter:()=>On,money_formatter_nz:()=>Wn,openFileDialog:()=>Hn,pad:()=>we,parseIntlDate:()=>wt,parseIntlFloat:()=>Vi,pascalCase:()=>We,removeHtmlTags:()=>Gs,roundTo:()=>Oe,saveFileDialog:()=>Rn,selectLanguage:()=>cs,setCurrencySymbol:()=>Fs,setupWSMessaging:()=>qn,sprintf:()=>Ze,sql_date_formatter:()=>zn,waitFontLoading:()=>en,x4app:()=>gs,x4js_version:()=>Yn});module.exports=Rs(Xn);var f=document;var os=l(function(){this.propagationStopped=!0},"stopPropagation"),as=l(function(){this.defaultPrevented=!0},"preventDefault");function S(o){return{stopPropagation:os,preventDefault:as,...o}}l(S,"BasicEvent");function ne(o=null){return S({context:o})}l(ne,"EvClick");function M(o,e=null){return S({value:o,context:e})}l(M,"EvChange");function ie(o,e=null){return S({selection:o,context:e})}l(ie,"EvSelectionChange");function pe(o,e=null){return S({uievent:o,context:e})}l(pe,"EvContextMenu");function Ti(o,e=0,t=null){return S({timer:o,time:e,context:t})}l(Ti,"EvTimer");function zs(o,e,t){return S({msg:o,params:e,source:t})}l(zs,"EvMessage");function Bi(o,e,t){return S({element:o,data:e,context:t})}l(Bi,"EvDrag");function Li(o,e){return S({code:o,message:e})}l(Li,"EvError");var me=class{m_source;m_eventRegistry;m_defaultHandlers;constructor(e=null){this.m_source=e??this}emit(e,t){this._emit(e,t)}_emit(e,t){let i=this.m_eventRegistry?.get(e),s=this.m_defaultHandlers?.get(e);if(t||(t={}),t.source||(t.source=this.m_source),t.type||(t.type=e),i&&i.length)if(t.preventDefault||(t.preventDefault=as),t.stopPropagation||(t.stopPropagation=os),i.length==1)i[0](t);else{let n=i.slice();for(let r=0,a=n.length;r<a&&(n[r](t),!t.propagationStopped);r++);}if(s&&s.length&&!t.defaultPrevented)return s[0](t)}signal(e,t,i=-1){this._signal(e,t,i)}_signal(e,t,i=-1){if(!this.m_eventRegistry)return;let s=this.m_eventRegistry.get(e);if(!(!s||!s.length))if(t||(t={}),t.type||(t.type=e),t.source||(t.source=this.m_source),t.preventDefault=t.stopPropagation=()=>{console.error("this event cannot be stopped not default prevented")},s.length==1&&i==-1)s[0](t);else{let n=s.slice(),r=l(()=>{for(let a=0,h=n.length;a<h;a++)n[a](t)},"call");i==-1?r():setTimeout(r,i)}}once(e,t){this._once(e,t)}_once(e,t){let i=l(s=>{this._off(e,i),t(s)},"newCallback");if(this._on(e,i),!t)return new Promise(function(s){t=s})}setDefaultHandler(e,t){let i=this.m_defaultHandlers;i||(i=this.m_defaultHandlers=new Map);let s=i.get(e);if(s){let n=s.indexOf(t);n!=-1&&s.splice(n,1),s.unshift(t)}else i.set(e,[t])}removeDefaultHandler(e,t){let i=this.m_defaultHandlers;if(!i)return;let s=i.get(e);if(s){let n=s.indexOf(t);n!=-1&&s.splice(n,1)}}listen(e){for(let t in e)this._on(t,e[t])}defaults(e){for(let t in e)this.setDefaultHandler(t,e[t])}on(e,t){return this._on(e,t)}_on(e,t,i=!1){this.m_eventRegistry||(this.m_eventRegistry=new Map);let s=this.m_eventRegistry.get(e);return s||(s=[],this.m_eventRegistry.set(e,s)),s.indexOf(t)==-1&&(i?s.unshift(t):s.push(t)),{dispose:()=>{this._off(e,t)}}}off(e,t){return this._off(e,t)}_off(e,t){if(!this.m_eventRegistry)return;let i=this.m_eventRegistry.get(e);if(!i)return;let s=i.indexOf(t);s!==-1&&i.splice(s,1)}removeAllListeners(e){e?(this.m_eventRegistry&&(this.m_eventRegistry[e]=void 0),this.m_defaultHandlers&&(this.m_defaultHandlers[e]=void 0)):this.m_eventRegistry=this.m_defaultHandlers=void 0}};l(me,"EventSource");var ae=class extends me{m_props;#e;constructor(e){super(),this.m_props=e,e.events&&this.listen(e.events)}startTimer(e,t,i=!0,s=null){this.#e?this.stopTimer(e):this.#e=new Map;let n=(i?setInterval:setTimeout)(r=>{s?s(e,r):this.emit("timer",Ti(e,r))},t);this.#e.set(e,()=>{(i?clearInterval:clearTimeout)(n)})}stopTimer(e){let t=this.#e.get(e);t&&t()}disposeTimers(){this.#e?.forEach(e=>e()),this.#e=void 0}singleShot(e,t=0){setTimeout(e,t)}mapPropEvents(e,...t){t.forEach(i=>{let s=i;e[s]&&this._on(s,e[s])})}};l(ae,"BaseComponent");var ls=Symbol("i18n"),Xe={};function Hi(o,e){Xe[o]={name:o,base:e,src_translations:{},translations:{}}}l(Hi,"createLanguage");function Ri(o){return Xe[o]!==void 0}l(Ri,"isLanguage");function zi(o,...e){if(!Ri(o))return;let t=Xe[o];e.forEach(i=>{hs(t.src_translations,i)}),t.translations=ms(t.src_translations,t.base,!0)}l(zi,"addTranslation");function hs(o,e){for(let t in e){let i=e[t];typeof i=="string"?o[t]=i:Array.isArray(i)&&(!o[t]||!Array.isArray(o[t]))?o[t]=[...i]:!o[t]||typeof o[t]!="object"?o[t]={...i}:hs(o[t],e[t])}}l(hs,"_patch");function ms(o,e,t){let i={};for(let s in o)typeof o[s]!="string"&&!Array.isArray(o[s])?i[s]=ms(o[s],e,!1):i[s]=o[s];return Vs(i,e,t)}l(ms,"_proxyfy");function Vs(o,e,t){return new Proxy(o,{get:(i,s)=>{t?Wt=[s]:Wt.push(s);let n=i[s];return n===void 0&&e&&(n=Os(e)),n}})}l(Vs,"_mk_proxy");var Wt;function Os(o){for(;o;){let e=Xe[o],t=e.translations,i;for(let s of Wt){if(i=t[s],i===void 0)break;t=i}if(i!==void 0)return t;o=e.base}console.error("I18N error: unable to find","_tr."+Wt.join("."))}l(Os,"_findBaseTrans");var k={};function cs(o){if(Ri(o))return k=Xe[o].translations,k[ls]=o,k}l(cs,"selectLanguage");function Ws(){return k[ls]}l(Ws,"getCurrentLanguage");function Ns(){return Object.keys(Xe)}l(Ns,"getAvailableLanguages");var js={global:{ok:"OK",cancel:"Annuler",ignore:"Ignorer",yes:"Oui",no:"Non",open:"Ouvrir",new:"Nouveau",delete:"Supprimer",close:"Fermer",save:"Enregistrer",search:"Rechercher",search_tip:"Saisissez le texte \xE0 rechercher. <b>Enter</b> pour lancer la recherche. <b>Esc</b> pour annuler.",required_field:"information requise",invalid_format:"format invalide",invalid_email:"adresse mail invalide",invalid_number:"valeur num\xE9rique invalide",diff_date_seconds:"{0} secondes",diff_date_minutes:"{0} minutes",diff_date_hours:"{0} heures",invalid_date:"Date non reconnue ({0})",empty_list:"Liste vide",date_input_formats:"d/m/y|d.m.y|d m y|d-m-y|dmy",date_format:"D/M/Y",day_short:["dim","lun","mar","mer","jeu","ven","sam"],day_long:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],month_short:["jan","f\xE9v","mar","avr","mai","jun","jui","ao\xFB","sep","oct","nov","d\xE9c"],month_long:["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"],property:"Propri\xE9t\xE9",value:"Valeur",err_403:"Vous n'avez pas les droits suffisants pour effectuer cette action",copy:"Copier",cut:"Couper",paste:"Coller"}},Us={global:{ok:"OK",cancel:"Cancel",ignore:"Ignore",yes:"Yes",no:"No",open:"Open",new:"New",delete:"Delete",close:"Close",save:"Save",search:"Search",search_tip:"Type in the text to search. <b>Enter</b> to start the search. <b>Esc</b> to cancel.",required_field:"missing information",invalid_format:"invalid format",invalid_email:"invalid email address",invalid_number:"bad numeric value",diff_date_seconds:"{0} seconds",diff_date_minutes:"{0} minutes",diff_date_hours:"{0} hours",invalid_date:"Unrecognized date({0})",empty_list:"Empty list",date_input_formats:"m/d/y|m.d.y|m d y|m-d-y|mdy",date_format:"M/D/Y",day_short:["sun","mon","tue","wed","thu","fri","sat"],day_long:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],month_short:["jan","feb","mar","apr","may","jun","jui","aug","sep","oct","nov","dec"],month_long:["january","february","march","april","mau","june","jully","august","september","october","november","december"],property:"Property",value:"Value",err_403:"You do not have sufficient rights to do that action",copy:"Copy",cut:"Cut",paste:"Paste"}};Hi("fr",null);zi("fr",js);Hi("en","fr");zi("en",Us);cs("fr");function vt(){return"ontouchstart"in window}l(vt,"isTouchDevice");function Oe(o,e){let t=Math.pow(10,e),i=Math.round(o*t)/t;return Object.is(i,-0)&&(i=0),i}l(Oe,"roundTo");function Vi(o){return o=o.replace(/\s*/g,""),o=o.replace(",","."),o.length==0?0:parseFloat(o)}l(Vi,"parseIntlFloat");function We(o){let e=o;return e=e.replace(/([a-z])([A-Z])/g,"$1 $2"),e=e.toLowerCase(),e=e.replace(/[^- a-z0-9]+/g," "),e.indexOf(" ")<0?e:(e=e.trim(),e.replace(/ /g,"-"))}l(We,"pascalCase");function Ks(o){let e=o.toLowerCase();return e=e.replace(/[^a-zA-Z0-9]+(.)/g,(t,i)=>i.toUpperCase()),e}l(Ks,"camelCase");var ee=class{x;y;constructor(e=0,t=0){this.x=e,this.y=t}};l(ee,"Point");var fe=class{width;height;constructor(e=0,t=0){this.width=e,this.height=t}};l(fe,"Size");var X=class{left;top;width;height;constructor(e,t,i,s){if(e===void 0)this.left=this.top=this.right=this.bottom=0;else if(e instanceof X||e instanceof DOMRect){let n=e;this.left=n.left,this.top=n.top,this.width=n.width,this.height=n.height}else this.left=e,this.top=t,this.width=i,this.height=s}set(e,t,i,s){this.left=e,this.top=t,this.width=i,this.height=s}get bottom(){return this.top+this.height}set bottom(e){this.height=e-this.top}get right(){return this.left+this.width}set right(e){this.width=e-this.left}get topLeft(){return new ee(this.left,this.top)}get bottomRight(){return new ee(this.right,this.bottom)}get size(){return new fe(this.width,this.height)}moveTo(e,t){return this.left=e,this.top=t,this}movedTo(e,t){return new X(e,t,this.width,this.height)}moveBy(e,t){return this.left+=e,this.top+=t,this}movedBy(e,t){return new X(this.left+e,this.top+t,this.width,this.height)}isEmpty(){return this.width==0&&this.height==0}normalize(){let e=this.width,t=this.height;return e<0&&(this.left+=e,this.width=-e),t<0&&(this.top+=t,this.height=-t),this}normalized(){let e=new X(this),t=e.width,i=e.height;return t<0&&(e.left+=t,e.width=-t),i<0&&(e.top+=i,e.height=-i),e}containsPt(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}contains(e){return e instanceof X?e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom:e.x>=this.left&&e.x<this.right&&e.y>=this.top&&e.y<this.bottom}touches(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)}inflate(e,t){t===void 0&&(t=e),this.left-=e,this.top-=t,this.width+=e+e,this.height+=t+t}inflatedBy(e,t){return t===void 0&&(t=e),new X(this.left-e,this.top-t,this.width+e+e,this.height+t+t)}combine(e){let t=Math.min(this.left,e.left),i=Math.min(this.top,e.top),s=Math.max(this.right,e.right),n=Math.max(this.bottom,e.bottom);this.left=t,this.top=i,this.right=s,this.bottom=n}};l(X,"Rect");function Ze(o,...e){return o.replace(/{(\d+)}/g,function(t,i){return typeof e[i]<"u"?e[i]:t})}l(Ze,"sprintf");function Ct(o,e=!1){if(!o||o.length==0)return"";let t=o.replace(/[<>\&\"\']/g,function(i){return"&#"+i.charCodeAt(0)+";"});return e&&(t=t.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>")),t}l(Ct,"escapeHtml");function Gs(o,e=!1){if(o==null||!B(o)||o.length==0)return"";let t="";for(let i=0;i<o.length;i++){let s=o.codePointAt(i);s>127?t+="&#"+s+";":s==60?t+="&lt;":t+=o.charAt(i)}return t}l(Gs,"removeHtmlTags");var $s="fr-FR";function qs(o){$s=o}l(qs,"_date_set_locale");function Ys(o,e){return G(o)}l(Ys,"date_format");function Xs(o,e,t){var i=(o.getTime()-e.getTime())/1e3;let s=i;if(s<60)return Ze(k.global.diff_date_seconds,Math.round(s));let n=Math.floor(s/60);if(n<60)return Ze(k.global.diff_date_minutes,Math.round(n));let r=Math.floor(n/60);return Ze(k.global.diff_date_hours,r,n%60)}l(Xs,"date_diff");function Zs(o,e){return e?G(o,"Y-M-D H:I:S"):G(o,"Y-M-D")}l(Zs,"date_to_sql");function Js(o){return new Date(o+" GMT")}l(Js,"date_sql_utc");function Qe(o){return o.getFullYear()<<16|o.getMonth()<<8|o.getDate()}l(Qe,"date_hash");Date.prototype.hash=function(){return Qe(this)};function et(o){return new Date(o.getTime())}l(et,"date_clone");function Ut(o){let e=new Date(o.getFullYear(),0,1),t=(o.valueOf()-e.valueOf())/864e5;return Math.floor((t+e.getDay()+1)/7)}l(Ut,"date_calc_weeknum");function wt(o,e=k.global.date_input_formats){let t=e.split("|");for(let i of t){let s="";for(let a of i)a=="d"||a=="D"?s+="(?<day>\\d{1,2})":a=="m"||a=="M"?s+="(?<month>\\d{1,2})":a=="y"||a=="Y"?s+="(?<year>\\d{1,4})":a=="h"||a=="H"?s+="(?<hour>\\d{1,2})":a=="i"||a=="I"?s+="(?<min>\\d{1,2})":a=="s"||a=="S"?s+="(?<sec>\\d{1,2})":a==" "?s+="\\s+":s+="\\s*\\"+a+"\\s*";let r=new RegExp("^"+s+"$","m").exec(o);if(r){let a=new Date,h=parseInt(r.groups.day??"1"),m=parseInt(r.groups.month??"1"),c=parseInt(r.groups.year??a.getFullYear()+""),d=parseInt(r.groups.hour??"0"),p=parseInt(r.groups.min??"0"),g=parseInt(r.groups.sec??"0");c>0&&c<100&&(c+=2e3);let x=new Date(c,m-1,h,d,p,g,0),_=x.getFullYear(),y=x.getMonth()+1,A=x.getDate();return _!=c||y!=m||A!=h?null:x}}return null}l(wt,"parseIntlDate");function G(o,e=k.global.date_format){if(!o)return"";let t={year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate(),wday:o.getDay(),hours:o.getHours(),minutes:o.getMinutes(),seconds:o.getSeconds(),milli:o.getMilliseconds()},i="",s=0;for(let n of e){if(n=="{"){if(++s==1)continue}else if(n=="}"&&--s==0)continue;if(s){i+=n;continue}n=="d"?i+=t.day:n=="D"?i+=we(t.day,-2):n=="j"?i+=k.global.day_short[t.wday]:n=="J"?i+=k.global.day_long[t.wday]:n=="w"?i+=Ut(o):n=="W"?i+=we(Ut(o),-2):n=="m"?i+=t.month:n=="M"?i+=we(t.month,-2):n=="o"?i+=k.global.month_short[t.month-1]:n=="O"?i+=k.global.month_long[t.month-1]:n=="y"||n=="Y"?i+=we(t.year,-4):n=="a"||n=="A"?i+=t.hours<12?"am":"pm":n=="h"?i+=t.hours:n=="H"?i+=we(t.hours,-2):n=="i"?i+=t.minutes:n=="I"?i+=we(t.minutes,-2):n=="s"?i+=t.seconds:n=="S"?i+=we(t.seconds,-2):n=="l"?i+=t.milli:n=="L"?i+=we(t.milli,-3):i+=n}return i}l(G,"formatIntlDate");function Qs(o,e){if(e===void 0&&(e=new Date),!o)return 0;let t=e.getFullYear()-o.getFullYear();return(e.getMonth()<o.getMonth()||e.getMonth()==o.getMonth()&&e.getDate()<o.getDate())&&t--,t}l(Qs,"calcAge");Date.prototype.isSameDay=function(o){return this.getDate()==o.getDate()&&this.getMonth()==o.getMonth()&&this.getFullYear()==o.getFullYear()};Date.prototype.hash=function(){return Qe(this)};Date.prototype.clone=function(){return et(this)};Date.prototype.weekNum=function(){return Ut(this)};Date.prototype.format=function(o){return G(this,o)};Date.prototype.addDays=function(o){return this.setDate(this.getDate()+o),this};function Oi(o,e,t){let i=new Blob([o],{type:e}),s=window.URL.createObjectURL(i),n=f.createElement("a");n.style.display="none",n.href=s,n.download=t,f.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s)}l(Oi,"downloadData");function B(o){return typeof o=="string"}l(B,"isString");function $(o){return o instanceof Array}l($,"isArray");function Z(o){return o instanceof Function}l(Z,"isFunction");function Wi(o){return!!o&&o.constructor===Object}l(Wi,"isLiteralObject");function we(o,e,t="0"){let i;return B(o)?i=o:i=""+o,e>0?i.padEnd(e,t):i.padStart(-e,t)}l(we,"pad");function tt(o){return typeof o=="number"&&isFinite(o)}l(tt,"isNumber");function en(o){let e=f.createElement("div");return e.style.position="absolute",e.style.fontFamily=o,e.style.fontSize="44px",e.style.opacity="0.001",e.innerText="X",f.body.appendChild(e),new Promise(t=>{let i=e.getBoundingClientRect(),s=setInterval(()=>{e.getBoundingClientRect().height!=i.height&&(clearInterval(s),f.body.removeChild(e),t())},0)})}l(en,"waitFontLoading");function Ni(o,e=0,...t){setTimeout(o,e,...t)}l(Ni,"deferCall");function ce(o){requestAnimationFrame(o)}l(ce,"asap");function tn(o){if(!o)return"";let e=o.split(`
`),t="para",i="p",s=[];return e.forEach(n=>{let r=n.trim();if(t=="para"){if(r[0]=="-")r=r.substr(1),s.push("<ul>"),t="list",i="li";else if(r[0]==">")r=r.substr(1),s.push("<blockquote>"),t="quote",i="p";else if(r[0]=="#"){let m=0;do r=r.substr(1),m++;while(r[0]=="#"&&m<5);i="h"+m,t="title"}}else t=="list"?r[0]!="-"?(s.push("</ul>"),t="para",i="p"):r=r.substr(1):t=="quote"&&(r[0]!=">"?(s.push("</blockquote>"),t="para",i="p"):r=r.substr(1));let a=/\*\*([^*]+)\*\*/gi;r=Ct(r,!1),r=r.replace(a,(m,...c)=>"<b>"+m.substr(2,m.length-4)+"</b>");let h=/\*([^*]+)\*/gi;r=r.replace(h,(m,...c)=>"<i>"+m.substr(1,m.length-2)+"</i>"),r==""&&(r="&nbsp;"),s.push(`<${i}>`+r+`</${i}>`),t=="title"&&(t="para",i="p")}),t=="list"?s.push("</ul>"):t=="quote"&&s.push("</blockquote>"),s.join("")}l(tn,"markdownToHtml");var Je=class extends Error{m_code;constructor(e,t){e instanceof Response?(super(e.statusText),this.m_code=e.status):(super(t),this.m_code=e)}get code(){return this.m_code}};l(Je,"NetworkError");function re(o,e){let t="offsetX",i="offsetY";if(e&&(t="clientX",i="clientY"),o.type=="mousemove"||o.type=="mousedown"||o.type=="mouseup"){let s=o;return new ee(s[t],s[i])}else if(o.type=="pointermove"||o.type=="pointerdown"||o.type=="pointerup"){let s=o;return new ee(s[t],s[i])}else if(o.type=="touchmove"||o.type=="touchstart"){let s=o;return new ee(s.touches[0][t],s.touches[0][i])}else if(o.type=="contextmenu"){let s=o;return new ee(s[t],s[i])}else return new ee(0,0)}l(re,"getMousePos");function it(o,e,t){return Math.min(Math.max(o,e),t)}l(it,"clamp");var K=class extends String{constructor(e){super(e)}static from(e){return new K(e)}};l(K,"HtmlString");function st(o,...e){return K.from(String.raw(o,...e))}l(st,"html");function le(o){return o instanceof K}l(le,"isHtmlString");var Nt=class{static copy(e){navigator.clipboard&&navigator.clipboard.writeText(JSON.stringify(e))}static paste(e){navigator.clipboard?navigator.clipboard.readText().then(t=>e(t)):console.error("no clipboard, are you in https ?")}};l(Nt,"Clipboard");function sn(o){let e=-1,t=Buffer.from(o),i=0,s=t.length;for(;i<s;)e=e>>>8^nn[(e^t[i])&255],i++;return(e^-1)>>>0}l(sn,"crc32");var nn=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),rn=l(o=>new jt(o),"mix"),jt=class{superclass;constructor(e){this.superclass=e}with(...e){return e.reduce((t,i)=>i(t),this.superclass)}};l(jt,"MixinBuilder");function Kt(...o){let e="";for(let t of o)if(typeof t=="string")e+=" "+t;else if(t)for(let i in t)t[i]&&(e+=" "+i);return e}l(Kt,"classNames");function on(o,e){(!o||o==null)&&(o=8),e||(e=[{chars:"abcdefghijklmnopqrstuvwxyz",min:3},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",min:2},{chars:"0123456789",min:2},{chars:"!@#$*|%+-_.;",min:2}]);let t="",i=0;e.forEach(function(n){t+=n.chars,i+=n.min}),o<i&&(o=i),e.push({chars:t,min:o-i});let s="";return e.forEach(function(n){n.min>0&&(s+=us(n.chars,n.min))}),us(s)}l(on,"generatePassword");function us(o,e){let t=o.split("").sort(()=>.5-Math.random()).join("");return e>0&&(t=t.substr(0,e)),t}l(us,"shuffle");function an(o="127.0.0.1",e="9876",t){let i;function s(){document.body.style.visibility="hidden";let h=[].slice.call(document.getElementsByTagName("link")),m=document.getElementsByTagName("head")[0];for(let c=0;c<h.length;++c){let d=h[c];m.removeChild(d);let p=d.rel;if(d.href&&typeof p!="string"||p.length==0||p.toLowerCase()=="stylesheet"){let g=d.href.replace(/(&|\?)_cacheOverride=\d+/,"");d.href=g+(g.indexOf("?")>=0?"&":"?")+"_cacheOverride="+new Date().valueOf()}m.appendChild(d)}i&&clearTimeout(i),i=setTimeout(()=>{document.body.style.visibility="unset"},50)}l(s,"refreshCSS");let r=`${window.location.protocol==="https:"?"wss://":"ws://"}${o}:${e}/ws`,a=new WebSocket(r);a.onmessage=function(h){h.data=="reload"?t?t():window.location.reload():h.data=="refreshcss"&&s()},console.log("Live reload enabled.")}l(an,"installHMR");var Et=class{m_sheet;m_rules=new Map;constructor(){function e(t){for(let i=0;i<f.styleSheets.length;i++){let s=f.styleSheets[i];if(s.title===t)return s}}if(l(e,"getStyleSheet"),this.m_sheet=e("@dynamic-css"),!this.m_sheet){let t=f.createElement("style");t.setAttribute("id","@dynamic-css"),f.head.appendChild(t),this.m_sheet=t.sheet}}setRule(e,t){if(B(t)){let i=this.m_rules.get(e);i!==void 0?this.m_sheet.deleteRule(i):i=this.m_sheet.cssRules.length,this.m_rules.set(e,this.m_sheet.insertRule(t,i))}else{let i=1;for(let s in t){let n=s+" { ",r=t[s];for(let a in r){let h=r[a];for(let m=0;m<h.length;m++)n+=a+": "+h[m]+"; "}n+="}",this.setRule(e+"--"+i,n),i++}}}static getVar(e){return Et.doc_style||(Et.doc_style=getComputedStyle(f.documentElement)),e[0]!="-"&&(e="--"+e),Et.doc_style.getPropertyValue(e)}},he=Et;l(he,"Stylesheet"),F(he,"guid",1),F(he,"doc_style");var nt=class{result={};parse(e){return this.result={},this.parse_json("",e),nt.mk_string(this.result)}static mk_string(e){let t="";for(let i in e){let s=e[i];t+=i+" { ";for(let n in s){let r=s[n];for(let a=0;a<r.length;a++)t+=n+": "+r[a]+"; "}t+=`}
`}return t}parse_json(e,t){e&&!this.result[e]&&(this.result[e]={});for(let i in t){let s=t[i];if($(s)){let n=s;for(let r=0;r<n.length;r++)this.addProperty(e,i,n[r])}else switch(typeof s){case"number":{this.addProperty(e,i,s);break}case"string":{this.addProperty(e,i,s);break}case"object":{this.parse_json(this.makeSelectorName(e,i),s);break}default:{console.error("ignoring unknown type "+typeof s+" in property "+i);break}}}}makePropertyName(e){return We(e)}makeSelectorName(e,t){let i=[],s=t.split(/\s*,\s*/),n=e.split(/\s*,\s*/);for(let r=0;r<n.length;r++){let a=n[r];for(let h=0;h<s.length;h++){let m=s[h],c=!1;m.charAt(0)=="&"&&(m=m.substr(1),c=!0),m.charAt(0)==="%"&&(m=".o-"+m.substr(1)),c?i.push(a+m):i.push(a?a+" "+m:m)}}return i.join(", ")}addProperty(e,t,i){let s=t.split(/\s*,\s*/);for(let n=0;n<s.length;n++){let r=this.makePropertyName(s[n]);this.result[e][r]?this.result[e][r].push(i):this.result[e][r]=[i];let h={"box-shadow":["-moz-box-shadow","-webkit-box-shadow"],"border-radius":["-moz-border-radius","-webkit-border-radius"],"border-radius-topleft":["-moz-border-radius-topleft","-webkit-border-top-left-radius"],"border-radius-topright":["-moz-border-radius-topright","-webkit-border-top-right-radius"],"border-radius-bottomleft":["-moz-border-radius-bottomleft","-webkit-border-bottom-left-radius"],"border-radius-bottomright":["-moz-border-radius-bottomright","-webkit-border-bottom-right-radius"]}[r];for(let m=0;h&&m<h.length;m++)this.addProperty(e,h[m],i)}}};l(nt,"CSSParser");var Ne=class{m_style;constructor(e){this.m_style=e}value(e){return e=We(e),this.m_style[e]}parse(e){return e=We(e),parseInt(this.m_style[e])}get style(){return this.m_style}};l(Ne,"ComputedStyle");var ln="x-",je=Symbol(),ge=Symbol(),$t={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ds={mouseleave:1,mouseenter:1,load:1,unload:1,scroll:1,focus:1,blur:1,rowexit:1,beforeunload:1,stop:1,dragdrop:1,dragenter:1,dragexit:1,draggesture:1,dragover:1,contextmenu:1,create:2,sizechange:2},hn={touchstart:1,touchmove:1,touchend:1},mn=/^-?\d+(\.\d+)?$/;function ye(o=null){return S({context:o})}l(ye,"EvDblClick");function qt(o=!0,e=null){return S({focus:o,context:e})}l(qt,"EvFocus");var v=class extends ae{m_dom;m_iprops;constructor(e=null){super(e??{}),this.m_iprops={classes:{},dom_events:{},uid:v.__comp_guid++,inrender:!1,created:!1},this.m_props.cls&&this.addClass(this.m_props.cls)}get uid(){return this.m_iprops.uid}setContent(e,t=!1){this.m_props.content=e??[],!(this.m_iprops.inrender||!this.m_dom)&&(t?this.update():this._updateContent())}getContent(){return this.m_props.content}appendChild(e){if(!e)return;let t=l(i=>{this.m_props.content?$(this.m_props.content)||(this.m_props.content=[this.m_props.content]):this.m_props.content=[],this.m_props.content.push(i),this.m_dom&&this._appendChild(i)},"append");$(e)?e.forEach(t):t(e)}removeChild(e){this.m_props.content&&($(this.m_props.content)||(this.m_props.content=[this.m_props.content]),this.m_props.content=this.m_props.content.filter(t=>t!==e)),this.dom&&e.dom&&this.dom.removeChild(e.dom)}setTag(e,t){this.m_props.tag=e,t&&(this.m_props.ns=t)}getData(e){if(this.m_props.data!==void 0)return this.m_props.data[e.toString()]}setData(e,t){let i=this.m_props.data;i===void 0&&(i=this.m_props.data={}),i[e.toString()]=t}get dom(){return this.m_dom}show(e){e===void 0||e===!0?this.removeClass("@hidden"):this.addClass("@hidden")}hide(){this.addClass("@hidden")}enable(e){e===void 0||e===!0?(this.removeClass("@disable"),this.removeAttribute("disabled")):this.disable()}disable(){this.addClass("@disable"),this.setAttribute("disabled","")}focus(){console.assert(!!this.m_dom),this.m_dom.focus()}setStyle(e){for(let t in e)this.setStyleValue(t,e[t])}setStyleValue(e,t){let i=this.m_props.style;i||(i=this.m_props.style={}),i[e]=t,this._setDomStyleValue(e,t)}_setDomStyleValue(e,t){this.m_dom&&(t===void 0?t=null:!$t[e]&&(tt(t)||mn.test(t))&&(t=t+"px"),this.m_dom.style[e]=t)}getComputedStyle(e){return this.dom?new Ne(getComputedStyle(this.dom,e??null)):new Ne(this.m_props.style)}getStyleValue(e){return this.getComputedStyle()[e]}setAttributes(e){for(let t in e)this.setAttribute(t,e[t])}setAttribute(e,t){if(t===!1||t===void 0)this.removeAttribute(e);else{t===!0?t="":tt(t)&&(t=""+t);let i=this.m_props.attrs;i||(i=this.m_props.attrs={}),i[e]=t,this._setDomAttribute(e,t)}}_setDomAttribute(e,t){this.m_dom&&this.m_dom.setAttribute(e,t)}removeAttribute(e){let t=this.m_props.attrs;t&&(delete t[e],this.m_dom&&this.m_dom.removeAttribute(e))}getAttribute(e){return this.m_dom?this.m_dom.getAttribute(e):e=="id"?this.m_props.id:this.m_props.attrs?this.m_props.attrs[e]:void 0}hasAttribute(e){return this.m_dom?this.m_dom.hasAttribute(e):this.m_props.attrs.hasOwnProperty(e)}addClass(e){if(e==null||(e=e.trim(),e===""))return;let t=l(s=>{s==null||s===""||(s=this._makeCls(s),i[s]=!0,this.m_dom&&this.m_dom.classList.add(s))},"add"),i=this.m_iprops.classes;e.indexOf(" ")<0?t(e):e.split(" ").forEach(n=>t(n))}removeClass(e){if(e===void 0)return;let t=l(i=>{i==null||i===""||(i=this._makeCls(i),delete this.m_iprops.classes[i],this.m_dom&&this.m_dom.classList.remove(i))},"remove");if(e.indexOf(" ")<0)t(e);else{let i=e.trim().split(" ");for(let s of i)s!=null&&s!==""&&t(s)}}setClass(e,t){return t?this.addClass(e):this.removeClass(e),this}toggleClass(e){let t=l(i=>{i===void 0&&i===null&&i===""||(i=this._makeCls(i),this.m_iprops.classes[i]?delete this.m_iprops.classes[i]:this.m_iprops.classes[i]=!0,this.m_dom&&this.m_dom.classList.toggle(i))},"toggle");if(e.indexOf(" ")<0)t(e);else{let i=e.trim().split(" ");for(let s of i)t(s)}}hasClass(e){let t=this._makeCls(e);return this.m_dom?this.dom.classList.contains(t):!!this.m_iprops.classes[t]}clearClasses(){if(this.m_iprops.classes={},this.m_dom)return this.m_dom.classList.value=""}_build(){return this.m_dom?this.m_dom:(this._createDOM(),this.m_dom)}render(e){}_createDOM(){if(this.m_dom)return this.m_dom;let e=this.m_props;if(e.tabIndex!==void 0&&this._setTabIndex(e.tabIndex),this.render(e),e.left!==void 0&&this.setStyleValue("left",e.left),e.top!==void 0&&this.setStyleValue("top",e.top),e.width!==void 0&&this.setStyleValue("width",e.width),e.height!==void 0&&this.setStyleValue("height",e.height),e.flex!==void 0&&(this.addClass("@flex"),e.flex!=1&&this.setStyleValue("flex",e.flex)),e.enabled===!1&&this.disable(),e.tooltip!==void 0&&this.setAttribute("tip",e.tooltip.replace(/\n/gi,"<br/>")),e.dom_events)for(let a in e.dom_events)this._setDomEvent(a,e.dom_events[a]);this._genClassName(),this.m_props.cls=void 0;let t=this.m_iprops;e.ns?this.m_dom=f.createElementNS(e.ns,e.tag??"div"):this.m_dom=f.createElement(e.tag??"div"),this.m_dom[ge]=this,this.m_dom.classList.add(...Object.keys(t.classes));let i=e.style;if(i)for(let a in i)this._setDomStyleValue(a,i[a]);let s=e.attrs;if(s)for(let a in s){let h=s[a];h!==!1&&h!==void 0&&this._setDomAttribute(a,s[a])}this.m_props.id&&this._setDomAttribute("id",this.m_props.id);let n=this.m_iprops.dom_events;if(n)for(let a in n){let h=n[a];for(let m of h)this._createEvent(a,m.listener,m.passive)}let r=e.content;return r&&($(r)||(r=[r]),r.forEach(a=>{a&&(B(a)?this.m_dom.insertAdjacentText("beforeend",a):le(a)?this.m_dom.insertAdjacentHTML("beforeend",a):a instanceof v?this.m_dom.append(a._build()):console.log("unknown element type: ",a))})),v.__createObserver||(v.__createObserver=new MutationObserver(v._observeCreation),v.__createObserver.observe(f.body,{childList:!0,subtree:!0})),this.m_dom}_setTabIndex(e,t=0){e===!0?e=0:e===void 0&&(e=t),e!==!1&&e!==void 0&&this.setAttribute("tabindex",e),this.m_props.tabIndex=e}static _observeCreation(e){let t=l(i=>{i.m_iprops.created||(i.dom&&i.m_iprops.dom_events&&i.m_iprops.dom_events.create&&i.dom.dispatchEvent(new Event("create")),i.componentCreated(),i.m_iprops.created=!0)},"notify");for(let i of e)if(i.type=="childList")for(let s=0,n=i.addedNodes.length;s<n;s++){let a=i.addedNodes[s][ge];a&&(a.enumChilds(h=>{t(h)},!0),t(a))}}dispose(){this.m_dom&&this._dispose(!0,!0)}_dispose(e,t){let i=this.m_dom;delete i[ge],delete i[je],e&&i.remove(),this.enumChilds(s=>{s._dispose(!1,!0)}),this.m_dom=null,t&&this.disposeTimers(),this.componentDisposed(),this.m_iprops.created=!1}componentDisposed(){}componentCreated(){}update(e=0){if(this.m_dom){let t=l(()=>{let i=this.m_dom;this._dispose(!1,!1);let s=this._build();console.assert(!!i.parentNode,"update in componentCreated is not allowed, use updateContent"),i.parentNode.replaceChild(s,i)},"_update");e?this.singleShot(t,e):t()}}_empty(){let e=this.m_dom;if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}_updateContent(){if(!this.m_dom)return;this._empty();let e=this.m_props.content;e&&($(e)||(e=[e]),e.forEach(t=>{t&&(le(t)?this.m_dom.insertAdjacentHTML("beforeend",t):t instanceof v?this.m_dom.append(t._build()):this.m_dom.insertAdjacentText("beforeend",t+""))}))}getBoundingRect(e=!1){console.assert(this.dom!=null,"cannot get bounding rect of an non DOM element");let t=this.dom.getBoundingClientRect(),i=new X(t.left,t.top,t.width,t.height);if(e){let s=this.getComputedStyle(),n=s.parse("marginTop"),r=s.parse("marginBottom"),a=s.parse("marginLeft"),h=s.parse("marginRight");i.left-=a,i.width+=a+h,i.top-=n,i.height+=n+r}return i}setDomEvent(e,t,i){let s=t;this._setDomEvent(e,s,i)}_setDomEvent(e,t,i){this.m_iprops.dom_events||(this.m_iprops.dom_events={});let s=this.m_iprops.dom_events[e];s?s.push({listener:t,passive:i}):s=this.m_iprops.dom_events[e]=[{listener:t,passive:i}],this.m_dom&&this._createEvent(e,t,i)}clearDomEvent(e){if(!this.m_iprops.dom_events)return;delete this.m_iprops.dom_events[e];let t=this.m_dom;if(t){let i=t[je];i&&delete i[e]}}_createEvent(e,t,i){let s=this.m_dom,n=s[je];n||(n=s[je]={}),n[e]?n[e].push(t):n[e]=[t],ds[e]===1?s["on"+e]=v._dispatchUnbubbleEvent:v.__privateEvents[e]||(v.__privateEvents[e]=!0,i===void 0?hn[e]?f.addEventListener(e,v._dispatchEvent,{passive:!1,capture:!0}):f.addEventListener(e,v._dispatchEvent,!0):f.addEventListener(e,v._dispatchEvent,{passive:i,capture:!!i})),e==="sizechange"&&(v.__sizeObserver||(v.__sizeObserver=new ResizeObserver(v._observeSize)),v.__sizeObserver.observe(this.m_dom))}static _dispatchEvent(e){let t=e.target,i=ds[e.type]===2;for(;t;){if(t[je]){let s=t[je][e.type];if(s){let n=t[ge],r=n?.root??null;if(s instanceof Array?s.some(a=>{if(a(e,r),!n.dom)return!0}):s(e,r),e.cancelBubble||e.defaultPrevented||i)break}}if(t=t.parentNode,t==document)break}}static _dispatchUnbubbleEvent(e){let t=e.currentTarget||e.target,i=e.type,s=t[je],n=s&&s[i];if(n){let a=t[ge]?.root??null;n instanceof Array?n.forEach(h=>{h(e,a)}):n(e,a)}}static _observeSize(e){e.forEach(t=>{let i=t.target;i.offsetParent!==null&&i.dispatchEvent(new Event("sizechange"))})}enumChilds(e,t=!1){if(this.m_dom){let i=this.m_dom.firstChild;for(;i;){let s=i[ge];if(s&&(e(s),t&&s.enumChilds(e,!0)===!0))return!0;i=i.nextSibling}}else{let i=this.m_props.content;if(!i)return;$(i)||(i=[i]),i.some(s=>{if(!(!s||B(s)||le(s))&&(e(s)||t&&s.enumChilds(e,!0)===!0))return!0})}return!1}_appendChild(e){if(B(e))this.m_dom.insertAdjacentText("beforeend",e);else if(le(e))this.m_dom.insertAdjacentHTML("beforeend",e);else{let t=e;try{t._build(),this.m_dom.appendChild(t.m_dom)}catch(i){console.error(i)}}}_genClassName(){this.addClass("@comp");let e=Object.getPrototypeOf(this);for(;e&&e.constructor!==v;){let t=e.constructor.name;this.addClass("@"+We(t)),e=Object.getPrototypeOf(e)}}_makeCls(e){return e[0]=="@"?e=ln+e.substring(1):e}static dispatchCaptures(e){v.__capture.handler(e)}static setCapture(e,t){if(console.assert(!v.__capture),v.__capture)debugger;let i=f.querySelectorAll("iframe");i.forEach(a=>{J(a).setStyleValue("pointer-events","none")});let s=f.querySelectorAll(":hover"),n=null;if(s.length){let a=s[s.length-1];n=window.getComputedStyle(a).cursor}v.__capture_mask=f.createElement("div");let r=J(v.__capture_mask);r.addClass("@capture-mask"),n&&r.setStyleValue("cursor",n),f.body.appendChild(r.dom),f.addEventListener("mousedown",v.dispatchCaptures),f.addEventListener("mousemove",v.dispatchCaptures),f.addEventListener("mouseup",v.dispatchCaptures),f.addEventListener("touchstart",v.dispatchCaptures),f.addEventListener("touchmove",v.dispatchCaptures),f.addEventListener("touchend",v.dispatchCaptures),v.__capture={initiator:e,handler:t,iframes:i}}static releaseCapture(){console.assert(!!v.__capture),f.removeEventListener("touchstart",v.dispatchCaptures),f.removeEventListener("touchmove",v.dispatchCaptures),f.removeEventListener("touchend",v.dispatchCaptures),f.removeEventListener("mousedown",v.dispatchCaptures),f.removeEventListener("mousemove",v.dispatchCaptures),f.removeEventListener("mouseup",v.dispatchCaptures),v.__capture.iframes.forEach(e=>{J(e).setStyleValue("pointer-events",null)}),v.__capture=null,v.__capture_mask&&(f.body.removeChild(v.__capture_mask),v.__capture_mask=null)}scrollIntoView(e){if(this.m_dom){let t=new X(this.dom.getBoundingClientRect()),i,s,n,r,a=this.dom.parentElement,h=f.body;for(;a&&a!=h;){let m=a.getBoundingClientRect();(i===void 0||i<m.top)&&(i=m.top),(s===void 0||s>m.bottom)&&(s=m.bottom),(n===void 0||n<m.left)&&(n=m.left),(r===void 0||r>m.right)&&(r=m.right),a=a.parentElement}(i===void 0||t.top<i||t.bottom>s||t.left<n||t.right>r)&&this.m_dom.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"})}}queryItem(e){let t=this.dom.querySelector(e);return t?v.getElement(t):null}queryAll(e,t){let i=Array.from(this.m_dom.querySelectorAll(e));return t&&i.forEach(s=>{t(J(s))}),i}itemWithId(e){let t=this.dom.querySelector("#"+e);return t?v.getElement(t):null}itemWithRef(e){let t=null;return this.enumChilds(i=>{if(i.m_props.ref===e)return t=i,!0},!0),t}get ref(){return this.m_props.ref}static getCss(){return v.__css||(v.__css=new he),v.__css}getParent(){console.assert(!!this.m_dom);let e=this.dom.parentNode;return v.getElement(e)}static getElement(e,t){if(t){let i=B(t);for(;e;){let s=e[ge];if(i){if(s&&s.hasClass(t))return s}else if(s instanceof t)return s;e=e.parentElement}return null}else return e?e[ge]:null}static getScrollbarSize(){if(v.__sb_width===void 0){let e=f.createElement("div");e.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px";let t=f.createElement("div");t.style.width="200px",t.style.height="200px",e.appendChild(t),f.body.appendChild(e),v.__sb_width=e.offsetWidth-e.clientWidth,f.body.removeChild(e)}return v.__sb_width}isUserVisible(){return this.m_dom?this.m_dom.offsetParent!==null:!1}},u=v;l(u,"Component"),F(u,"__sb_width"),F(u,"__comp_guid",1e3),F(u,"__privateEvents",{}),F(u,"__sizeObserver"),F(u,"__createObserver"),F(u,"__capture",null),F(u,"__capture_mask",null),F(u,"__css",null);var ps=null;function J(o){if(o[ge])return o[ge];let e=ps;return e||(e=ps=new u({})),e.m_dom=o,e}l(J,"flyWrap");var Ee=class extends u{constructor(e={}){e.flex||(e.flex=1),super(e)}};l(Ee,"Flex");var Gt=class extends u{m_size;constructor(e){super({}),this.m_size=e}componentCreated(){let e=this.dom,t=null;for(;e;){let i=e[ge];if(i.hasClass("@hlayout")){t={width:this.m_size};break}else if(i.hasClass("@vlayout")){t={height:this.m_size};break}e=e.parentElement}t||(t={width:this.m_size,height:this.m_size}),this.setStyle(t)}};l(Gt,"Space");function Q(o,e=null,t=null){return S({size:o,mode:e,context:t})}l(Q,"EvSize");var rt=class extends u{m_irect;m_delta;m_target;constructor(e){super(e),this.setDomEvent("mousedown",t=>this._mousedown(t)),this.setDomEvent("touchstart",t=>this._mousedown(t)),this.setDomEvent("dblclick",t=>this._collapse(t))}render(){this.addClass(this.m_props.orientation)}_collapse(e){this.m_props.collapsible&&(this._findTarget(),this.m_target&&this.m_target.toggleClass("@collapsed"))}_mousedown(e){if(e.type=="touchstart"){let t=e;t.touches.length==1&&this._startMoving(t.touches[0].pageX,t.touches[0].pageY,e)}else{let t=e;this._startMoving(t.pageX,t.pageY,e)}}_startMoving(e,t,i){this._findTarget(),this.m_target&&(this.m_props.orientation=="horizontal"?this.m_props.sizing=="before"?this.m_delta=e-this.m_irect.right:this.m_delta=e-this.m_irect.left:this.m_props.sizing=="before"?this.m_delta=t-this.m_irect.bottom:this.m_delta=t-this.m_irect.top,i.preventDefault(),i.stopPropagation(),this.m_target.addClass("sizing"),u.setCapture(this,s=>this._pointerMoved(s)))}_pointerMoved(e){let t=l((i,s)=>{if(this.m_props.orientation=="horizontal"){let n;if(this.m_props.sizing=="after"?n=this.m_irect.right-(i-this.m_delta):n=i-this.m_delta-this.m_irect.left,n>0){let r=new fe(n,0);this.emit("resize",Q(r)),this.m_target.setStyleValue("width",r.width),this.m_target.setStyleValue("flex",null),this.m_target.removeClass("@flex")}}else{let n;if(this.m_props.sizing=="after"?n=this.m_irect.bottom-(s-this.m_delta):n=s-this.m_delta-this.m_irect.top,n>0){let r=new fe(0,n);this.emit("resize",Q(r)),this.m_target.setStyleValue("height",r.height),this.m_target.setStyleValue("flex",null),this.m_target.removeClass("@flex")}}},"__move");if(e.type=="mousemove"){let i=e;t(i.pageX,i.pageY),e.preventDefault(),e.stopPropagation()}else if(e.type=="touchmove"){let i=e;t(i.touches[0].pageX,i.touches[0].pageY),e.preventDefault(),e.stopPropagation()}else(e.type=="mouseup"||e.type=="touchend")&&(this.m_target.removeClass("sizing"),u.releaseCapture(),e.preventDefault(),e.stopPropagation())}_findTarget(){if(!this.m_target)if(this.m_props.sizing=="before"){let e=this.dom.previousElementSibling,t=e?u.getElement(e):null;this.m_target=t}else{let e=this.dom.nextElementSibling,t=e?u.getElement(e):null;this.m_target=t}this.m_target?this.m_irect=this.m_target.getBoundingRect():this.m_irect=null}};l(rt,"Separator");function fs(o,e,t=null){return S({ui_event:o,sens:e,context:t})}l(fs,"EvOverlayResize");var _e=class extends u{m_delta;m_irect;constructor(e){super(e),this.addClass(e.sens),this.setDomEvent("mousedown",t=>this._mousedown(t)),this.setDomEvent("touchstart",t=>this._mousedown(t)),this.setDomEvent("dblclick",t=>this.resetflex(t)),e.target.appendChild(this),e.resize&&this.on("resize",this.m_props.resize)}resetflex(e){this.m_props.target.addClass("@flex"),this.emit("resize",Q({width:-1,height:0})),e.preventDefault(),e.stopPropagation()}_mousedown(e){e.preventDefault(),e.stopPropagation();let t=fs(e,this.m_props.sens);if(this.emit("rawresize",t),t.defaultPrevented)return;let i=re(e,!0);this.m_irect=this.m_props.target.getBoundingRect(),this.m_props.sens=="right"?this.m_delta=i.x-this.m_irect.right:this.m_props.sens=="left"?this.m_delta=i.x-this.m_irect.left:this.m_props.sens=="bottom"?this.m_delta=i.y-this.m_irect.bottom:this.m_props.sens=="top"&&(this.m_delta=i.y-this.m_irect.top),this.m_props.target.addClass("sizing"),u.setCapture(this,s=>this._handle_mouse(s))}_is_horz(){return this.m_props.sens=="left"||this.m_props.sens=="right"}get sens(){return this.m_props.sens}_handle_mouse(e){let t=l((i,s)=>{if(this._is_horz()){let n;if(this.m_props.sens=="left"?n=this.m_irect.right-(i-this.m_delta):n=i-this.m_delta-this.m_irect.left,n>0){let r={width:n,height:void 0};this.emit("resize",Q(r)),this.m_props.target.setStyleValue("width",r.width),this.m_props.target.setStyleValue("flex",null),this.m_props.target.removeClass("@flex")}}else{let n;if(this.m_props.sens=="top"?n=this.m_irect.bottom-(s-this.m_delta):n=s-this.m_delta-this.m_irect.top,n>0){let r=new fe(0,n);this.emit("resize",Q(r)),this.m_props.target.setStyleValue("height",r.height),this.m_props.target.setStyleValue("flex",null),this.m_props.target.removeClass("@flex")}}},"__move");if(e.type=="mousemove"){let i=e;t(i.pageX,i.pageY),e.preventDefault(),e.stopPropagation()}else if(e.type=="touchmove"){let i=e;t(i.touches[0].pageX,i.touches[0].pageY),e.preventDefault(),e.stopPropagation()}else(e.type=="mouseup"||e.type=="touchend")&&(this.m_props.target.removeClass("sizing"),u.releaseCapture(),e.preventDefault(),e.stopPropagation())}};l(_e,"SizerOverlay");function cn(o){return S({name:o})}l(cn,"EvShortcut");var O=class extends u{m_shortcuts;constructor(e,t){$(e)?super({content:e,cls:t}):super(e)}addShortcut(e,t,i=null,s=!1){this.m_shortcuts||(this.m_shortcuts=[],this.setDomEvent("keydown",n=>this._handleKeydown(n))),$(e)||(e=[e]),e.forEach(n=>{let r="";n.match(/SHIFT/i)&&(n=n.replace(/SHIFT/i,""),r+="shift+"),n.match(/CTRL/i)&&(n=n.replace(/CTRL/i,""),r+="ctrl+"),n.match(/CMD/i)&&(n=n.replace(/CMD/i,""),r+="cmd+"),n.match(/ALT/i)&&(n=n.replace(/ALT/i,""),r+="alt+"),r+=n.replace("+","").toLowerCase(),this.m_shortcuts.push({sequence:r,name:t,immediate:s,callback:i})})}removeShortcuts(){this.m_shortcuts&&(this.m_shortcuts=[])}_handleKeydown(e){if(!this.m_shortcuts)return;let t="";e.shiftKey&&(t+="shift+"),e.ctrlKey&&(t+="ctrl+"),e.metaKey&&(t+="cmd+"),e.altKey&&(t+="alt+"),t+=e.key.toLowerCase(),this.m_shortcuts.some(i=>{if(i.sequence==t)return i.callback?i.immediate?i.callback(e):ce(()=>{i.callback(e)}):this.emit("shortcut",cn(i.name)),e.preventDefault(),e.stopPropagation(),!0})}};l(O,"Container");var ot=class{m_data;m_name;constructor(e){this.m_data=null,this.m_name=e??"settings"}set(e,t){this._load(),this.m_data[e]=t,this._save()}get(e,t){return this._load(),this.m_data[e]??t}_save(){let e=JSON.stringify(this.m_data);localStorage.setItem(this.m_name,e)}_load(){if(this.m_data)return;this.m_data={};let e=localStorage.getItem(this.m_name);e!==null&&(e=JSON.parse(e),e?this.m_data=e:console.info("There was an error attempting to read your settings."))}};l(ot,"Settings");function un(o,e=!1){if(o instanceof RegExp)return{keys:null,pattern:o};let t=o.split("/"),i=[],s="";t[0]==""&&t.shift();for(let n of t){let r=n[0];if(r==="*")i.push("wild"),s+="/(.*)";else if(r===":"){let a=n.indexOf("?",1),h=n.indexOf(".",1);i.push(n.substring(1,a>=0?a:h>=0?h:n.length)),s+=a>=0&&h<0?"(?:/([^/]+?))?":"/([^/]+?)",h>=0&&(s+=(a>=0?"?":"")+"\\"+n.substring(h))}else s+="/"+n}return{keys:i,pattern:new RegExp(`^${s}${e?"(?=$|/)":"/?$"}`,"i")}}l(un,"parseRoute");var at=class extends me{m_routes;m_useHash;constructor(e=!0){super(),this.m_routes=[],this.m_useHash=e,window.addEventListener("popstate",t=>{let i=this._getLocation(),s=this._find(i);s.handlers.forEach(n=>{n(s.params,i)})})}get(e,t){let{keys:i,pattern:s}=un(e);this.m_routes.push({keys:i,pattern:s,handler:t})}init(){this.navigate(this._getLocation())}_getLocation(){return this.m_useHash?"/"+f.location.hash.substring(1):f.location.pathname}navigate(e,t=!0,i=!1){e.startsWith("/")||(e="/"+e);let s=this._find(e);if(!s||s.handlers.length==0){console.log("route not found: "+e),this.signal("error",Li(404,"route not found"));return}if(this.m_useHash){for(;e.at(0)=="/";)e=e.substring(1);e="#"+e}i?window.history.replaceState({},"",e):window.history.pushState({},"",e),t&&s.handlers.forEach(n=>{n(s.params,e)})}_find(e){let t=[],i={},s=[];for(let n of this.m_routes)if(n.keys)if(n.keys.length>0){if(t=n.pattern.exec(e),t===null)continue;for(let r=0;r<n.keys.length;)i[n.keys[r]]=t[++r];s=[...s,n.handler]}else n.pattern.test(e)&&(s=[...s,n.handler]);else{if(t=n.pattern.exec(e),!t)continue;if(t.groups)for(let r in t.groups)i[r]=t.groups[r];s=[...s,n.handler]}return{params:i,handlers:s}}};l(at,"Router");var jr=Symbol(),yt=class extends ae{static instance(){return yt.self}m_mainView;m_app_name;m_app_version;m_app_uid;m_local_storage;m_user_data;m_touch_time;m_touch_count;m_router;constructor(e){console.assert(yt.self===null,"application is a singleton"),super(e),this.m_app_name=e.app_name??"application",this.m_app_version=e.app_version??"1.0",this.m_app_uid=e.app_uid??"application";let t=`${this.m_app_name}.${this.m_app_version}.settings`;this.m_local_storage=new ot(t),this.m_user_data={},this.m_touch_time=0,this.m_touch_count=0,this.m_router=null,gs=yt.self=this,"onload"in globalThis?globalThis.addEventListener("load",()=>{this.ApplicationCreated()}):this.ApplicationCreated()}ApplicationCreated(){this.setTitle("")}get router(){return this.m_router||(this.m_router=new at),this.m_router}get app_name(){return this.m_app_name}get app_uid(){return this.m_app_uid}get app_version(){return this.m_app_version}get local_storage(){return this.m_local_storage}get user_data(){return this.m_user_data}get history(){debugger;return null}setMainView(e,t){let i=this.m_props.renderTo??f.body,s=J(i);this.m_props.renderTo||s.setStyleValue("position","absolute"),s.addClass("x4-root-element"),t&&s._empty(),this.m_mainView=e,e.setStyleValue("position","absolute"),e._build(),i.appendChild(e.dom)}set mainView(e){this.setMainView(e,!1)}get mainView(){return this.m_mainView}setTitle(e){f.title=this.m_app_name+(e?" > "+e:"")}disableZoomWheel(){window.addEventListener("wheel",function(e){e.ctrlKey&&e.preventDefault()},{passive:!1,capture:!0})}enterModal(e){}enableTouchDblClick(){f.addEventListener("touchstart",e=>{let t=Date.now();if(t-this.m_touch_time>700?this.m_touch_count=1:this.m_touch_count++,this.m_touch_time=t,this.m_touch_count==2){this.m_touch_count=0;let i=e.touches[0],s={type:"dblclick"};for(let n in i)s[n]=i[n];u._dispatchEvent(s),e.stopPropagation()}})}},xe=yt;l(xe,"Application"),F(xe,"self",null);var gs;var Yt=class extends O{};l(Yt,"AbsLayout");var w=class extends O{};l(w,"HLayout");var H=class extends O{};l(H,"VLayout");var Xt=class extends O{constructor(e){super(e),this.setDomEvent("sizechange",()=>this._updateLayout())}componentCreated(){super.componentCreated(),this._updateLayout()}_updateLayout(){let e=this.m_props.defaultLayout=="horizontal";if(this.m_props.switchSize<=0&&window.screen.height>window.screen.width)e=!e;else{let t=this.getBoundingRect();(e&&t.width<this.m_props.switchSize||!e&&t.height<this.m_props.switchSize)&&(e=!e)}e?(this.removeClass("@vlayout"),this.addClass("@hlayout")):(this.addClass("@vlayout"),this.removeClass("@hlayout"))}};l(Xt,"AutoLayout");var Zt=class extends O{constructor(e){super(e)}render(){this.m_props.colSizes&&this.setStyleValue("grid-template-columns",this.m_props.colSizes),this.m_props.rowSizes&&this.setStyleValue("grid-template-rows",this.m_props.rowSizes),this.m_props.colGap&&this.setStyleValue("grid-gap",this.m_props.colGap),this.m_props.template&&this.setStyleValue("grid-template-areas",this.m_props.template.join(`
`))}};l(Zt,"GridLayout");var Jt=class extends O{m_cells;constructor(e){super(e),this.setTag("table"),this.m_cells=new Map}_getCell(e,t,i=!0){let s=Ft(e,t);return this.m_cells.get(s)??(i?{item:void 0}:null)}_setCell(e,t,i,s=!1){let n=Ft(e,t);this.m_cells.set(n,i),this.dom&&i.item&&s&&(i.item instanceof u?i.item.update():this.enumChilds(r=>{if(r.getData("row")==e&&r.getData("col")==t)return r.setContent(i.item),r.update(),!0}))}setCell(e,t,i){let s=this._getCell(e,t);s.item=i,this._setCell(e,t,s,!0)}setCellData(e,t,i){let s=this._getCell(e,t);s.data=i,this._setCell(e,t,s,!0)}getCellData(e,t){return this._getCell(e,t,!1)?.data}merge(e,t,i,s){let n=this._getCell(e,t);n.rowSpan=i,n.colSpan=s,this._setCell(e,t,n)}setCellWidth(e,t,i){let s=this._getCell(e,t);s.width=i,this._setCell(e,t,s)}setCellHeight(e,t,i){let s=this._getCell(e,t);s.height=i,this._setCell(e,t,s)}setCellClass(e,t,i){let s=this._getCell(e,t);s.cls=i,this._setCell(e,t,s)}setColClass(e,t){let i=this._getCell(-1,e);i.cls=t,this._setCell(-1,e,i)}setRowClass(e,t){let i=this._getCell(e,999);i.cls=t,this._setCell(e,999,i)}getCell(e,t){return this._getCell(e,t)?.item}render(){let e=[],t=[];for(let i=0;i<this.m_props.rows;i++){let s=[];for(let a=0;a<this.m_props.columns;a++){let h=Ft(i,a);if(t.indexOf(h)>=0)continue;let m=this.m_cells.get(h),c=this.m_cells.get(Ft(-1,a)),d="";m&&m.cls&&(d=m.cls),c&&c.cls&&(d+=" "+c.cls);let p=new u({tag:"td",content:m?.item,width:m?.width,height:m?.height,data:{row:i,col:a},cls:d});if(m){let g=m.rowSpan??0,x=m.colSpan??0;if(g>0&&p.setAttribute("rowspan",g+1),x>0&&p.setAttribute("colspan",x+1),g||x)for(let _=0;_<=g;_++)for(let y=0;y<=x;y++)t.push(Ft(_+i,y+a))}s.push(p)}let n=this._getCell(i,999,!1),r=new u({tag:"tr",data:{row:i},content:s,cls:n?.cls});e.push(r)}this.setContent(e)}};l(Jt,"TableLayout");function Ft(o,e){return o*1e3+e}l(Ft,"_mkid");var Qt=class extends u{constructor(e){super(e),this.setContent(e.content)}setContent(e){if(!e)super.setContent(null);else{let t;$(e)?t=new H({content:e}):t=e,t.addClass("@scroll-container"),super.setContent(t)}}};l(Qt,"ScrollView");var ei=class extends O{constructor(e){let t=e.items;e.items=void 0,super(e),this.setDomEvent("sizechange",()=>{this.resizeAllItems()}),t&&t.forEach(i=>{this.addItem(i)})}resizeItem(e){let t=this.getComputedStyle(),i=t.parse("grid-auto-rows"),s=t.parse("grid-row-gap"),n=e.queryItem(".content");if(n||(n=e),n&&i+s){let r=n.getBoundingRect(),a=Math.ceil((r.height+s)/(i+s));e.setStyleValue("gridRowEnd","span "+a)}}resizeAllItems(){this.queryAll(".item",e=>{this.resizeItem(e)})}addItem(e){e.addClass("content"),this.appendChild(new O({cls:"item",content:e}))}};l(ei,"Masonry");function ji(o){return S({pos:o})}l(ji,"EvMove");var kt=class extends O{m_ui_mask;m_hasMask=!0;constructor(e){super(e),this.addClass("@hidden")}enableMask(e=!0){this.m_hasMask=e}show(e){if(e!==void 0?this.m_hasMask=!!e:e=this.m_hasMask,this.m_hasMask){let t=f.activeElement;for(t&&t.blur(),this.m_ui_mask=f.body.lastChild;this.m_ui_mask;){if(this.m_ui_mask.nodeType==1){let i=J(this.m_ui_mask);if(!(i.hasClass("@menu")||i.hasClass("@non-maskable"))){if(!(i.getStyleValue("display")=="none"||!i.isUserVisible())){if(i.hasClass("@comp"))break}}}this.m_ui_mask=this.m_ui_mask.previousSibling}this.m_ui_mask&&J(this.m_ui_mask).addClass("@mask")}if(e&&xe.instance().enterModal(!0),this.setStyle({left:0,top:0}),f.body.appendChild(this._build()),this.removeClass("@hidden"),this.centerOnScreen(),e){let t=f.activeElement;if(!this.dom.contains(t)){let i=this.queryItem("[autofocus]");if(i)i.focus();else{let s=this.queryAll("[tabindex]");s&&(s=s.filter(n=>n.offsetParent!==null),s.length&&s[0].focus())}}kt.modal_stack.push(this.dom)}}centerOnScreen(){let e=this.getBoundingRect(),t=`max( 0px, 50vw - ${e.width/2}px )`,i=`max( 0px, 50vh - ${e.height/2}px )`;this.setStyleValue("left",t),this.setStyleValue("top",i)}displayAt(e,t,i="top left",s,n=!1){this.show(n);let r="l",a="t";i.indexOf("right")>=0&&(r="r"),i.indexOf("bottom")>=0&&(a="b");let h=f.body.getBoundingClientRect(),m=this.getBoundingRect();r=="r"&&(e-=m.width),a=="b"&&(t-=m.height),s&&(e+=s.x,t+=s.y),e<4&&(e=4),e+m.width>h.right-4&&(e=h.right-4-m.width,s?.x<0&&(e+=s.x)),t<4&&(t=4),t+m.height>h.bottom-4&&(t=h.bottom-4-m.height,s?.y<0&&(t+=s.y)),this.setStyle({left:e,top:t})}close(){this.hide(),this.m_hasMask&&this.m_ui_mask&&(J(this.m_ui_mask).removeClass("@mask"),xe.instance().enterModal(!1));let e=kt.modal_stack.indexOf(this.dom);e>=0&&kt.modal_stack.splice(e),this.dispose()}componentCreated(){if(this.m_props.sizable){this.addClass("@size-all");let e=["top","right","bottom","left","topleft","topright","bottomleft","bottomright"];for(let t of e)new _e({target:this,sens:t,events:{rawresize:i=>this._mouseResize(i)}})}}_mouseResize(e){e.preventDefault();let t=this.getBoundingRect(),i=this.getComputedStyle(),s=e.ui_event,n=i.parse("marginTop"),r=i.parse("marginLeft"),a=i.parse("marginRight"),h=i.parse("marginBottom"),m=0,c=0,d=re(s,!0);switch(e.sens){case"topright":case"bottomright":case"right":m=t.right-a-d.x;break;case"topleft":case"bottomleft":case"left":m=t.left-r-d.x;break}switch(e.sens){case"bottomleft":case"bottomright":case"bottom":c=t.bottom-h-d.y;break;case"topleft":case"topright":case"top":c=t.top-n-d.y;break}t.left-=r,t.top-=n;let p=e.sens;u.setCapture(this,g=>{let x=l((_,y)=>{let A=t.left,P=t.top,W=t.width,D=t.height,b,E,N=_+m,C=y+c;switch(N<0&&(N=0),C<0&&(C=0),p){case"topright":case"bottomright":case"right":W=N-A;break;case"topleft":case"bottomleft":case"left":b=A-N,W+=b,A-=b;break}switch(p){case"bottomleft":case"bottomright":case"bottom":D=C-P;break;case"topleft":case"topright":case"top":E=P-C,D+=E,P-=E;break}let T=new fe(W,D);this.setStyle({left:A,top:P,width:T.width,height:T.height}),this.emit("size",Q(T))},"__move");if(g.type=="mouseup"||g.type=="touchend")u.releaseCapture();else if(g.type=="mousemove"){let _=g;x(_.pageX,_.pageY)}else if(g.type=="touchmove"){let _=g;x(_.touches[0].pageX,_.touches[0].pageY)}})}},q=kt;l(q,"Popup"),F(q,"modal_stack",[]);function dn(o){if(o.key=="Tab"||o.key=="Enter"){let e=o.target;if(e.tagName=="TEXTAREA")return;let t=u.getElement(e);if(t&&(t.hasAttribute("wants-tab")||t.hasAttribute("wants-enter")))return;let i=f.body;q.modal_stack.length&&(i=q.modal_stack[q.modal_stack.length-1]),pn(i,o.target,o.shiftKey),o.stopPropagation(),o.preventDefault()}}l(dn,"x4handleKeyDown");function pn(o,e,t){let i=f.activeElement;if(!o.contains(i))return;let s=u.getElement(e),n=Array.from(o.querySelectorAll("[tabindex]"));if(n=n.filter(a=>a.offsetParent!==null),!n.length)return;let r=n.indexOf(e);r<0?r=0:t?r>0?r--:r=n.length-1:r<n.length-1?r++:r=0,n[r].focus()}l(pn,"_nextTab");function _s(){f.body.addEventListener("keydown",dn,!0)}l(_s,"installKBHandler");f.body?_s():window.addEventListener("load",_s);function fn(o){return S({source:o})}l(fn,"EvAction");var It=class extends ae{constructor(e){super(e),this.mapPropEvents(e,"run")}get props(){return this.m_props}set text(e){this.m_props.text=e,this.emit("change",M(this))}set icon(e){this.m_props.icon=e,this.emit("change",M(this))}fire(){this.emit("run",fn(this))}};l(It,"Action");function Dt(o,e,t=null){return S({url:o,svg:e,context:t})}l(Dt,"EvLoaded");function xs(o){let e=o.length;return o[0]=='"'&&o[e-1]=='"'?(o=o.substring(1,e-1),o=o.replaceAll('\\"',"'"),o):(o[0]=="'"&&o[e-1]=="'"&&(o=o.substring(1,e-1)),o)}l(xs,"trimQuotes");var ti=class extends me{svgs;constructor(){super(),this.svgs=new Map}load(e){if(this.svgs.has(e)){let t=this.svgs.get(e);t&&this.signal("loaded",Dt(e,t))}else this.svgs.set(e,null),l(async i=>{if(i.substring(0,24)=="data:image/svg+xml;utf8,"){let s=i.substring(24);this.svgs.set(i,s),this.signal("loaded",Dt(i,s))}else{let s=await fetch(i);if(s.ok){let n=await s.text();!n.startsWith("<svg")&&!n.startsWith("<?xml")?(console.error("svg loading error: ",n),this.signal("loaded",Dt(i,""))):(this.svgs.set(i,n),this.signal("loaded",Dt(i,n)))}}},"_load")(e)}};l(ti,"Loader");var Ui=new ti,ii=class extends u{m_icon;m_iconName;constructor(e){B(e)?super({icon:e}):super(e),this._setIcon(this.m_props.icon,!1),this.m_props.size&&this.setStyleValue("fontSize",this.m_props.size)}_setIcon(e,t){if(!e){this.m_iconName="";return}this.removeClass("@svg");let i,s;if(typeof e=="number")e=e.toString(16),i=e,console.error("deprecation error: invalid icon name");else{let a=/\s*var\s*\(\s*(.+)\s*\)\s*/gi,h=a.exec(e);for(;h;){let D=h[1].trim();if(e=he.getVar(D).trim(),e==""||e===void 0){console.error(`icon: unable to find variable named '${D}'`);return}else e=xs(e);h=a.exec(e)}if(e.startsWith("<svg")){this._setSVG("data:image/svg+xml;utf8,"+e);return}let m=/\s*svg\s*\(\s*(.+)\s*\)\s*/gi,c=/(.*\.svg)$/gi,d=m.exec(e)||c.exec(e);if(d){let D=d[1].trim();this._setSVG(D);return}let g=/^\s*(data\:image\/.+)\s*$/gi.exec(e);if(g){this._setSVG(g[1]);return}let _=/\s*cls\s*\(\s*(.+)\s*\)\s*/gi.exec(e);if(_){let D=_[1].trim();this.addClass(D);return}let A=/\s*url\s*\(\s*(.+)\s*\)\s*/gi.exec(e);if(A){s=xs(A[1].trim()),s=s.replaceAll("\\",""),this._setSVG(s);return}let W=/\s*font-char\s*\(\s*(.+)\s*\)\s*/gi.exec(e);if(W){this.removeClass("@svg-icon"),this.setContent(W[1],!1);return}else console.error("deprecation error: invalid icon name"),i=e,e=he.getVar("icon-"+e),(e==""||e===void 0)&&(e="0")}if(this.m_iconName=i,this.m_icon===e)return;let n=u.getCss(),r;if(t&&this.m_icon&&(r="icon-"+i,this.removeClass(r)),r="icon-"+i,ii.icon_cache[r]===void 0){ii.icon_cache[r]=!0;let a;s?a=`display: block; content: ' '; background-image: url(${s}); background-size: contain; width: 100%; height: 100%; background-repeat: no-repeat; color: white;`:a=`content: "\\${e}";`,n.setRule(r,`.${r}::before {${a}}`)}this.addClass(r),this.m_icon=e}set icon(e){this._setIcon(e,!0)}get icon(){return this.m_iconName}_setSVG(e){let t=l(i=>{i.url==e&&(this.addClass("@svg-icon"),this.setContent(K.from(i.svg),!1),Ui.off("loaded",t))},"set");Ui.on("loaded",t),Ui.load(e)}_setSVGPath(e){this.addClass("@svg-icon"),this.setContent(K.from(`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="${e}/></svg>`),!1)}},L=ii;l(L,"Icon"),F(L,"icon_cache",[]);var I=class extends u{constructor(e){typeof e=="string"||e instanceof K?super({text:e}):super(e)}render(e){let t=this.m_props.text;this.m_props.multiline&&!(t instanceof K)&&(t=new K(Ct(t,!0))),e.icon?(this.setTag("span"),this.addClass("@hlayout"),this.setContent([new L({id:"l_icon",icon:e.icon}),new u({content:t,ref:"text"})])):this.setContent(t),this.addClass(e.align??"left")}set text(e){let t=this.m_props;if(t.text!==e){t.text=e;let i=this.m_props.text;if(this.m_props.multiline&&!(i instanceof K)&&(i=new K(Ct(i,!0))),this.dom){let s=this;this.m_props.icon&&(s=this.itemWithRef("text")),s.setContent(i)}}}get text(){return this.m_props.text}set icon(e){this.m_props.icon=e;let t=this.itemWithRef("l_icon");t?t.icon=e:this.update(0)}get icon(){return this.itemWithRef("l_icon")?.icon}};l(I,"Label");var si=class extends u{};l(si,"MenuSeparator");var ni=class extends I{};l(ni,"MenuTitle");var Y=class extends q{m_subMenu;m_opener;m_virtual;m_lock;constructor(e,t){super(e),this.addClass("@shadow"),this.m_opener=t,this.m_virtual=!1,this.m_lock=0,this.enableMask(!1)}lock(e){this.m_lock+=e?1:-1}setVirtual(){this.m_virtual=!0}setSubMenu(e){this.m_subMenu=e}hideSubMenu(){this.m_subMenu&&(this.m_subMenu.m_opener._close(),this.m_subMenu.hide(),this.m_subMenu=null)}render(e){this.setContent(e.items)}show(){this.m_virtual||Y._addMenu(this),super.show()}close(){!this.dom&&!this.m_virtual||(this.m_opener&&this.m_opener._close(),this.m_subMenu&&(this.m_subMenu.close(),this.m_subMenu=null),super.close(),Y._removeMenu())}clear(){this.m_props.items=[]}static _addMenu(e){Y.watchCount==0&&(Y.rootMenu=e,f.addEventListener("mousedown",Y._mouseWatcher)),Y.watchCount++}static _removeMenu(){console.assert(Y.watchCount>0),Y.watchCount--,Y.watchCount==0&&f.removeEventListener("mousedown",Y._mouseWatcher)}static _mouseWatcher(e){if(e.defaultPrevented)return;let t=e.target;for(;t;){let i=u.getElement(t);if(i&&i instanceof Y)return;t=t.parentElement}Y._discardAll()}static _discardAll(){Y.rootMenu&&(Y.rootMenu.close(),Y.rootMenu=null)}displayAt(...e){this.m_lock||Y._discardAll();let t,i,s,n;e.length==1?{x:t,y:i}=re(e[0],!0):[t,i,s,n]=e,s||(s="top left"),super.displayAt(t,i,s,n)}},te=Y;l(te,"Menu"),F(te,"watchCount",0),F(te,"rootMenu",null);var ue=class extends u{m_menu;m_isOpen;m_action;constructor(e,t){e instanceof It?(super({click:()=>{e.fire()}}),this.m_action=e):B(e)?super({text:e,click:t}):super(e),this.mapPropEvents(this.m_props,"click"),this.m_menu=null,this.m_isOpen=!1,this.setDomEvent("mousedown",i=>this._mousedown(i)),this.setDomEvent("click",i=>this._click(i))}render(e){let t=e.icon??0,i=e.text;e.checked!==void 0&&(t=e.checked?"var( --x4-icon-check )":0),this.m_action&&(t||(t=this.m_action.props.icon),i===void 0&&(i=this.m_action.props.text));let s=null;this.isPopup&&(this.addClass("@popup-menu-item"),s=new L({icon:"var( --x4-icon-chevron-right )",cls:"pop-mark"})),!i&&!t&&this.addClass("@separator"),e.cls&&this.addClass(e.cls),this.setTag("a"),this.setContent([t?null:new L({icon:t}),new I({flex:1,text:i}),s])}get id(){return this.m_props.itemId}get text(){return this.m_props.text}get isPopup(){return!!this.m_props.items}_close(){this.removeClass("@opened"),this.m_isOpen=!1}_click(e){this.isPopup||(this.emit("click",ne()),te._discardAll())}_mousedown(e){if(this.isPopup){this.m_menu||(this.m_menu=new te({items:this.m_props.items},this));let t=this.m_isOpen,i=u.getElement(this.dom,te);if(i&&i.hideSubMenu(),!t){i&&i.setSubMenu(this.m_menu),this.m_isOpen=!0;let s=this.getBoundingRect();this.m_menu.lock(!0),i?this.m_menu.displayAt(s.right,s.top):this.m_menu.displayAt(s.left,s.bottom),this.m_menu.lock(!1),this.addClass("@opened")}e.preventDefault()}}};l(ue,"MenuItem");var ri=class extends w{m_items;constructor(e,t){super(e),console.assert(!1,"not imp"),this.addClass("@shadow"),this.m_items=e.items}render(){this.setContent(this.m_items)}};l(ri,"MenuBar");var Pt=class extends H{m_selection;m_defer_sel;m_container;m_view;m_topIndex;m_itemHeight;m_cache;constructor(e){super(e),this.setDomEvent("keydown",t=>this.handleKey(t)),this.setDomEvent("click",t=>this._handleClick(t)),this.setDomEvent("dblclick",t=>this._handleClick(t)),this.setDomEvent("contextmenu",t=>this._handleCtxMenu(t)),this._setTabIndex(e.tabIndex,0),this.mapPropEvents(e,"click","dblClick","contextMenu","selectionChange","cancel")}componentCreated(){this.m_props.virtual?this._buildItems():this.m_props.populate&&(this.items=this.m_props.populate(null))}render(e){e.items=e.items||[],e.gadgets=e.gadgets,e.renderItem=e.renderItem,e.virtual=e.virtual??!1,this.m_topIndex=0,e.virtual?(console.assert(e.itemHeight!==void 0),this.m_itemHeight=e.itemHeight,this.m_cache=new Map,this.addClass("virtual")):(this.m_itemHeight=void 0,this.m_cache=void 0),this._buildContent()}set items(e){this.setItems(e)}get items(){return this.m_props.items}setItems(e,t=!0){this.m_props.items=e,t||(this.m_selection=null),this.m_container?this._buildItems():this._buildContent()}handleKey(e){let t=l(i=>{let s;Z(this.m_props.items)?(s=this.m_props.items(),this.m_props.items=s):s=this.m_props.items;let n;if(!this.m_selection)s&&(n=s[0]);else{let a=s.findIndex(h=>h===this.m_selection.item);i>0&&a<s.length-1?n=s[a+1]:i<0&&a>0?n=s[a-1]:n=this.selection}let r=this._findItemWithId(n?.id);this._selectItem(n,r,!0)},"moveSel");switch(e.key){case"ArrowDown":{t(1),e.preventDefault(),e.stopPropagation();break}case"ArrowUp":{t(-1),e.preventDefault(),e.stopPropagation();break}}}_buildContent(){let e=this.m_props;e.virtual?(this.m_container=new O({cls:"@scroll-container",content:[]}),this.m_view=new O({cls:"@scroll-view",flex:1,content:this.m_container,dom_events:{sizechange:()=>this._updateScroll(!0),scroll:()=>this._updateScroll(!1)}}),this.setContent([this.m_view,e.gadgets?new w({cls:"gadgets",content:e.gadgets}):null])):(this.m_view=void 0,this.m_container=new H({cls:"@scroll-container",content:[]}),this.addClass("@scroll-view"),this.setContent(this.m_container,!1)),e.virtual&&this.m_container.setStyleValue("height",e.items.length*this.m_itemHeight),(this.dom||!e.virtual)&&this._buildItems()}_updateScroll(e){let t=l(()=>{let i=Math.floor(this.m_view.dom.scrollTop/this.m_itemHeight);(i!=this.m_topIndex||e)&&(this.m_topIndex=i,this._buildItems())},"update");e?this.startTimer("scroll",10,!1,t):t()}async _buildItems(){let e=this.m_props,t=[],i=e.items;Z(i)&&(i=i());let s=this.m_selection?.item.id,n=!1;if(e.virtual){let r=this.getBoundingRect(),a=100,h=0,m=this.m_topIndex*this.m_itemHeight,c=this.m_topIndex,d=r.height,p=e.items.length,g=[],x=this.m_cache;for(this.m_cache=new Map;h<d&&c<p&&--a>0;){let _=e.items[c],y;x.has(_.id)?(y=x.get(_.id),x.delete(_.id)):(y=this._renderItem(_),g.push(y)),s==_.id&&(y.addClass("@selected"),n=!0),y.setStyleValue("top",m+h),t.push(y),this.m_cache.set(_.id,y),h+=this.m_itemHeight,c++}x.forEach(_=>{_.dispose()}),this.m_container.appendChild(g),this.m_container.setStyleValue("height",p*this.m_itemHeight),n||i.some(_=>s==_.id)||(this.m_selection=null)}else i.forEach(r=>{let a=this._renderItem(r);s==r.id&&(a.addClass("@selected"),n=!0),t.push(a)}),this.m_container.setContent(t,!1),n||(this.m_selection=null);if(this.m_defer_sel){let r=this.m_defer_sel;this.m_defer_sel=void 0,this.selection=r}}_renderItem(e){let t=this.onRenderItem(e);return t.setAttribute("data-id",e.id),t.addClass("@list-item"),t.setData("item-id",e.id),t}onRenderItem(e){return this.m_props.renderItem?this.m_props.renderItem(e):new w({content:e.text})}_handleClick(e){e.stopImmediatePropagation(),e.preventDefault();let t=e.target,i=this.dom,s=this.m_props.items;for(;t&&t!=i;){let n=u.getElement(t),r=n?.getData("item-id");if(r!==void 0){let a=s.find(h=>h.id==r);if(a){let h;e.type=="click"?(h=ne(a),this.emit("click",h)):(h=ye(a),this.emit("dblClick",h)),h.defaultPrevented||this._selectItem(a,n)}else this._selectItem(null,null);return}t=t.parentElement}this._selectItem(null,null)}_handleCtxMenu(e){e.preventDefault();let t=e.target,i=this.dom,s=this.m_props.items;for(;t&&t!=i;){let n=u.getElement(t),r=n?.getData("item-id");if(r){let a=s.find(h=>h.id==r);a&&(this._selectItem(a,n),this.emit("contextMenu",pe(e,a)));return}t=t.parentElement}this.emit("contextMenu",pe(e,null))}_selectItem(e,t,i=!0){this.m_selection&&this.m_selection.citem&&this.m_selection.citem.removeClass("@selected"),this.m_selection=e?{item:e,citem:t}:null,this.m_selection&&this.m_selection.citem&&this.m_selection.citem.addClass("@selected"),i&&this.emit("selectionChange",ie(e))}get selection(){return this.m_selection?this.m_selection.item:null}set selection(e){if(e==null)this._selectItem(null,null);else if(Z(this.m_props.items))this.m_defer_sel=e;else{let t=this.m_props.items.find(s=>s.id==e),i=this._findItemWithId(t.id);this._selectItem(t,i,!1)}}_findItemWithId(e){let t=null;return this.dom&&this.m_container.enumChilds(i=>{if(i.getData("item-id")==e)return i.scrollIntoView(),t=i,!0}),t}appendItem(e,t=!1,i=!0){t?this.m_props.items.unshift(e):this.m_props.items.push(e),i&&(this.selection=null),this.m_container?this._buildItems():this._buildContent(),i&&(this.selection=e.id)}updateItem(e,t){let i=this.m_props.items.findIndex(r=>r.id===e);if(i<0)return;let s=!1;this.m_selection&&this.m_selection.item===this.m_props.items[i]&&(s=!0),this.m_props.items[i]=t;let n=this.queryItem(`[data-id="${t.id}"]`)?.dom;if(n){let r=this._renderItem(t);s&&(r.addClass("@selected"),this.m_selection.citem=r,this.m_selection.item=t);let a=r._build();this.m_container.dom.replaceChild(a,n)}}};l(Pt,"ListView");function bs(o=null){return S({context:o})}l(bs,"EvCancel");var Te=class extends q{m_list;constructor(e){super({tabIndex:!1}),this.enableMask(!1),this.addClass("@non-maskable"),e.tabIndex=!1,this.m_list=new Pt(e),this.setContent(this.m_list),this.mapPropEvents(e,"cancel")}set items(e){this.m_list.items=e}handleKey(e){this.m_list.handleKey(e)}_handleClick=e=>{if(!this.dom)return;let t=e.target;this.dom.contains(t)||u.getElement(t,ue)||(this.signal("cancel",bs()),this.close())};show(e){f.addEventListener("mousedown",this._handleClick),super.show(e)}hide(){f.removeEventListener("mousedown",this._handleClick),super.hide()}close(){f.removeEventListener("mousedown",this._handleClick),super.close()}get selection(){return this.m_list.selection}set selection(e){this.m_list.selection=e}};l(Te,"PopupListView");var Ki,Fe,Ue=class extends u{m_text;set text(e){this.m_text.text=e}render(){this.setClass("@non-maskable",!0),this.setContent([new L({icon:"var( --x4-icon-tip )"}),this.m_text=new I({text:"help"})])}displayAt(e,t,i="top left"){this.show();let s="l",n="t";i.indexOf("right")>=0&&(s="r"),i.indexOf("bottom")>=0&&(n="b");let r=f.body.getBoundingClientRect(),a=this.getBoundingRect();s=="r"&&(e-=a.width),n=="b"&&(t-=a.height),e+a.width>r.right&&(e=r.right-a.width),t+a.height>r.bottom&&(t=r.bottom-a.height-17),this.setStyle({left:e,top:t})}};l(Ue,"Tooltip");function gn(o){if(vt())return;let e={target:null,x:0,y:0};function t(n){e.x=n.pageX,e.y=n.pageY}l(t,"handle_mpos");function i(n){let r=n.target,a=null;for(e.x=n.pageX+10,e.y=n.pageY+15;r&&(a=r.getAttribute("tip"),!a);)r=r.parentElement;if(!(r==e.target||Fe&&r==Fe.dom)){if(!r||!a){e.target=null,o?o(null):s();return}e.target=r,o?o(null):s(),o?o(a):Ki=setTimeout(()=>{Fe===void 0&&(Fe=new Ue({}),f.body.appendChild(Fe._build())),Fe.text=a,Fe.displayAt(e.x+17,e.y+17,"top left")},700)}}l(i,"handle_mouse");function s(){Ki&&clearTimeout(Ki),Fe&&Fe.hide()}l(s,"_hideTip"),f.body.addEventListener("mouseover",i),f.body.addEventListener("mouseout",i),f.body.addEventListener("mousemove",t)}l(gn,"initTooltips");var j=class extends u{m_error_tip;constructor(e){super(e)}componentDisposed(){this.m_error_tip&&this.m_error_tip.dispose(),super.componentDisposed()}render(e){this.setTag("input"),this._setTabIndex(e.tabIndex),this.setAttributes({value:e.value,type:e.type||"text",name:e.name,placeholder:e.placeHolder,autofocus:e.autoFocus,readonly:e.readOnly,autocomplete:"off",tabIndex:e.tabIndex,spellcheck:e.spellcheck===!1?"false":void 0,min:e.min,max:e.max,...e.attrs}),this.m_props.autosel=e.autosel??!0,e.uppercase&&this.setStyleValue("textTransform","uppercase"),this.m_props.autosel&&this.setDomEvent("focus",()=>{this.selectAll()})}showError(e){this.m_error_tip||(this.m_error_tip=new Ue({cls:"error"}),f.body.appendChild(this.m_error_tip._build()));let t=this.getBoundingRect();this.m_error_tip.text=e,this.m_error_tip.displayAt(t.right,t.top-8,"top right"),this.addClass("@error")}clearError(){this.m_error_tip&&(this.m_error_tip.hide(),this.removeClass("@error"))}getType(){return this.m_props.type}get value(){return this.getValue()}getValue(){let e=this.dom;if(this.dom&&(this.m_props.value=e.value),this.m_props.uppercase){let t=this.m_props.value.toUpperCase();e&&t!=this.m_props.value&&(e.value=t),this.m_props.value=t}return this.m_props.value}set value(e){this.setValue(e)}setValue(e){this.m_props.value=e,this.dom&&(this.dom.value=e)}getStoreValue(){if(this.m_props.value_hook)return this.m_props.value_hook.get();{let e=this.getAttribute("type");e&&(e=e.toLowerCase());let t,i=this.dom;if(e==="file"){t=[];let s=i.files;for(let n=0;n<s.length;n++)t.push(s[n].name)}else if(e==="checkbox")i.checked?t=1:t=0;else if(e==="radio")i.checked&&(t=this.value);else if(e==="date")debugger;else e=="number"?(t=this.value,t.indexOf(",")>=0&&(t=t.replace(",","."))):t=this.value;return t}}setStoreValue(e){if(this.clearError(),this.m_props.value_hook)return this.m_props.value_hook.set(e);{let t=this.getAttribute("type"),i=this.dom;if(t&&(t=t.toLowerCase()),t==="checkbox"){let s=e!==null&&e!=="0"&&e!==0&&e!==!1;s!==i.checked&&(i.setAttribute("checked",""+s),i.dispatchEvent(new Event("change")))}else this.value=e}}set readOnly(e){this.setAttribute("readonly",e)}selectAll(){this.dom.select()}select(e,t=9999){this.dom.setSelectionRange(e,e+t)}getSelection(){let e=this.dom;return{start:e.selectionStart,length:e.selectionEnd-e.selectionStart}}};l(j,"Input");var lt=class extends u{constructor(e){super(e),this.setTag("button"),this.setDomEvent("click",t=>this._handleClick(t)),this.setDomEvent("mousedown",()=>{this._startAutoRep(!0)}),this.setDomEvent("mouseup",()=>{this._startAutoRep(!1)}),this.setDomEvent("keydown",t=>this._handleKeyDown(t)),this.mapPropEvents(e,"click")}render(e){let t=e.action,i=e.icon,s=e.text;t&&(!i&&t.props.icon&&(i=t.props.icon),s===void 0&&t.props.text&&(s=t.props.text));let n=i?new L({icon:i,cls:"left",ref:"l_icon"}):null,r=new I({flex:1,text:s??"",align:e.align,ref:"label"}),a=e.rightIcon?new L({icon:e.rightIcon,cls:"right",ref:"r_icon"}):null;s===void 0&&r.addClass("@hidden"),this.setContent([n,r,a]),this._setTabIndex(e.tabIndex)}_startAutoRep(e){this.m_props.autoRepeat&&(e?this.startTimer("repeat",700,!1,()=>{this.startTimer("repeat",this.m_props.autoRepeat,!0,this._sendClick)}):this.stopTimer("repeat"))}_handleKeyDown(e){!e.ctrlKey&&!e.shiftKey&&!e.altKey&&(e.key=="Enter"||e.key==" ")&&(this._sendClick(),e.preventDefault(),e.stopPropagation())}_handleClick(e){if(this.m_props.menu){let t=new te({items:Z(this.m_props.menu)?this.m_props.menu():this.m_props.menu}),i=this.getBoundingRect();t.displayAt(i.left,i.bottom,"tl")}else this._sendClick();e.preventDefault(),e.stopPropagation()}_sendClick(){if(this.m_props.menu){let e=new te({items:Z(this.m_props.menu)?this.m_props.menu():this.m_props.menu}),t=this.getBoundingRect();e.displayAt(t.left,t.bottom,"tl")}else this.emit("click",ne()),this.m_props.action&&this.m_props.action.fire()}set text(e){this.m_props.text=e;let t=this.itemWithRef("label");t&&(t.text=e,t.removeClass("@hidden"))}get text(){return this.itemWithRef("label")?.text}set icon(e){this.m_props.icon=e;let t=this.itemWithRef("l_icon");t?t.icon=e:this.update()}get icon(){return this.itemWithRef("l_icon")?.icon}set rightIcon(e){this.m_props.rightIcon=e;let t=this.itemWithRef("r_icon");t&&(t.icon=e)}get rightIcon(){return this.itemWithRef("l_icon")?.icon}set menu(e){this.m_props.menu=e}};l(lt,"BaseButton");var z=class extends lt{};l(z,"Button");var oi=class extends lt{constructor(e){super(e)}render(e){super.render(e),e.checked&&(this.addClass("checked"),this._updateIcon())}_sendClick(){super._sendClick(),this.m_props.checked=!this.m_props.checked,this.setClass("checked",this.m_props.checked),this.emit("change",M(this.m_props.checked)),this._updateIcon()}_updateIcon(){if(this.m_props.checkedIcon){let e=this.m_props.checked?this.m_props.checkedIcon:this.m_props.icon,t=this.itemWithRef("l_icon");t&&(t.icon=e)}}};l(oi,"ToggleButton");var Mt=class extends H{m_date;constructor(e){super(e),this.mapPropEvents(e,"change"),this.m_date=e.date?.clone()??new Date}render(e){let t=et(this.m_date);t.setDate(1);let i=t.getDay();i==0&&(i=7),t.setDate(-i+1+1);let s=et(t),n=this.m_date.hash(),r=et(this.m_date);r.setDate(1),r.setMonth(r.getMonth()+1),r.setDate(0);let a=Qe(r),h=[],m=new w({cls:"month-sel",content:[new I({cls:"month",text:G(this.m_date,"O"),dom_events:{click:()=>this._choose("month")}}),new I({cls:"year",text:G(this.m_date,"Y"),dom_events:{click:()=>this._choose("year")}}),new Ee,new z({text:"<",click:()=>this._next(!1)}),new z({text:">",click:()=>this._next(!0)})]});h.push(m);let c=[];c.push(new w({cls:"weeknum cell"}));for(let g=0;g<7;g++)c.push(new I({cls:"cell",flex:1,text:k.global.day_short[(g+1)%7]}));h.push(new w({cls:"week header",content:c}));let d=this.m_date.getMonth(),p=!0;for(;Qe(s)<=a;){let g=[new w({cls:"weeknum cell",content:new u({tag:"span",content:G(s,"w")})})];for(let x=0;x<7;x++){let _="cell day";s.hash()==n&&(_+=" today"),s.getMonth()!=d&&(_+=" out");let y=l(A=>new w({cls:_,flex:1,content:new u({tag:"span",content:G(A,"d")}),dom_events:{click:()=>this.select(A)}}),"mkItem");g.push(y(s.clone())),s.setDate(s.getDate()+1),p=!1}h.push(new w({cls:"week",flex:1,content:g}))}this.setContent(h)}select(e){this.m_date=e,this.emit("change",M(e)),this.update()}_next(e){this.m_date.setMonth(this.m_date.getMonth()+(e?1:-1)),this.update()}_choose(e){let t=[];if(e=="month")for(let n=0;n<12;n++)t.push(new ue({text:k.global.month_long[n],click:()=>{this.m_date.setMonth(n),this.update()}}));else if(e=="year"){let n=this.m_props.minDate?.getFullYear()??1900,r=this.m_props.maxDate?.getFullYear()??2037;for(let a=r;a>=n;a--)t.push(new ue({text:""+a,click:()=>{this.m_date.setFullYear(a),this.update()}}))}let i=new te({items:t}),s=this.getBoundingRect();i.displayAt(s.left,s.top)}get date(){return this.m_date}set date(e){this.m_date=e,this.update()}};l(Mt,"Calendar");var ht=class extends q{m_cal;constructor(e){super({tabIndex:1}),this.enableMask(!1),this.m_cal=new Mt(e),this.m_cal.addClass("@fit"),this.setContent(this.m_cal)}_handleClick=e=>{if(!this.dom)return;let t=e.target;this.dom.contains(t)||u.getElement(t,ue)||this.close()};show(e,t){f.addEventListener("mousedown",this._handleClick),t?super.displayAt(t.x,t.y,"top left",void 0,e):super.show(e)}close(){f.removeEventListener("mousedown",this._handleClick),super.close()}};l(ht,"PopupCalendar");var _n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,U=class extends u{m_cal_popup;m_ui_input;constructor(e){super(e),this.addClass("@hlayout"),this.mapPropEvents(e,"change","click","focus")}componentCreated(){super.componentCreated(),this.m_props.autoFocus&&this.focus()}focus(){this.m_ui_input.focus()}render(e){let t={flex:1,dom_events:{focus:()=>this._focus(),focusout:()=>this._blur(),input:()=>this._change()},value:e.value,name:e.name,type:e.type,placeHolder:e.placeHolder,autoFocus:e.autoFocus,readOnly:e.readOnly,value_hook:e.value_hook,uppercase:e.uppercase,spellcheck:e.spellcheck,tabIndex:e.tabIndex===void 0?!0:e.tabIndex,attrs:e.attrs,min:e.min,max:e.max,autosel:e.autosel};if(e.type=="date"){e.format=e.format??"Y-M-D",t.type="text";let p={get:()=>this._date_get_hook(),set:g=>this._date_set_hook(g)};t.value_hook=e.value_hook??p}this.m_ui_input=new j(t);let i;e.icon?i=new z({icon:e.icon,click:()=>this._btnClick(),tabIndex:!1}):e.type=="date"&&(i=new z({cls:"gadget",icon:"var( --x4-icon-calendar-days )",tabIndex:!1,click:()=>this._showDatePicker(i)}),e.validator||(e.validator=this._date_validator));let s=e.gadgets??[];s.forEach(p=>{p.addClass("gadget")});let n=[i,...s];this.setClass("@required",e.required),e.gadgets&&e.gadgets.length&&this.addClass("with-gadgets");let r,a,h=e.labelWidth;h>0&&(r=h),h<0&&(a=-h);let m,c=e.labelAlign,d=!1;e.label&&(c=="top"&&(c="left",d=!0,a=1),m=new I({ref:"label",tag:"label",cls:"label1"+(e.label?"":" @hidden"),text:e.label??"",width:r,flex:a,align:c})),d?(this.removeClass("@hlayout"),this.addClass("@vlayout vertical"),this.setContent([m,new w({width:r,content:[this.m_ui_input,...n]})])):(this.addClass("@hlayout"),this.setContent([m,this.m_ui_input,...n]))}enable(e){e===!0&&this.m_ui_input.enable(),super.enable(e)}disable(){this.m_ui_input.disable(),super.disable()}_btnClick(){this.emit("click",ne(this.value))}setDateStoreFormat(e){this.m_props.format=e}setStoreValue(e){this.m_ui_input.setStoreValue(e)}getStoreValue(){return this.m_ui_input.getStoreValue()}_date_get_hook(){let e=wt(this.value),t=this.m_props;return t.format=="native"?e:e?G(e,t.format):null}_date_set_hook(e){let t=this.m_props;if(t.format=="native")this.value=G(e);else if(e){let i=wt(e,t.format);this.value=G(i)}else this.value=""}showError(e){this.m_ui_input.showError(e)}clearError(){this.m_ui_input.clearError()}get value(){return this.getValue()}getValue(){return this.m_ui_input?this.m_ui_input.value:this.m_props.value}set value(e){this.setValue(e)}setValue(e){this.m_ui_input?this.m_ui_input.value=e:this.m_props.value=e}selectAll(){this.m_ui_input.selectAll()}select(e,t=9999){this.m_ui_input.select(e,t)}getSelection(){return this.m_ui_input.getSelection()}set readOnly(e){this.m_ui_input.readOnly=e}get label(){return this.itemWithRef("label")?.text}set label(e){this.itemWithRef("label").text=e}_change(){let e=this.m_ui_input.value;this.emit("change",M(e))}_focus(){this.clearError(),this.emit("focus",qt(!0))}_blur(){this._validate(this.m_ui_input.value),this.emit("focus",qt(!1))}validate(){return this._validate(this.value)}_validate(e){let t=this.m_props,i=!1;if(t.required&&e.length==0)return this.showError(k.global.required_field),!1;if(e!=""){let s=this.getAttribute("pattern");if(s){let n=new RegExp(s);if(n&&!n.test(e))return this.showError(k.global.invalid_format),!1}if(t.type=="email"){if(!_n.test(e.toLowerCase()))return this.showError(k.global.invalid_email),!1}else if(t.type=="number"){let n=parseFloat(e);if(isNaN(n))return this.showError(k.global.invalid_number),!1;let r=parseFloat(this.m_ui_input.getAttribute("min"));r!==void 0&&n<r&&(e=""+r,i=!0);let a=parseFloat(this.m_ui_input.getAttribute("max"));a!==void 0&&n>a&&(e=""+a,i=!0)}}if(t.validator)try{this.value=t.validator(e)}catch(s){return this.showError(s instanceof Error?s.message:s),!1}else i&&(this.value=e);return!0}_date_validator(e){if(e=e.trim(),e=="")return"";let t;if(e=="@")t=new Date;else if(t=wt(e),!t)throw Ze(k.global.invalid_date,k.global.date_format);return G(t)}_showDatePicker(e){this.m_cal_popup||(this.m_cal_popup=new ht({change:i=>{this.value=G(i.value),this.m_cal_popup.close()}}));let t=this.m_ui_input.getBoundingRect();this.m_cal_popup.displayAt(t.left,t.bottom,"top left")}get input(){return this.m_ui_input}get type(){return this.m_props.type}};l(U,"TextEdit");var ai=class extends U{m_popup;m_popvis;m_needval;m_lockpop;constructor(e){super(e),this.setDomEvent("input",()=>this._onChange()),this.setDomEvent("focusin",()=>this._onFocus()),this.startTimer("focus-check",100,!0,()=>this._checkFocus()),this.m_popvis=!1,this.m_needval=!1,this.m_lockpop=!1,this.setDomEvent("keydown",t=>this._onKey(t))}_onKey(e){this.m_popvis?e.key=="ArrowUp"||e.key=="ArrowDown"?(this.m_lockpop=!0,this.m_popup.handleKey(e),this.m_lockpop=!1,e.preventDefault(),e.stopPropagation()):e.key=="Escape"&&(this._hidePopup(),e.preventDefault(),e.stopPropagation()):e.key=="ArrowDown"&&(this._onChange(),e.preventDefault(),e.stopPropagation())}async _onChange(){let e=this.m_props.enumValues(this.value);if(e instanceof Promise&&(e=await e),e.length==0){this._hidePopup();return}this._showPopup(e)}componentDisposed(){this.m_popup&&this._hidePopup(),super.componentDisposed()}showPopup(e=!0){e?this._onChange():this._hidePopup()}_showPopup(e){let t=this.m_props;if(t.readOnly||this.hasClass("@disable"))return;if(!this.m_popup){let s=this.getComputedStyle(),n=s.value("fontFamily"),r=s.value("fontSize");this.m_popup=new Te({cls:"@combo-popup",attrs:{tabindex:0},selectionChange:a=>{let h=a.selection.id;this.m_props.selectValue&&(h=this.m_props.selectValue(h)),this.value=h,this.m_lockpop||(this._hidePopup(),this.focus())},style:{fontFamily:n,fontSize:r},renderItem:t.renderItem})}e&&(this.m_popup.items=e.map(s=>({id:s,text:s})));let i=this.m_ui_input.getBoundingRect();this.m_popup.setStyle({minWidth:i.width}),this.m_popup.displayAt(i.left,i.bottom),this.m_popvis=!0}_validate(e){return!0}validate(){return super._validate(this.value)}_checkFocus(){let e=document.activeElement;this.dom&&this.dom.contains(e)||this.m_popup&&this.m_popup.dom&&this.m_popup.dom.contains(e)||this._hidePopup()}_hidePopup(){this.m_popvis&&(this.m_popup.close(),this.m_popvis=!1),this.m_needval&&(this.validate(),this.m_needval=!1)}_onFocus(){this.value.length==0&&this._onChange(),this.m_needval=!0}isPopupVisible(){return this.m_popvis}};l(ai,"AutoComplete");function xn(o){return S({ctx:o})}l(xn,"EvPaint");function bn(o,e,t){let i=o;return i.width=e,i.height=t,i.smoothLine=vn,i.smoothLineEx=Cn,i.line=wn,i.roundRect=En,i.calcTextSize=yn,i.setFontSize=Fn,i.circle=kn,i}l(bn,"mkPainter");function vn(o,e=null,t=!0){if(o.length<2)return;if(e||(e=this),o.length==2){t!==!1?e.moveTo(o[0].x,o[0].y):e.lineTo(o[0].x,o[0].y),e.lineTo(o[1].x,o[1].y);return}function i(h,m){return{x:h.x+(m.x-h.x)/2,y:h.y+(m.y-h.y)/2}}l(i,"midPointBtw");function s(h,m,c,d,p,g,x){return{x:(1-h)*(1-h)*m+2*(1-h)*h*d+h*h*g,y:(1-h)*(1-h)*c+2*(1-h)*h*p+h*h*x}}l(s,"getQuadraticXY");let n=o[0],r=o[1],a=n;e.moveTo(n.x,n.y);for(let h=1,m=o.length;h<m;h++){let c=i(n,r);for(let d=0;d<8;d++){let{x:p,y:g}=s(d/8,a.x,a.y,n.x,n.y,c.x,c.y);e.lineTo(p,g)}n=o[h],r=o[h+1],a=c}e.lineTo(n.x,n.y)}l(vn,"smoothLine");function Cn(o,e=.5,t=10,i=null,s=!0,n=!1){let r=[];for(let b=0,E=o.length;b<E;b++)r.push(o[b].x),r.push(o[b].y);let a,h=1,m=r.length,c=0,d=(m-2)*t+2+(n?2*t:0),p=new Float32Array(d),g=new Float32Array((t+2)*4),x=4;for(a=r.slice(0),n?(a.unshift(r[m-1]),a.unshift(r[m-2]),a.push(r[0],r[1])):(a.unshift(r[1]),a.unshift(r[0]),a.push(r[m-2],r[m-1])),g[0]=1;h<t;h++){var _=h/t,y=_*_,A=y*_,P=A*2,W=y*3;g[x++]=P-W+1,g[x++]=W-P,g[x++]=A-2*y+_,g[x++]=A-y}g[x]=1,D(a,g,m),n&&(a=[],a.push(r[m-4],r[m-3],r[m-2],r[m-1]),a.push(r[0],r[1],r[2],r[3]),D(a,g,4));function D(b,E,N){for(var C=2,T;C<N;C+=2){var de=b[C],Ve=b[C+1],xt=b[C+2],qe=b[C+3],Ye=(xt-b[C-2])*e,Ce=(qe-b[C-1])*e,Ae=(b[C+4]-de)*e,ts=(b[C+5]-Ve)*e;for(T=0;T<t;T++){var Ot=T<<2,is=E[Ot],ss=E[Ot+1],ns=E[Ot+2],rs=E[Ot+3];p[c++]=is*de+ss*xt+ns*Ye+rs*Ae,p[c++]=is*Ve+ss*qe+ns*Ce+rs*ts}}}l(D,"parse"),m=n?0:r.length-2,p[c++]=r[m],p[c]=r[m+1],i||(i=this);for(let b=0,E=p.length;b<E;b+=2)b==0&&s!==!1?i.moveTo(p[b],p[b+1]):i.lineTo(p[b],p[b+1])}l(Cn,"smoothLineEx");function wn(o,e,t,i,s,n=1){this.save(),this.beginPath(),this.moveTo(o,e),this.lineTo(t,i),this.lineWidth=n,this.strokeStyle=s,this.stroke(),this.restore()}l(wn,"line");function En(o,e,t,i,s){this.moveTo(o+s,e),this.lineTo(o+t-s,e),this.quadraticCurveTo(o+t,e,o+t,e+s),this.lineTo(o+t,e+i-s),this.quadraticCurveTo(o+t,e+i,o+t-s,e+i),this.lineTo(o+s,e+i),this.quadraticCurveTo(o,e+i,o,e+i-s),this.lineTo(o,e+s),this.quadraticCurveTo(o,e,o+s,e),this.closePath()}l(En,"roundRect");function yn(o,e=!1){let t=this.measureText(o),i=t.fontBoundingBoxAscent+t.fontBoundingBoxDescent;return e?{width:Math.round(t.width),height:Math.round(i)}:{width:t.width,height:i}}l(yn,"calcTextSize");function Fn(o){let e=Math.round(o)+"px";this.font=this.font.replace(/\d+px/,e)}l(Fn,"setFontSize");function kn(o,e,t){this.moveTo(o+t,e),this.arc(o,e,t,0,Math.PI*2)}l(kn,"circle");var li=class extends u{m_iwidth=-1;m_iheight=-1;m_scale=1;m_canvas;constructor(e){super(e),this.setDomEvent("sizechange",()=>{this._paint()}),this.mapPropEvents(e,"paint")}render(){this.m_iwidth=-1,this.m_iheight=-1,this.m_canvas=new u({tag:"canvas"}),this.setContent(this.m_canvas)}update(e=0){this.m_iheight=this.m_iwidth=-1,super.update(e)}scale(e){this.m_scale=e,this.m_iwidth=-1,this.redraw()}get canvas(){return this.m_canvas}$update_rep=0;redraw(e){e!==void 0?++this.$update_rep>=20?(this.stopTimer("update"),this._paint()):this.startTimer("update",e,!1,()=>this._paint()):(this.stopTimer("update"),this._paint())}_paint(){this.$update_rep=0;let e=this.dom;if(!this.isUserVisible())return;let t=this.m_canvas.dom,i=e.clientWidth,s=e.clientHeight,n=t.getContext("2d");if(i!=this.m_iwidth||s!=this.m_iheight){let r=window.devicePixelRatio||1,a=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,h=this.canvas;if(r!==a||this.m_scale!=1){let m=r/a,c=i*m,d=s*m;h.setAttribute("width",""+c),h.setAttribute("height",""+d),h.setStyleValue("width",i),h.setStyleValue("height",s),m*=this.m_scale,n.scale(m,m)}else h.setAttribute("width",""+i),h.setAttribute("height",""+s),h.setStyleValue("width",i),h.setStyleValue("height",s),n.scale(1,1);this.m_iwidth=i,this.m_iheight=s}if(i&&s){let r=bn(n,i,s);this.m_props.autoClear&&r.clearRect(0,0,i,s),r.save(),r.translate(-.5,-.5),this.paint(r),r.restore()}}paint(e){try{this.m_props.painter?this.m_props.painter(e):this.emit("paint",xn(e))}catch(t){console.assert(!1,t)}}};l(li,"Canvas");var Be=class extends u{m_cards;m_ipage;m_cpage;constructor(e){super(e),this.m_cards=[],this.m_ipage=e.active,this.m_cpage=null,this.singleShot(()=>{this.setPages(e.pages)})}render(){let e=[];this.m_cards.forEach(t=>{t.page&&e.push(t.page)}),this.setContent(e)}switchTo(e){if(this.m_cards.length!=0&&(e===void 0&&(e=this.m_cards[0].name),e!==this.m_cpage?.name)){if(this.m_cpage&&(this.m_cpage.selector&&this.m_cpage.selector.removeClass("@active"),this.m_cpage.page&&!(this.m_cpage.page instanceof Function))){let t=this.m_cpage.page;t.removeClass("@active"),t.addClass("@hidden")}if(this.m_cpage=this.m_cards.find(t=>t.name==e),this.m_cpage){if(this.m_cpage.page){Z(this.m_cpage.page)&&(this.m_cpage.page=this.m_cpage.page(),console.assert(this.m_cpage.page!=null,"You must return a valid component"));let t=this.m_cpage.page;t.addClass("@active"),t.removeClass("@hidden"),t.dom||this._preparePage(t),this.m_cpage.selector&&this.m_cpage.selector.addClass("@active")}this.emit("change",M(this.m_cpage.name))}}}setPages(e){let t=this._initTabs(e);t&&ce(()=>{this.switchTo(t),this.update()})}_initTabs(e){if(!e)return;let t=this.m_ipage;return e.forEach(i=>{if(!i)return;let s={...i};s.selector=this._prepareSelector(i),s.active=!1,this.m_cards.push(s),t||(t=i.name),i.active&&(t=i.name)}),t}_updateSelector(){}_prepareSelector(e){return null}_preparePage(e){e.setStyleValue("flex",1),e.addClass("@tab-page")}};l(Be,"CardView");var ke=class extends u{constructor(e){super(e),this.setDomEvent("focus",()=>this._setFocus()),this.mapPropEvents(e,"change"),e.slider&&this.addClass("slider")}render(e){let t=e.labelWidth??-1,i="__cb_"+this.uid;this.setTag("label"),this.addClass("@hlayout"),this.addClass(e.align??"left"),this.setContent([new j({ref:"input",type:"checkbox",name:e.name,id:i,tabIndex:e.tabIndex,value:e.value??"on",attrs:{checked:e.checked?"":void 0},dom_events:{change:this._change.bind(this)}}),e.slider?new u({cls:"@slide-el"}):null,new I({text:e.text??"",width:t<0?void 0:t,flex:t<0?-t:void 0,align:e.labelAlign??"left",style:{order:e.align=="right"?-1:1},attrs:{for:i}})])}_change(){this.emit("change",M(this.check))}_setFocus(){this.itemWithRef("input").focus()}get check(){return this.dom?this.itemWithRef("input").dom.checked:this.m_props.checked}set check(e){if(this.dom){let i=this.itemWithRef("input").dom;i&&(i.checked=e)}this.m_props.checked=e}get text(){return this.itemWithRef("label").text}set text(e){this.itemWithRef("label").text=e}toggle(){this.check=!this.check}};l(ke,"CheckBox");var vs={lightsalmon:4294942842,lightseagreen:4280332970,lightskyblue:4287090426,lightslategray:4286023833,lightsteelblue:4289774814,lightyellow:4294967264,lime:4278255360,limegreen:4281519410,linen:4294635750,magenta:4294902015,maroon:4286578688,mediumaquamarine:4284927402,mediumblue:4278190285,mediumorchid:4290401747,mediumpurple:4287852763,mediumseagreen:4282168177,mediumslateblue:4286277870,mediumspringgreen:4278254234,mediumturquoise:4282962380,mediumvioletred:4291237253,midnightblue:4279834992,mintcream:4294311930,mistyrose:4294960353,moccasin:4294960309,navajowhite:4294958765,navy:4278190208,oldlace:4294833638,olive:4286611456,olivedrab:4285238819,orange:4294944e3,orangered:4294919424,orchid:4292505814,palegoldenrod:4293847210,palegreen:4288215960,paleturquoise:4289720046,palevioletred:4292571283,papayawhip:4294963157,peachpuff:4294957753,peru:4291659071,pink:4294951115,plum:4292714717,powderblue:4289781990,purple:4286578816,red:4294901760,rosybrown:4290547599,royalblue:4282477025,saddlebrown:4287317267,salmon:4294606962,sandybrown:4294616160,seagreen:4281240407,seashell:4294964718,sienna:4288696877,silver:4290822336,skyblue:4287090411,slateblue:4285160141,slategray:4285563024,snow:4294966010,springgreen:4278255487,steelblue:4282811060,tan:4291998860,teal:4278222976,thistle:4292394968,tomato:4294927175,turquoise:4282441936,violet:4293821166,wheat:4294303411,white:4294967295,whitesmoke:4294309365,yellow:4294967040,yellowgreen:4288335154,aliceblue:4293982463,antiquewhite:4294634455,aqua:4278255615,aquamarine:4286578644,azure:4293984255,beige:4294309340,bisque:4294960324,black:4278190080,blanchedalmond:4294962125,blue:4278190335,blueviolet:4287245282,brown:4289014314,burlywood:4292786311,cadetblue:4284456608,chartreuse:4286578432,chocolate:4291979550,coral:4294934352,cornflowerblue:4284782061,cornsilk:4294965468,crimson:4292613180,cyan:4278255615,darkblue:4278190219,darkcyan:4278225803,darkgoldenrod:4290283019,darkgray:4289309097,darkgreen:4278215680,darkkhaki:4290623339,darkmagenta:4287299723,darkolivegreen:4283788079,darkorange:4294937600,darkorchid:4288230092,darkred:4287299584,darksalmon:4293498490,darkseagreen:4287609999,darkslateblue:4282924427,darkslategray:4281290575,darkturquoise:4278243025,darkviolet:4287889619,deeppink:4294907027,deepskyblue:4278239231,dimgray:4285098345,dodgerblue:4280193279,firebrick:4289864226,floralwhite:4294966e3,forestgreen:4280453922,fuchsia:4294902015,gainsboro:4292664540,ghostwhite:4294506751,gold:4294956800,goldenrod:4292519200,gray:4286611584,green:4278222848,greenyellow:4289593135,honeydew:4293984240,hotpink:4294928820,indianred:4291648604,indigo:4283105410,ivory:4294967280,khaki:4293977740,lavender:4293322490,lavenderblush:4294963445,lawngreen:4286381056,lemonchiffon:4294965965,lightblue:4289583334,lightcoral:4293951616,lightcyan:4292935679,lightgoldenrodyellow:4294638290,lightgreen:4287688336,lightgrey:4292072403,lightpink:4294948545,none:0,transparent:0},R=class{m_value;constructor(e,t,i,s){let n=arguments.length,r=this;function a(){if(!n)return 4278190080;if(n==1)return Number.isSafeInteger(e)?4278190080|e&16777215:r._getCustomColor(e);if(n==2){let h,m=((t*255|0)&255)<<24;return Number.isSafeInteger(e)?h=e:h=r._getCustomColor(e),h&16777215|m}else if(n==4&&s!==void 0&&s<=1)return s<=0?0:(s=s*255,s|=0,(s&255)<<24|(e&255)<<16|(t&255)<<8|i&255);return 4278190080|(e&255)<<16|(t&255)<<8|i&255}l(a,"_init"),this.m_value=a()}_shade(e){let t=e<0?0:255,i=e<0?-e:e,s=this._split();return new R(Math.round((t-s.r)*i)+s.r,Math.round((t-s.g)*i)+s.g,Math.round((t-s.b)*i)+s.b,s.a/255)}darken(e){return e<0&&(e=0),e>100&&(e=100),this._shade(-e/100)}lighten(e){return e<0&&(e=0),e>100&&(e=100),this._shade(e/100)}static mix(e,t,i){let s=e._split(),n=t._split(),r=s.a===n.a?s.a:Math.round(n.a*i+s.a*(1-i)),a=s.r===n.r?s.r:Math.round(n.r*i+s.r*(1-i)),h=s.g===n.g?s.g:Math.round(n.g*i+s.g*(1-i)),m=s.b===n.b?s.b:Math.round(n.b*i+s.b*(1-i));return new R(a,h,m,r/255)}_split(){let e=this.m_value;return{a:e>>24&255,r:e>>16&255,g:e>>8&255,b:e&255}}fadeout(e){let t=this._split();if(t.a=t.a/255,t.a=t.a-t.a*e/100,t.a>1)t.a=1;else if(t.a<=0)return R.NONE;return new R(t.r,t.g,t.b,t.a)}static fromHSV(e,t,i,s=1){let n=Math.min(5,Math.floor(e*6)),r=e*6-n,a=i*(1-t),h=i*(1-r*t),m=i*(1-(1-r)*t),c,d,p;switch(n){case 0:c=i,d=m,p=a;break;case 1:c=h,d=i,p=a;break;case 2:c=a,d=i,p=m;break;case 3:c=a,d=h,p=i;break;case 4:c=m,d=a,p=i;break;case 5:c=i,d=a,p=h;break}return new R(c*255,d*255,p*255,s)}static toHSV(e){let t=e._split();t.r/=255,t.g/=255,t.b/=255,t.a/=255;let i=Math.max(t.r,t.g,t.b),s=Math.min(t.r,t.g,t.b),n=i-s,r=i===0?0:n/i,a=i,h;if(n===0)h=0;else switch(i){case t.r:h=(t.g-t.b)/n/6+(t.g<t.b?1:0);break;case t.g:h=(t.b-t.r)/n/6+1/3;break;case t.b:h=(t.r-t.g)/n/6+2/3;break}return{h,s:r,v:a,a:t.a}}static fromHLS(e,t,i){let s,n,r;if(i==0)s=n=r=t;else{let h=function(d,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?d+(p-d)*6*g:g<1/2?p:g<2/3?d+(p-d)*(2/3-g)*6:d};var a=h;l(h,"hue2rgb");let m=t<.5?t*(1+i):t+i-t*i,c=2*t-m;s=h(c,m,e+1/3),n=h(c,m,e),r=h(c,m,e-1/3)}return s=(s*255|0)&255,n=(n*255|0)&255,r=(r*255|0)&255,new R(s,n,r)}static toHLS(e){let t=e.m_value,i=(t>>16&255)/255,s=(t>>8&255)/255,n=(t&255)/255,r=i,a=i;s<r&&(r=s),n<r&&(r=n),s>a&&(a=s),n>a&&(a=n);let h=0,m=0,c=0,d=a-r,p=a+r,g=.5*p,x,_;if(a!=r)h=(a-i)/d,m=(a-s)/d,c=(a-n)/d;else return{h:0,l:g,s:0};return g<.5?x=d/p:x=d/(2-p),i==a?_=60*(6+c-m):s==a?_=60*(2+h-c):_=60*(4+m-h),_>360&&(_=_-360),{h:_/360,l:g,s:x}}red(){return this.m_value>>16&255}green(){return this.m_value>>8&255}blue(){return this.m_value&255}alpha(){return(this.m_value>>24&255)/255}value(){return this.m_value}toString(){if(this.m_value===0)return"transparent";let t=this._split();if(t.a===255)return`rgb(${t.r},${t.g},${t.b})`;{t.a/=255;let i=t.a.toFixed(3);return`rgba(${t.r},${t.g},${t.b},${i})`}}toHex(e=!0){if(this.m_value===0)return"transparent";let i=this._split();return i.a===255||!e?`#${Ke(i.r)}${Ke(i.g)}${Ke(i.b)}`:`#${Ke(i.r)}${Ke(i.g)}${Ke(i.b)}${Ke(i.a)}`}static addCustomColor(e,t){R.custom[e]=t}static addCssColor(e){let t=he.getVar(e);R.custom["css:"+e]=R.parse(t.trim())}static parse(e){let t;if(e[0]=="#"){if((t=/#(?<r>[a-fA-F0-9]{2})(?<g>[a-fA-F0-9]{2})(?<b>[a-fA-F0-9]{2})(?<a>[a-fA-F0-9]{2})?/.exec(e))!==null){let n=t.groups;return new R(parseInt(n.r,16),parseInt(n.g,16),parseInt(n.b,16),n.a!==void 0?parseInt(n.a,16)/255:1)}if((t=/#(?<r>[a-fA-F0-9])(?<g>[a-fA-F0-9])(?<b>[a-fA-F0-9])/.exec(e))!==null){let n=t.groups,r=parseInt(n.r,16),a=parseInt(n.g,16),h=parseInt(n.b,16);return new R(r<<4|r,a<<4|a,h<<4|h,1)}}if(e[0]=="r"){if((t=/rgb\(\s*(?<r>\d+)\s*\,\s*(?<g>\d+)\s*\,\s*(?<b>\d+)\s*\)/.exec(e))!==null){let n=t.groups;return new R(parseInt(n.r,10),parseInt(n.g,10),parseInt(n.b,10),1)}if((t=/rgba\(\s*(?<r>\d+)\s*\,\s*(?<g>\d+)\s*\,\s*(?<b>\d+)\s*\,\s*(?<a>[0-9.]+)\s*\)/.exec(e))!==null){let n=t.groups;return new R(parseInt(n.r,10),parseInt(n.g,10),parseInt(n.b,10),parseFloat(n.a))}}return console.log("invalid color value: "+e),new R(0)}_getCustomColor(e){if(e===null)return 0;let t=vs[e];return t!==void 0?t:R.custom[e]!==void 0?R.custom[e].m_value:e.substr(0,4)=="css:"?(R.addCssColor(e.substr(4)),R.custom[e].m_value):R.parse(e).m_value}static contrastColor(e){let t=e._split();return(.299*t.r+.587*t.g+.114*t.b)/255>.5?R.BLACK:R.WHITE}static valueFromColorName(e){let t=vs[e];return t?new R(t):null}static fromCssVar(e){return new R(e).toString()}},V=R;l(V,"Color"),F(V,"custom",[]),F(V,"WHITE",new R(255,255,255)),F(V,"BLACK",new R(0,0,0)),F(V,"NONE",new R(0,0,0,0));function Ke(o){return("00"+o.toString(16)).substr(-2).toUpperCase()}l(Ke,"_hx");var In=1e4;function Gi(o){let e,t=o.url,i=o.method||"GET",s=!1;o.params instanceof FormData?(e=o.params,s=!0):i=="POST"?e=Cs(o.params,!1):t+=Cs(o.params,!0),t=encodeURI(t);let n=new XMLHttpRequest;if(n.open(i,t),n.upload.addEventListener("progress",r,!1),n.addEventListener("timeout",h),n.addEventListener("error",h),n.addEventListener("load",m),s||n.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i!="POST"&&(n.responseType=o.responseType||"json",n.timeout=o.timeout||In),o.headers)for(let c in o.headers)n.setRequestHeader(c,o.headers[c]);function r(c){if(console.log(c),o.progress)try{if(c.lengthComputable){let d=a(c.loaded)+" / "+a(c.total);o.progress(c.loaded,c.total,d)}}catch(d){console.error("unhandled exception:",d)}}l(r,"progress");function a(c){let d,p;return c>=1e9?(d="Gb",p=c/1e9):c>=1e6?(d="Mb",p=c/1e6):c>=1e3?(d="Kb",p=c/1e3):(d="bytes",p=c),p.toFixed(2)+d}l(a,"humanSize");function h(){o.failure&&o.failure(n.status,n.statusText,o.userData)}l(h,"failure");function m(){if(n.status>=200&&n.status<300){if(o.success)try{o.success(n.response,o.userData)}catch(c){console.error("unhandled exception:",c)}}else h()}return l(m,"success"),s||i=="POST"?n.send(e):n.send(),function(){n.abort()}}l(Gi,"ajaxRequest");function Cs(o,e){if(!o)return"";let t=[];for(let s in o){let n=o[s];if($(n))for(let r=0,a=n.length;r<a;r++)t.push(encodeURIComponent(s)+"[]="+encodeURIComponent(""+n[r]));else n===void 0&&(n=""),t.push(encodeURIComponent(s)+"="+encodeURIComponent(""+n))}let i=t.join("&");return e?"?"+i:i}l(Cs,"buildQuery");async function Dn(o,e){return(await $i(o,e,"application/json")).json()}l(Dn,"ajaxAsJSON");async function Pn(o,e){return(await $i(o,e,"text/plain")).text()}l(Pn,"ajaxAsText");async function $i(o,e,t){let i={method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}};if(t&&(i.headers["Content-Type"]=t),e&&(i={...i,...e},e.body&&!B(e.body))){let n=!1;(Wi(e.body)||!(e.body instanceof Blob)&&!(e.body instanceof ArrayBuffer)&&!(e.body instanceof FormData)&&!(e.body instanceof URLSearchParams)&&!(e.body instanceof ReadableStream))&&(n=!0),n?i.body=JSON.stringify(e.body):i.body=e.body}let s=await fetch(o,i);if(e&&e.noGenX)return s;if(!s.ok)throw new Je(s);return s}l($i,"ajax");function mt(o,e){return S({type:o,id:e})}l(mt,"EvDataChange");var mi=class{name;id;fields;constructor(e){this.name=e,this.id=void 0,this.fields=[]}};l(mi,"MetaInfos");var hi=Symbol("metaField");function ci(o,e=!0){let t=o.constructor,i=t.hasOwnProperty(hi)?t[hi]:void 0;if(i===void 0){e||console.assert(i!==void 0),i=new mi(t.name);let s=Object.getPrototypeOf(t);if(s!=Ge){let n=s[hi];i.fields=[...n.fields,...i.fields],console.assert(i.id===void 0,"cannot define mutiple record id"),i.id||(i.id=n.id)}o.constructor[hi]=i}return i}l(ci,"_getMetas");var ws;(m=>{function o(){return(c,d)=>{let p=ci(c);p.fields.push({name:d,type:"any",required:!0}),p.id=d}}m.id=o,l(o,"id");function e(c){return(d,p)=>{ci(d).fields.push({name:p,...c})}}m.field=e,l(e,"field");function t(c){return e({...c,type:"string"})}m.string=t,l(t,"string");function i(c){return e({...c,type:"int"})}m.int=i,l(i,"int");function s(c){return e({...c,type:"float"})}m.float=s,l(s,"float");function n(c){return e({...c,type:"bool"})}m.bool=n,l(n,"bool");function r(c){return e({...c,type:"date"})}m.date=r,l(r,"date");function a(c){return e({...c,type:"calc"})}m.calc=a,l(a,"calc");function h(c,d){return m.field({...d,type:"array",model:c?new c:null})}m.array=h,l(h,"array")})(ws||={});var Ge=class{constructor(e,t){e!==void 0&&this.unSerialize(e,t)}clone(e){let t=new this.constructor;return e&&t.unSerialize(e),t}getID(){let e=ci(this,!1);return this[e.id]}getFields(){return ci(this,!1).fields}validate(){let e=null;return this.getFields().forEach(i=>{i.required&&!this.getField(i.name)&&(e&&(e=[]),e.push(new Error(`field ${i.name} is required.`)))}),e}getFieldIndex(e){return this.getFields().findIndex(i=>i.name==e)}serialize(){let e={};return this.getFields().forEach(t=>{t.calc===void 0&&(e[t.name]=e[t.name])}),e}unSerialize(e,t){let i=this.getFields();return i.forEach(s=>{let n=e[s.name];n!==void 0&&(this[s.name]=this._convertField(s,n))}),t!==void 0?this[i[0].name]=t:console.assert(this.getID()!==void 0),this}_convertField(e,t){switch(e.type){case"float":{let i=typeof t=="number"?t:parseFloat(t);if(e.prec!==void 0){let s=Math.pow(10,e.prec);i=Math.round(i*s)/s}return i}case"int":return typeof t=="number"?t:parseInt(t);case"date":return B(t)?new Date(t):t;case"array":{let i=[];if(e.model)return t.forEach(s=>{i.push(e.model.clone(s))}),i;break}}return t}getRaw(e){let t,i=this.getFields();if(typeof e=="string"){if(t=i.findIndex(n=>n.name==e),t<0){console.assert(!1,"unknown field: "+e);return}}else if(e<i.length){if(e<0)return;t=e}else{console.assert(!1,"bad field name: "+e);return}let s=i[t];return s.calc!==void 0?s.calc(this):this[s.name]}setRaw(e,t){this[e]=t}getField(e){let t=this.getRaw(e);return t==null?"":""+t}setField(e,t){let i=this.getFields(),s=i.findIndex(r=>r.name==e);if(s<0){console.assert(!1,"unknown field: "+e);return}let n=i[s];if(n.calc!==void 0){console.assert(!1,"cannot set calc field: "+e);return}this.setRaw(n.name,t)}};l(Ge,"Record");var ct=class extends Ge{m_data;m_fid;constructor(e){super(),this.m_data=e}getID(){if(!this.m_fid){let e=Object.keys(this.m_data);this.m_fid=e[0]}return this.m_data[this.m_fid]}getFields(){return Object.keys(this.m_data).map(i=>({name:i}))}getRaw(e){return this.m_data[e]}setRaw(e,t){this.m_data[e]=t}clone(e){return new ct({...e})}};l(ct,"AutoRecord");var At=class extends ae{constructor(e){super(e)}async load(e){e?this.m_props.url=e:e=this.m_props.url,this.m_props.params&&(e+="?"+this.m_props.params.join("&"));let t=await fetch(e);if(t.ok){let i=await t.json(),s=i;this.m_props.solver&&(s=this.m_props.solver(s)),this.emit("change",M(s,i))}}};l(At,"DataProxy");var Le=class extends me{m_model;m_fields;m_records;m_proxy;m_rec_index;constructor(e){super(),this.m_fields=void 0,this.m_records=[],this.m_rec_index=null,this.m_model=e.model,this.m_fields=e.model.getFields(),e.data?this.setRawData(e.data):e.url&&(this.m_proxy=new At({url:e.url,solver:e.solver,events:{change:t=>{this.setData(t.value)}}}),e.autoload!=!1&&this.m_proxy.load())}async load(e){return this.m_proxy.load(e)}async reload(){return this.m_proxy.load()}setData(e){let t=[];e.forEach(i=>{t.push(this.m_model.clone(i))}),this.setRawData(t)}setRawData(e){this.m_records=e,this._rebuildIndex(),this.emit("data_change",mt("change"))}_rebuildIndex(){this.m_rec_index=null,this.m_rec_index=this.createIndex(null),this.m_rec_index=this.sortIndex(this.m_rec_index,null)}update(e){let t=e.getID(),i=this.indexOfId(t);return i<0?!1:(this.m_records[this.m_rec_index[i]]=e,this.emit("data_change",mt("update",t)),!0)}append(e){e instanceof Ge||(e=this.m_model.clone().unSerialize(e)),console.assert(e.getID()),this.m_records.push(e),this._rebuildIndex(),this.emit("data_change",mt("create",e.getID()))}getMaxId(){let e;return this.m_records.forEach(t=>{let i=t.getID();(e===void 0||e<i)&&(e=i)}),e}delete(e){let t=this.indexOfId(e);return t<0?!1:(t=this.m_rec_index[t],this.m_records.splice(t,1),this._rebuildIndex(),this.emit("data_change",mt("delete",e)),!0)}get count(){return this.m_rec_index?this.m_rec_index.length:this.m_records.length}get fields(){return this.m_fields}indexOfId(e){for(let t=this.count,i=0;t!=0;t>>=1){let s=i+(t>>1),n=this.m_rec_index[s],r=this.m_records[n].getID();if(r==e)return s;r<e&&(i=s+1,t--)}return-1}getById(e){let t=this.indexOfId(e);return t<0?null:(t=this.m_rec_index[t],this.m_records[t])}getByIndex(e){let t=this.m_rec_index[e];return this._getRecord(t)}_getRecord(e){return this.m_records[e]??null}moveTo(e){e.setRawData(this.m_records)}createView(e){let t={...e,store:this};return new Tt(t)}createIndex(e){if(e&&e.op==="empty-result")return new Uint32Array(0);let t=new Uint32Array(this.m_records.length),i=0;if(!e)this.forEach((d,p)=>{t[i++]=p});else if(typeof e.op=="function"){let d=e.op;this.forEach((p,g)=>{p&&d(p)&&(t[i++]=g)})}else{let g=function(E){return E<p},x=function(E){return E<=p},_=function(E){return E==p},y=function(E){return E!=p},A=function(E){return E>=p},P=function(E){return E>p},W=function(E){return b.lastIndex=-1,b.test(E)};var s=g,n=x,r=_,a=y,h=A,m=P,c=W;l(g,"_lt"),l(x,"_le"),l(_,"_eq"),l(y,"_neq"),l(A,"_ge"),l(P,"_gt"),l(W,"_re");let d=this.m_model.getFieldIndex(e.field);if(d<0)return console.assert(!1,"unknown field name in filter"),new Uint32Array(0);let p=e.value;B(p)&&!e.caseSensitive&&(p=p.toUpperCase());let D,b;if(p instanceof RegExp)b=p,D=W;else switch(e.op){case"<":{D=g;break}case"<=":{D=x;break}case"=":{D=_;break}case">=":{D=A;break}case">":{D=P;break}case"<>":{D=y;break}}this.forEach((E,N)=>{if(!E)return;let C=E.getRaw(d);C==null?C="":(C=""+C,e.caseSensitive||(C=C.toUpperCase())),D(C)&&(t[i++]=N)})}return t.slice(0,i)}sortIndex(e,t){let i=0,s=[];if(t===null?s.push({fidx:0,asc:!0}):s=t.map(n=>{let r=this.m_model.getFieldIndex(n.field);return r==-1&&(console.assert(!1,"unknown field name in sort"),i++),{fidx:r,asc:n.ascending}}),i||s.length==0)return e;if(s.length==1){let n=s[0].fidx;e.sort((r,a)=>{let h=this.getByIndex(r).getRaw(n)??"",m=this.getByIndex(a).getRaw(n)??"";return h>m?1:h<m?-1:0}),s[0].asc||e.reverse()}else e.sort((n,r)=>{for(let a=0;a<s.length;a++){let h=s[a].fidx,m=s[a].asc?1:-1,c=this.getByIndex(n).getRaw(h)??"",d=this.getByIndex(r).getRaw(h)??"";if(c>d)return m;if(c<d)return-m}return 0});return e}forEach(e){this.m_rec_index?this.m_rec_index.some((t,i)=>{if(e(this.m_records[t],i))return i}):this.m_records.some((t,i)=>{if(t&&e(t,i))return i})}export(){return this.m_records}changed(){this.emit("data_change",mt("change"))}};l(Le,"DataStore");function St(o){return S({action:o})}l(St,"EvViewChange");var Tt=class extends ae{m_index;m_store;m_sort;m_filter;constructor(e){super(e),this.m_store=e.store,this.m_index=null,this.m_filter=null,this.m_sort=null,this.filter(e.filter),e.order?B(e.order)?this.sort([{field:e.order,ascending:!0}]):$(e.order)?this.sort(e.order):this.sort([e.order]):this.sort(null),this.m_store.on("data_change",t=>this._storeChange(t))}_storeChange(e){this._filter(this.m_filter,e.type!="change"),this._sort(this.m_sort,e.type!="change"),this.emit("view_change",St("change"))}filter(e){return this.m_index=null,this._filter(e,!0)}_filter(e,t){return this.m_index=this.m_store.createIndex(e),this.m_filter=e,this.m_sort&&this.sort(this.m_sort),t&&this.emit("view_change",St("filter")),this.m_index.length}sort(e){this._sort(e,!0)}_sort(e,t){this.m_index=this.m_store.sortIndex(this.m_index,e),this.m_sort=e,t&&this.emit("view_change",St("sort"))}get store(){return this.m_store}get count(){return this.m_index.length}indexOfId(e){let t=this.m_store.indexOfId(e);return this.m_index.findIndex(i=>i===t)}getByIndex(e){if(e>=0&&e<this.m_index.length){let t=this.m_index[e];return this.m_store.getByIndex(t)}return null}getById(e){return this.m_store.getById(e)}changed(){this.emit("view_change",St("change"))}forEach(e){this.m_index.some(t=>{let i=this.m_store.getByIndex(t);if(i&&e(i,t))return t})}};l(Tt,"DataView");var Ie=class extends w{m_ui_input;m_ui_button;m_popup;m_lockpop;m_lockchg;m_popvis;m_selection;constructor(e){super(e),e.editable||this.setDomEvent("keypress",()=>this.showPopup()),this.setDomEvent("click",()=>{this.m_props.editable&&this.m_ui_input.focus(),this.showPopup()}),this.setDomEvent("keydown",t=>this._onKey(t)),this.mapPropEvents(e,"selectionChange"),this.m_popvis=!1,this.m_lockpop=!1,this.m_lockchg=!1}_onKey(e){this.m_popvis&&(e.key=="ArrowUp"||e.key=="ArrowDown"?(this.m_lockpop=!0,this.m_popup.handleKey(e),this.m_lockpop=!1,e.preventDefault(),e.stopPropagation()):e.key=="Escape"&&(this._hidePopup(),e.preventDefault(),e.stopPropagation()))}set items(e){this.m_props.items=e,this.m_popup&&(this.m_popup.items=e)}render(e){if(e.renderer)this.m_ui_input=new u({flex:1,cls:"@fake-input @hlayout",tabIndex:1});else{this.setClass("@required",e.required);let n=new j({flex:1,readOnly:!this.m_props.editable,tabIndex:0,name:e.name,value_hook:{get:()=>this.value,set:r=>{this.value=r}},dom_events:{focus:()=>{this.clearError(),this.m_props.editable&&n.value.length==0&&this.showPopup()},input:()=>{if(this.m_lockchg)return;let r=n.value;this.m_selection={id:void 0,text:r};let a=this.showPopup();a&&a.length&&a[0].text==r&&(this.m_selection={id:a[0].id,text:r})}}});this.m_ui_input=n}let t,i,s=e.labelWidth??0;s>0?t=s:s<0&&(i=-s),this.setContent([new I({cls:"label1"+(e.label?"":" @hidden"),text:e.label,width:t,flex:i,align:e.labelAlign}),new w({flex:1,content:[this.m_ui_input,this.m_ui_button=new z({cls:"gadget",icon:"var( --x4-icon-angle-down )",tabIndex:!1,click:()=>{this.showPopup(!1)},dom_events:{focus:()=>{this.clearError(),this.dom.focus()}}})]})]),e.value!==void 0&&(this.value=e.value)}componentDisposed(){this.m_popup&&this.m_popup.close(),super.componentDisposed()}showPopup(e=!0){let t=this.m_props;if(t.readOnly||this.hasClass("@disable"))return null;let i=t.items;if(Z(i)){let r=e?this.m_ui_input.value:null;i=i(r)}if(i.length==0)return null;if(!this.m_popup){let r=this.getComputedStyle(),a=r.value("fontFamily"),h=r.value("fontSize");this.m_popup=new Te({cls:"@combo-popup",populate:t.populate,renderItem:this.m_props.renderer,selectionChange:m=>{this._selectItem(m),this.m_lockpop||(this._hidePopup(),this.focus())},cancel:m=>this.signal("cancel",m),style:{fontFamily:a,fontSize:h}})}this.m_popup.items=i;let s=this.m_ui_button.getBoundingRect(),n=this.m_ui_input.getBoundingRect();return this.m_popup.setStyle({minWidth:s.right-n.left}),this.m_popup.displayAt(n.left,n.bottom),this.m_popvis=!0,this.startTimer("focus-check",100,!0,()=>this._checkFocus()),this.value!==void 0&&(this.m_popup.selection=this.value),i}validate(){return this.m_props.required&&!this.m_selection?(this.showError(k.global.required_field),!1):!0}showError(e){this.m_ui_input.showError(e)}clearError(){this.m_ui_input.clearError()}_selectItem(e){let t=e.selection;t&&(this.m_lockchg=!0,this._setInput(t,!0),this.m_lockchg=!1,this.m_selection={id:t.id,text:t.text},this.emit("selectionChange",ie(t)),this.emit("change",M(t.id)))}_setInput(e,t=!1){e?this.m_ui_input?this.m_ui_input instanceof j?(this.m_ui_input.value=e.text,t&&this.m_ui_input.dom.dispatchEvent(new Event("input"))):this.m_ui_input.setContent(this.m_props.renderer(e)):this.m_props.value=e.id:this.m_ui_input&&this.m_ui_input instanceof j&&(this.m_ui_input.value="")}get value(){return this.m_selection?this.m_selection.id:void 0}get valueText(){return this.m_selection?this.m_selection.text:this.m_props.editable?this.m_ui_input.value:""}set value(e){let t=this.m_props.items;Z(t)&&(t=t(null)),t.some(s=>{if(s.id===e)return this._setInput(s),this.m_selection=s,!0})||(this._setInput(null),this.m_selection=null)}get input(){return this.m_ui_input instanceof j?this.m_ui_input:null}_checkFocus(){let e=document.activeElement;this.dom&&this.dom.contains(e)||e==document.body||this.m_popup&&this.m_popup.dom&&this.m_popup.dom.contains(e)||this._hidePopup()}_hidePopup(){this.m_popvis&&(this.m_popup.close(),this.m_popvis=!1,this.stopTimer("focus-check"))}static storeProxy(e){let t=e.store instanceof Le?e.store.createView():e.store;return()=>{let i=new Array(e.store.count);return e.store.forEach((s,n)=>{i[n]={id:s.getID(),text:e.display(s)}}),i}}focus(){this.m_props.editable?this.m_ui_input.focus():super.focus()}};l(Ie,"ComboBox");var ut=class extends H{m_height;m_container;m_buttons;m_dirty;m_watchChanges;constructor(e){let t=e.content;e.content=null;let i=e.height;e.height=void 0,super(e),this.setTag(e.disableSuggestions?"section":"form"),this.mapPropEvents(e,"btnClick","dirty"),this.updateContent(t,e.buttons,i),this.m_dirty=!1,this.m_watchChanges=!1}get container(){return this.m_container}componentCreated(){super.componentCreated(),this.m_watchChanges&&this.watchChanges()}updateContent(e,t,i=0){i&&(this.m_height=i),this._makeButtons(t);let s=[this.m_container=new H({cls:"container",height:this.m_height,content:e}),this.m_buttons];super.setContent(s)}setContent(e,t=!0){this.m_container.setContent(e,t)}setButtons(e){this._makeButtons(e)}enableButton(e,t=!0){let i=this.getButton(e);i&&i.enable(t)}getButton(e){return this.m_buttons?.itemWithRef("@"+e)}_makeButtons(e){this.m_buttons||(this.m_buttons=new w({cls:"footer",ref:"buttons"}));let t=[];if(e)for(let i of e)if(i instanceof u)t.push(i);else switch(i){case"ok":{t.push(new z({ref:"@"+i,text:k.global.ok,click:()=>{this._click(i)}}));break}case"cancel":{t.push(new z({ref:"@"+i,text:k.global.cancel,click:()=>{this._click(i)}}));break}case"ignore":{t.push(new z({ref:"@"+i,text:k.global.ignore,click:()=>{this._click(i)}}));break}case"yes":{t.push(new z({ref:"@"+i,text:k.global.yes,click:()=>{this._click(i)}}));break}case"no":{t.push(new z({ref:"@"+i,text:k.global.no,click:()=>{this._click(i)}}));break}case"close":{t.push(new z({ref:"@"+i,text:k.global.close,click:()=>{this._click(i)}}));break}case"save":{t.push(new z({ref:"@"+i,text:k.global.save,click:()=>{this._click(i)}}));break}case"dontsave":{t.push(new z({ref:"@"+i,text:k.global.dontsave,click:()=>{this._click(i)}}));break}}t.length==1&&t[0].setAttribute("autofocus",!0),this.m_buttons.setContent(t)}validate(){let e=this.queryAll("input"),t=!0;for(let i=0;i<e.length;i++){let s=u.getElement(e[i],U);if(s&&!s.validate())t=!1;else{let n=u.getElement(e[i],Ie);n&&!n.validate()&&(t=!1)}}return t}_click(e){this.emit("btnClick",qi(e))}_getElements(){return console.assert(!!this.dom),this.queryAll("[name]")}setValues(e){let t=this._getElements();for(let i=0;i<t.length;i++){let s=t[i],n=u.getElement(s);if(!n.hasAttribute("name"))continue;let r=n.getAttribute("name"),a=n.getAttribute("type");e[r]!==void 0&&n.setStoreValue(e[r])}this.setDirty(!1)}clearValues(){let e=this._getElements();for(let t=0;t<e.length;t++){let i=e[t],s=u.getElement(i);s.hasAttribute("name")&&s.setStoreValue(null)}this.setDirty(!1)}getValues(){let e=this._getElements(),t={};for(let i=0;i<e.length;i++){let s=e[i],n=u.getElement(s);if(!n.hasAttribute("name"))continue;let r=n.getAttribute("name"),a=n.getStoreValue();a!==void 0&&(t[r]=a)}return t}submit(e,t){if(!this.validate())return!1;let i=this.getValues();if(t&&!t(i))return!1;let s=new FormData;for(let n in i)i.hasOwnProperty(n)&&s.append(n,i[n]===void 0?"":i[n]);return e.params=s,Gi(e)}watchChanges(){this.dom?(this.queryAll("input[name], textarea[name]").forEach(t=>{J(t).setDomEvent("input",()=>{this.setDirty()})}),this.m_watchChanges=!1):this.m_watchChanges=!0}setDirty(e=!0){this.m_dirty=e,this.emit("dirty",{dirty:e})}isDirty(){return this.m_dirty}};l(ut,"Form");function qi(o){return S({button:o})}l(qi,"EvBtnClick");var De=class extends q{m_icon;m_title;m_form;m_buttons;m_closable;m_movable;m_maximized;m_minimized;m_maximizable;m_minimizable;m_minFormSize;m_rc_max;m_rc_min;m_el_title;m_last_down;m_auto_close;m_ui_title;m_form_cb;constructor(e){let t=e.content;e.content=null;let i=e.width,s=e.height;e.width=void 0,e.height=void 0,super(e),this.m_minFormSize={width:i,height:s},this.enableMask(!0),e.form?Z(e.form)?this.m_form_cb=e.form:(this.m_form=e.form,this.m_form.on("btnClick",n=>this._handleClick(n))):this.m_form=new ut({content:t,buttons:e.buttons,disableSuggestions:e.disableSuggestions,btnClick:n=>this._handleClick(n)}),this.m_movable=e.movable,this.m_auto_close=e.autoClose??!0,this.m_icon=e.icon,this.m_title=e.title,this.m_buttons=e.buttons??null,this.m_closable=e.closable??!1,this.m_last_down=0,this.on("size",n=>{this.addClass("@resized"),this.m_form.setStyleValue("width",null),this.m_form.setStyleValue("height",null)}),this.m_maximized=!1,this.m_minimized=!1,this.m_maximizable=!1,this.m_minimizable=!1,e.maximizable!==void 0&&(this.m_maximizable=e.maximizable),e.minimizable!==void 0&&(this.m_minimizable=e.minimizable),e.maximized==!0&&(this.m_maximizable=!0),e.btnClick&&this.on("btnClick",e.btnClick)}componentCreated(){super.componentCreated(),this.m_minFormSize.width&&this.m_form.setStyle({minWidth:this.m_minFormSize.width,width:this.m_minFormSize.width}),this.m_minFormSize.height&&this.m_form.setStyle({minHeight:this.m_minFormSize.height,height:this.m_minFormSize.height});let e=this.getBoundingRect();this.setStyleValue("min-width",e.width),this.setStyleValue("min-height",e.height),this.setStyleValue("width",e.width),this.setStyleValue("height",e.height),this.m_props.dlgWidth&&this.setStyleValue("width",this.m_props.dlgWidth+"%"),this.m_props.dlgHeight&&this.setStyleValue("height",this.m_props.dlgHeight+"%"),this.addClass("@resized"),this.m_el_title&&this.m_el_title.setStyleValue("width","auto"),this.m_props.maximized?(this._maximize(),this.emit("size",Q(null))):this.centerOnScreen()}_handleClick(e){this.emit("btnClick",e),e.defaultPrevented||this.close()}setGeometry(e){e.minimized&&this.m_minimizable?(this._minimize(!1),this.m_rc_min=new X(e.left,e.top,e.width,e.height),this.displayAt(e.left,e.top,"top-left")):e.maximized&&this.m_maximizable?(this._maximize(!1),this.m_rc_max=new X(e.left,e.top,e.width,e.height)):(this.setSize(e.width,e.height),this.displayAt(e.left,e.top,"top-left"))}getGeometry(){if(this.m_minimized)return{left:this.m_rc_min.left,top:this.m_rc_min.top,width:this.m_rc_min.width,height:this.m_rc_min.height,minimized:!0,maximized:!1};if(this.m_maximized)return{left:this.m_rc_max.left,top:this.m_rc_max.top,width:this.m_rc_max.width,height:this.m_rc_max.height,minimized:!1,maximized:!0};let e=this.getBoundingRect();return{left:e.left,top:e.top,width:e.width,height:e.height,minimized:!1,maximized:!1}}setSize(e,t){this.setStyle({width:e,height:t}),this.emit("size",Q({width:e,height:t}))}render(){this.m_form_cb&&(this.m_form=this.m_form_cb(),this.m_form.on("btnClick",t=>this._handleClick(t)),this.m_form_cb=null);let e=this.m_icon!==void 0||this.m_closable||this.m_title!==void 0||this.m_movable;this.m_el_title=null,e&&(this.m_el_title=new w({cls:"title",content:[this.m_icon?new L({icon:this.m_icon}):null,this.m_ui_title=new I({flex:1,text:this.m_title}),this.m_minimizable?new L({cls:"min-btn",icon:"var( --x4-icon-window-minimize )",dom_events:{click:()=>this._toggleMin()}}):null,this.m_maximizable?new L({cls:"max-btn",icon:"var( --x4-icon-window-maximize )",dom_events:{click:()=>this._toggleMax()}}):null,this.m_maximizable?new L({cls:"res-btn",icon:"var( --x4-icon-window-restore )",dom_events:{click:()=>this._toggleMax()}}):null,this.m_closable?new L({cls:"close-btn",icon:"var( --x4-icon-rectangle-times )",dom_events:{click:()=>this.close()}}):null]}),this.m_movable&&(vt()?this.m_el_title.setDomEvent("touchstart",t=>this._mouseDown(t)):this.m_el_title.setDomEvent("mousedown",t=>this._mouseDown(t)))),super.setContent([this.m_el_title,this.m_form])}setContent(e,t=!0){this.m_form.setContent(e,t)}setButtons(e){this.m_form.setButtons(e)}get form(){return this.m_form}close(){this.emit("close",{}),super.close()}_toggleMax(){this.m_maximizable&&(this.m_maximized?(this.removeClass("maximized"),this.setStyle({left:this.m_rc_max.left,top:this.m_rc_max.top,width:this.m_rc_max.width,height:this.m_rc_max.height}),this.m_maximized=!1,this.emit("size",Q(null,"restore"))):(this._maximize(),this.emit("size",Q(null,"maximize"))))}_toggleMin(){this.m_minimizable&&(this.m_minimized?(this.removeClass("minimized"),this.setStyle({width:this.m_rc_min.width,height:this.m_rc_min.height}),this.m_minimized=!1,this.emit("size",Q(null,"restore"))):(this._minimize(),this.emit("size",Q(null,"minimize"))))}_mouseDown(e){let{x:t,y:i}=re(e,!0),s=J(f.body).getBoundingRect(),n=this.getBoundingRect(!0),r=t-n.left,a=i-n.top,h=Date.now(),m=h-this.m_last_down;if(this.m_maximizable&&m<700){this._toggleMax();return}if(this.m_last_down=h,this.m_maximized)return;let c=l((d,p)=>{d>s.right?d=s.right:d<s.left&&(d=s.left),p>s.bottom?p=s.bottom:p<s.top&&(p=s.top);let g=d-r,x=p-a;this.setStyle({left:g,top:x})},"__move");u.setCapture(this,d=>{if(d.type=="mousemove"){let p=d;c(p.clientX,p.clientY)}else if(d.type=="touchmove"){let p=d;p.touches.length==1&&c(p.touches[0].clientX,p.touches[0].clientY)}else d.type=="mouseup"||d.type=="touchend"?(u.releaseCapture(),this.emit("move",ji(null))):d.type=="mousedown"||d.type=="touchstart"})}maximize(){!this.m_maximizable||this.m_maximized||(this._maximize(),this.emit("size",Q(null)))}_maximize(e=!0){e&&(this.m_rc_max=this.getBoundingRect(!1)),this.addClass("maximized"),this.m_maximized=!0,this.setStyle({left:void 0,top:void 0,width:void 0,height:void 0})}minimize(){!this.m_minimizable||this.m_minimized||(this._minimize(),this.emit("size",Q(null)))}_minimize(e=!0){e&&(this.m_rc_min=this.getBoundingRect(!1)),this.addClass("minimized"),this.m_minimized=!0,this.setStyle({width:void 0,height:void 0})}set title(e){this.m_title=e,this.m_ui_title&&(this.m_ui_title.text=e)}itemWithName(e){let t=this.dom.querySelector(`[name="${e}"]`);return t?u.getElement(t):null}getValues(){return this.m_form.getValues()}validate(){return this.m_form.validate()}};l(De,"Dialog");var di=class extends O{m_colorSel;m_colorHue;m_colorAlpha;m_sample;m_selMark;m_hueMark;m_alphaMark;m_baseHSV;m_baseColor;m_transpCk;m_colorEdit;m_palmode;constructor(e){super(e),this.m_palmode=di.last_palmode,this.setDomEvent("contextmenu",t=>this._showCtx(t))}_showCtx(e){let t=new te({items:[new ue({text:"Palette",checked:this.m_palmode,click:()=>{this.m_palmode=!this.m_palmode,di.last_palmode=this.m_palmode,this.update()}})]}),i=re(e,!0);t.displayAt(i.x,i.y)}render(e){if(this.m_baseColor=e.color,this.m_baseHSV=V.toHSV(this.m_baseColor),this.m_palmode){let h=function(m){r=[],m.forEach(c=>{let d=new V(c.hex),p=d.value()==a,g=Kt("hclr-box xbox",{selected:p}),x=new u({cls:g,style:{backgroundColor:d.toHex(),color:V.contrastColor(d).toHex()},data:{color:d.value()},content:d.toHex()});r.push(x),p&&(s=x)}),i&&i.itemWithId("vsel").setContent(r)};var t=h;l(h,"fillSubs"),this.addClass("pal-mode");let i=null,s=null,n=[],r=[],a=this.m_baseColor.value();Mn.forEach(m=>{let c=m.variations[4].hex,d=c===a;d||(d=m.variations.some(x=>{if(new V(x.hex).value()===a)return!0}));let p=Kt("clr-box xbox",{selected:d}),g=new u({cls:p,style:{backgroundColor:new V(c).toHex()},data:{color:c,main:m.variations}});d&&h(m.variations),n.push(g)}),i=new H({content:[new w({id:"hsel",content:n}),new H({id:"vsel",flex:1,content:r})]}),this.m_colorEdit=new U({cls:"hexv",value:"",attrs:{spellcheck:!1},change:m=>{let c=new V(m.value);c&&(this.m_baseColor=c,this.m_baseHSV=V.toHSV(c),this._updateColor(!1))}}),this.m_transpCk=new ke({cls:"transp",text:"transparent",change:m=>{this.m_baseHSV.a=m.value?0:1,this._updateColor()}}),this.setContent([i,this.m_transpCk,this.m_colorEdit]),i.setDomEvent("click",m=>{s&&(s.removeClass("selected"),s=null);let c=u.getElement(m.target,"xbox");if(c){let d=c.getData("main");if(d)h(d);else{let p=new V(c.getData("color"));this.m_baseColor=p,this.m_baseHSV=V.toHSV(p),this._updateColor(),s=c,c.addClass("selected")}}})}else this.removeClass("pal-mode"),this.m_selMark=new u({cls:"marker"}),this.m_colorSel=new u({cls:"sel",content:[new u({cls:"@fit light"}),new u({cls:"@fit dark"}),this.m_selMark]}),this.m_hueMark=new u({cls:"marker"}),this.m_colorHue=new u({cls:"hue",content:[this.m_hueMark]}),this.m_sample=new u({cls:"sample"}),e.hasAlpha?(this.addClass("with-alpha"),this.m_alphaMark=new u({cls:"marker"}),this.m_colorAlpha=new u({cls:"alpha",content:[new u({cls:"bk @fit",ref:"color"}),this.m_alphaMark]})):(this.removeClass("with-alpha"),this.m_transpCk=new ke({cls:"transp",text:"transparent",change:i=>{this.m_baseHSV.a=i.value?0:1,this._updateColor()}})),this.m_colorEdit=new U({cls:"hexv",value:"",attrs:{spellcheck:!1},change:i=>{let s=new V(i.value);s&&(this.m_baseColor=s,this.m_baseHSV=V.toHSV(s),this._updateColor(!1))}}),this.setContent([this.m_colorSel,this.m_colorHue,this.m_colorAlpha,this.m_transpCk,this.m_colorEdit,this.m_sample]),this.m_colorSel.setDomEvent("mousedown",i=>{u.setCapture(this,s=>this._selChange(s))}),this.m_colorHue.setDomEvent("mousedown",i=>{u.setCapture(this,s=>this._hueChange(s))}),e.hasAlpha&&this.m_colorAlpha.setDomEvent("mousedown",i=>{u.setCapture(this,s=>this._alphaChange(s))}),this._updateColor()}set color(e){this.m_baseColor=e,this.m_baseHSV=V.toHSV(this.m_baseColor),this._updateColor()}get color(){return this.m_baseColor}_selChange(e){let t=re(e,!0);console.log(t);let i=this.m_colorSel.getBoundingRect();this.m_props.hasAlpha||(this.m_baseHSV.a=1),this.m_baseHSV.s=it((t.x-i.left)/i.width,0,1),this.m_baseHSV.v=1-it((t.y-i.top)/i.height,0,1),this._updateColor(),(e.type=="mouseup"||e.type=="touchend")&&u.releaseCapture()}_hueChange(e){let t=re(e,!0),i=this.m_colorHue.getBoundingRect();this.m_baseHSV.h=it((t.y-i.top)/i.height,0,1),this._updateColor(),(e.type=="mouseup"||e.type=="touchend")&&u.releaseCapture()}_alphaChange(e){let t=re(e,!0),i=this.m_colorAlpha.getBoundingRect();this.m_baseHSV.a=it((t.x-i.left)/i.width,0,1),this._updateColor(),(e.type=="mouseup"||e.type=="touchend")&&u.releaseCapture()}_updateColor(e=!0){let t;if(this.m_palmode)this.m_transpCk.check=this.m_baseHSV.a==0;else{if(t=V.fromHSV(this.m_baseHSV.h,1,1,1),this.m_colorSel.setStyleValue("backgroundColor",t.toString()),t=V.fromHSV(this.m_baseHSV.h,this.m_baseHSV.s,this.m_baseHSV.v,1),this.m_sample.setStyleValue("backgroundColor",t.toString()),this.m_props.hasAlpha){let i=`linear-gradient(to right, rgba(0,0,0,0) 0%, ${t.toString()} 100%)`;this.m_colorAlpha.itemWithRef("color").setStyleValue("backgroundImage",i)}this.m_selMark.setStyle({left:this.m_baseHSV.s*100+"%",top:100-this.m_baseHSV.v*100+"%"}),this.m_hueMark.setStyle({top:this.m_baseHSV.h*100+"%"}),this.m_props.hasAlpha?this.m_alphaMark.setStyle({left:this.m_baseHSV.a*100+"%"}):this.m_transpCk.check=this.m_baseHSV.a==0}t=V.fromHSV(this.m_baseHSV.h,this.m_baseHSV.s,this.m_baseHSV.v,this.m_baseHSV.a),this.m_baseColor=t,e&&(this.m_colorEdit.value=t.alpha()==1?t.toHex():t.toString()),this._change()}_change(){this.emit("change",M(this.m_baseColor))}},dt=di;l(dt,"ColorPicker"),F(dt,"last_palmode",!1);var He=class extends De{m_picker;constructor(e){e.icon=void 0,e.buttons=void 0,super(e),this.mapPropEvents(e,"change"),this.m_picker=new dt({color:e.color,hasAlpha:e.hasAlpha,style:{padding:8},width:250,height:250});let t=this._makeCustoms(e.cust_colors);this.form.updateContent([new H({content:[this.m_picker,t]})],["ok","cancel"]),this.on("btnClick",i=>{i.button=="ok"&&this.emit("change",M(this.m_picker.color))})}_makeCustoms(e){let t=null;if(e&&e.length>0){let i=[];for(let s=0;s<e.length;s+=8){let n=[];for(let r=0;r<8;r++){let a=s+r,h=e[a];n.push(new I({cls:"cust-cc",text:"",flex:1,style:{backgroundColor:h?h.toString():"transparent"},tooltip:h?h.toString():void 0,dom_events:{click:()=>{h&&(this.m_picker.color=h,this.emit("change",M(h)),this.close())}}}))}i.push(new w({cls:"line",content:n}))}t=new H({cls:"customs",content:i})}return t}set color(e){this.m_picker.color=e}get color(){return this.m_picker.color}static show(e){let t;return B(e)?t=new He({color:new V(e)}):t=new He(e),t.show(),t}};l(He,"ColorPickerBox");var ui=class extends w{constructor(e){super(e),this.mapPropEvents(e,"change")}render(e){let t=e.color,i;this._isTransp(t)?(t=V.NONE,i="black"):i=V.contrastColor(t).toString(),this.setContent([e.label?new I({cls:"label",text:e.label,flex:e.labelWidth<0?-e.labelWidth:void 0,width:e.labelWidth>=0?e.labelWidth:void 0}):null,new u({flex:1,content:[new I({cls:"alpha @fit",text:""}),new I({cls:"value @fit",text:e.displayValue===!1?"":t.toHex(),style:{backgroundColor:t.toString(),color:i},dom_events:{click:()=>this._showPicker()}})]})]),e.displayValue===!1&&this.setStyleValue("background-image","url( 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAEsmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjEwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMTAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIxMCIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMTAiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249IjcyLjAiCiAgIHRpZmY6WVJlc29sdXRpb249IjcyLjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjEtMDMtMjJUMTU6NTE6NDkrMDE6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjEtMDMtMjJUMTU6NTE6NDkrMDE6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS45LjAiCiAgICAgIHN0RXZ0OndoZW49IjIwMjEtMDMtMjJUMTU6NTE6NDkrMDE6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/Pn8+b7YAAAGCaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRy0tCQRSHv7Qwyh5gRIsWEtZKwwyiNi2UXlAt1CCrjV5fgdrlXiOibdBWKIja9FrUX1DboHUQFEUQ7YLWRW0qbueqoESe4cz55jdzDjNnwBLOKFm93gvZXF4LTvid85EFp+0FK5204sURVXR1JjQepqZ93lNnxluPWav2uX+tOZ7QFahrFB5VVC0vPCk8vZZXTd4R7lDS0bjwmbBbkwsK35l6rMSvJqdK/G2yFg4GwNIu7ExVcayKlbSWFZaX48pmVpXyfcyX2BO5uZDEHvFudIJM4MfJFGMEGGKAEZmH8OCjX1bUyPcW82dZkVxFZpV1NJZJkSaPW9RVqZ6QmBQ9ISPDutn/v33Vk4O+UnW7HxqeDeO9F2zb8FMwjK8jw/g5BusTXOYq+SuHMPwheqGiuQ6gbRPOrypabBcutqDrUY1q0aJkFbckk/B2Ci0RcNxA02KpZ+V9Th4gvCFfdQ17+9An59uWfgF7Hmfv4QYbGAAAAAlwSFlzAAALEwAACxMBAJqcGAAAACdJREFUGJVjbGhoYEAC9fX1yFwmBryAptKM////R+Y3NjbSzW4C0gAo9QeQBmhTIwAAAABJRU5ErkJggg=='"),this._setTabIndex(e.tabIndex)}set value(e){this.m_props.color=e,this.update()}get value(){return this.m_props.color}set custom_colors(e){this.m_props.cust_colors=e}_showPicker(){let e=new He({color:this.m_props.color,cust_colors:this.m_props.cust_colors,hasAlpha:this.m_props.hasAlpha,events:{change:i=>{this.m_props.color=i.value,this._change(),this.update()}}}),t=this.getBoundingRect();e.displayAt(t.left,t.bottom,"tl")}_change(){this.emit("change",M(this.m_props.color))}_isTransp(e){return!e.alpha()}};l(ui,"ColorPickerEditor");var Mn=[{color:"Red",variations:[{weight:50,hex:16772078},{weight:100,hex:16764370},{weight:200,hex:15702682},{weight:300,hex:15037299},{weight:400,hex:15684432},{weight:500,hex:16007990},{weight:600,hex:15022389},{weight:700,hex:13840175},{weight:800,hex:12986408},{weight:900,hex:12000284}]},{color:"Pink",variations:[{weight:50,hex:16573676},{weight:100,hex:16301008},{weight:200,hex:16027569},{weight:300,hex:15753874},{weight:400,hex:15483002},{weight:500,hex:15277667},{weight:600,hex:14162784},{weight:700,hex:12720219},{weight:800,hex:11342935},{weight:900,hex:8916559}]},{color:"Purple",variations:[{weight:50,hex:15984117},{weight:100,hex:14794471},{weight:200,hex:13538264},{weight:300,hex:12216520},{weight:400,hex:11225020},{weight:500,hex:10233776},{weight:600,hex:9315498},{weight:700,hex:8069026},{weight:800,hex:6953882},{weight:900,hex:4854924}]},{color:"Deep Purple",variations:[{weight:50,hex:15591414},{weight:100,hex:13747433},{weight:200,hex:11771355},{weight:300,hex:9795021},{weight:400,hex:8280002},{weight:500,hex:6765239},{weight:600,hex:6174129},{weight:700,hex:5320104},{weight:800,hex:4532128},{weight:900,hex:3218322}]},{color:"Indigo",variations:[{weight:50,hex:15264502},{weight:100,hex:12962537},{weight:200,hex:10463450},{weight:300,hex:7964363},{weight:400,hex:6056896},{weight:500,hex:4149685},{weight:600,hex:3754411},{weight:700,hex:3162015},{weight:800,hex:2635155},{weight:900,hex:1713022}]},{color:"Blue",variations:[{weight:50,hex:14938877},{weight:100,hex:12312315},{weight:200,hex:9489145},{weight:300,hex:6600182},{weight:400,hex:4367861},{weight:500,hex:2201331},{weight:600,hex:2001125},{weight:700,hex:1668818},{weight:800,hex:1402304},{weight:900,hex:870305}]},{color:"Light Blue",variations:[{weight:50,hex:14808574},{weight:100,hex:11789820},{weight:200,hex:8508666},{weight:300,hex:5227511},{weight:400,hex:2733814},{weight:500,hex:240116},{weight:600,hex:236517},{weight:700,hex:166097},{weight:800,hex:161725},{weight:900,hex:87963}]},{color:"Cyan",variations:[{weight:50,hex:14743546},{weight:100,hex:11725810},{weight:200,hex:8445674},{weight:300,hex:5099745},{weight:400,hex:2541274},{weight:500,hex:48340},{weight:600,hex:44225},{weight:700,hex:38823},{weight:800,hex:33679},{weight:900,hex:24676}]},{color:"Teal",variations:[{weight:50,hex:14742257},{weight:100,hex:11722715},{weight:200,hex:8440772},{weight:300,hex:5093036},{weight:400,hex:2533018},{weight:500,hex:38536},{weight:600,hex:35195},{weight:700,hex:31083},{weight:800,hex:26972},{weight:900,hex:19776}]},{color:"Green",variations:[{weight:50,hex:15267305},{weight:100,hex:13166281},{weight:200,hex:10868391},{weight:300,hex:8505220},{weight:400,hex:6732650},{weight:500,hex:5025616},{weight:600,hex:4431943},{weight:700,hex:3706428},{weight:800,hex:3046706},{weight:900,hex:1793568}]},{color:"Light Green",variations:[{weight:50,hex:15857897},{weight:100,hex:14478792},{weight:200,hex:12968357},{weight:300,hex:11457921},{weight:400,hex:10275941},{weight:500,hex:9159498},{weight:600,hex:8172354},{weight:700,hex:6856504},{weight:800,hex:5606191},{weight:900,hex:3369246}]},{color:"Lime",variations:[{weight:50,hex:16382951},{weight:100,hex:15791299},{weight:200,hex:15134364},{weight:300,hex:14477173},{weight:400,hex:13951319},{weight:500,hex:13491257},{weight:600,hex:12634675},{weight:700,hex:11514923},{weight:800,hex:10394916},{weight:900,hex:8550167}]},{color:"Yellow",variations:[{weight:50,hex:16776679},{weight:100,hex:16775620},{weight:200,hex:16774557},{weight:300,hex:16773494},{weight:400,hex:16772696},{weight:500,hex:16771899},{weight:600,hex:16635957},{weight:700,hex:16498733},{weight:800,hex:16361509},{weight:900,hex:16088855}]},{color:"Amber",variations:[{weight:50,hex:16775393},{weight:100,hex:16772275},{weight:200,hex:16769154},{weight:300,hex:16766287},{weight:400,hex:16763432},{weight:500,hex:16761095},{weight:600,hex:16757504},{weight:700,hex:16752640},{weight:800,hex:16748288},{weight:900,hex:16740096}]},{color:"Orange",variations:[{weight:50,hex:16774112},{weight:100,hex:16769202},{weight:200,hex:16764032},{weight:300,hex:16758605},{weight:400,hex:16754470},{weight:500,hex:16750592},{weight:600,hex:16485376},{weight:700,hex:16088064},{weight:800,hex:15690752},{weight:900,hex:15094016}]},{color:"Deep Orange",variations:[{weight:50,hex:16509415},{weight:100,hex:16764092},{weight:200,hex:16755601},{weight:300,hex:16747109},{weight:400,hex:16740419},{weight:500,hex:16733986},{weight:600,hex:16011550},{weight:700,hex:15092249},{weight:800,hex:14172949},{weight:900,hex:12531212}]},{color:"Brown",variations:[{weight:50,hex:15723497},{weight:100,hex:14142664},{weight:200,hex:12364452},{weight:300,hex:10586239},{weight:400,hex:9268835},{weight:500,hex:7951688},{weight:600,hex:7162945},{weight:700,hex:6111287},{weight:800,hex:5125166},{weight:900,hex:4073251}]},{color:"Grey",variations:[{weight:50,hex:16448250},{weight:100,hex:16119285},{weight:200,hex:15658734},{weight:300,hex:14737632},{weight:400,hex:12434877},{weight:500,hex:10395294},{weight:600,hex:7697781},{weight:700,hex:6381921},{weight:800,hex:4342338},{weight:900,hex:2171169}]},{color:"Blue Grey",variations:[{weight:50,hex:15527921},{weight:100,hex:13621468},{weight:200,hex:11583173},{weight:300,hex:9479342},{weight:400,hex:7901340},{weight:500,hex:6323595},{weight:600,hex:5533306},{weight:700,hex:4545124},{weight:800,hex:3622735},{weight:900,hex:2503224}]},{color:"Grey",variations:[{weight:50,hex:16777215},{weight:100,hex:14737632},{weight:200,hex:12895428},{weight:300,hex:11053224},{weight:400,hex:9211020},{weight:500,hex:7368816},{weight:600,hex:5526612},{weight:700,hex:3684408},{weight:800,hex:1842204},{weight:900,hex:0}]}];var Yi=Symbol("x-drag-cb"),pi=class{dragSource;dragGhost;dropTarget;notified;timer;registerDraggableElement(e){e.setDomEvent("dragstart",t=>{this.dragSource=e,this.dragGhost=e.dom.cloneNode(!0),this.dragGhost.classList.add("dragged"),f.body.appendChild(this.dragGhost),e.addClass("dragging"),t.dataTransfer.setData("text/string","1"),t.dataTransfer.setDragImage(new Image,0,0),t.stopPropagation()}),e.setDomEvent("drag",t=>{this.dragGhost.style.left=t.pageX+"px",this.dragGhost.style.top=t.pageY+"px"}),e.setDomEvent("dragend",t=>{e.removeClass("dragging"),this.dragGhost.remove()}),e.setAttribute("draggable","true")}registerDropTarget(e,t,i){let s=l(h=>{if(i&&!i(this.dragSource)){console.log("reject ",e),h.dataTransfer.dropEffect="none";return}console.log("accepted ",e),h.preventDefault(),h.dataTransfer.dropEffect="copy"},"dragEnter"),n=l(h=>{if(i&&!i(this.dragSource)){console.log("reject ",e),h.dataTransfer.dropEffect="none";return}if(h.preventDefault(),this.dropTarget!=e&&(this.dropTarget=e,this._startCheck()),this.dropTarget){let m={pt:new ee(h.pageX,h.pageY),data:h.dataTransfer};t("drag",this.dragSource,m)}h.dataTransfer.dropEffect="copy"},"dragOver"),r=l(h=>{this.dropTarget=null,h.preventDefault()},"dragLeave"),a=l(h=>{let m={pt:new ee(h.pageX,h.pageY),data:h.dataTransfer};t("drop",this.dragSource,m),this.dropTarget=null,e.removeClass("drop-over"),h.preventDefault()},"drop");e.setDomEvent("dragenter",s),e.setDomEvent("dragover",n),e.setDomEvent("dragleave",r),e.setDomEvent("drop",a),e.setData(Yi,t)}_startCheck(){this.timer&&(clearInterval(this.timer),this._check()),this.timer=setInterval(()=>this._check(),300)}_check(){let e=l(i=>{i.removeClass("drop-over"),i.getData(Yi)("leave",this.dragSource)},"leaving"),t=l(i=>{i.addClass("drop-over"),i.getData(Yi)("enter",this.dragSource)},"entering");this.dropTarget?(!this.notified||this.notified!=this.dropTarget)&&(this.notified&&e(this.notified),this.notified=this.dropTarget,t(this.notified)):this.notified&&(e(this.notified),this.notified=null,clearInterval(this.timer))}};l(pi,"DragManager");var Sn=new pi;var An={align:"center",vAlign:"middle",fontSize:14,fontWeight:null,fontStyle:"",fontVariant:"",fontFamily:"Arial",lineHeight:0,clip:!0,columns:1,columnGap:0,lineBreak:!0};function Tn(o,e,t,i){if(t.width<=0||t.height<=0)return;if(i={...An,...i},o.save(),i.clip&&(o.beginPath(),o.rect(t.left,t.top,t.width,t.height),o.clip()),i.rotation){let C=new ee(t.left+t.width/2,t.top+t.height/2),T=i.rotation/180*Math.PI;o.translate(C.x,C.y),o.rotate(T),o.translate(-C.x,-C.y)}o.textBaseline="bottom";let s=Oe(i.fontSize,2)??12,n="";i.fontStyle&&(n+=i.fontStyle+" "),i.fontVariant&&(n+=i.fontVariant+" "),i.fontWeight&&(n+=i.fontWeight+" "),n+=s+"px ";let r=i.fontFamily??"sans-serif";r.indexOf(".")>0&&(r='"'+r+'"'),n+=r,o.font=n.trim();let a=[],h=e.split(`
`),m=i.columns<1?1:i.columns,c=i.columnGap,d=(t.width-c*(m-1))/m,p=t.left,g=d;i.lineBreak||(g=99999999);let x=Xi(o," ");h.forEach(C=>{let T={width:0,words:[],space:0},de=Xi(o,C);if(de<g)T.width=de,T.words.push({width:de,text:C}),a.push(T);else{let xt=C.split(/\s/).filter(Ce=>Ce!=="").map(Ce=>({width:Xi(o,Ce),text:Ce})),qe=0,Ye=0;for(;qe<xt.length;){let Ce=xt[qe],Ae=T.width;Ae&&(Ae+=x),Ae+=Ce.width,Ae>d&&Ye>0?(a.push(T),Ye=0,de=0,T={width:0,words:[],space:0}):(T.words.push(Ce),T.width=Ae,qe++,Ye++)}Ye&&(a.push(T),T.last=!0)}});let _=Bn(o,"Ag"),y=(i.lineHeight??1.3)*_,A=a.length,P=t.top;if(m==1){let C=y*A;A==1&&(y=_,C=_),i.vAlign==="middle"?(P=t.top+t.height/2-C/2,P+=y/2,o.textBaseline="middle"):i.vAlign==="bottom"?C<t.height&&(P=t.top+t.height-C+y):(P=t.top,o.textBaseline="top")}else P+=_;let W=i.align=="justify",D=m,b=P,E=0;switch(i.align){case"right":E=1;break;case"center":E=2;break}let N=0;return a.some(C=>{C.space=x,W&&!C.last&&Ln(C,d,x);let T=p,de=0;if(E==1?T+=d-C.width:E==2&&(T+=d/2-C.width/2),C.words.forEach(Ve=>{o.fillText(Ve.text,T,b),T+=Ve.width+C.space,de+=Ve.width+C.space}),b+=y,N<de&&(N=de),b>t.bottom+y&&(b=P,p+=d+c,--D==0))return!0}),o.restore(),{width:N,height:(a.length+.3)*y}}l(Tn,"drawText");function Bn(o,e){let t=o.measureText(e);return t.actualBoundingBoxAscent+t.actualBoundingBoxDescent}l(Bn,"_calcTextHeight");function Xi(o,e){return Oe(o.measureText(e).width,2)}l(Xi,"_measureText");function Ln(o,e,t){let i=(e-o.width)/(o.words.length-1)+t;i<=0||(o.width=e,o.space=i)}l(Ln,"_justify");var Zi="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";function Es(o){return o.substring(0,5)=="data:"}l(Es,"_isStaticImage");var be=class extends u{m_created;m_lazysrc;m_img;constructor(e){super(e),this.m_created=!1,this.m_props.lazy=e.lazy!==!1,this.m_props.alt=e.alt,e.lazy!==!1&&(this.m_lazysrc=e.src,e.src=Zi),this.setDomEvent("create",()=>{e.lazy&&this.setImage(this.m_lazysrc,!0)})}render(){let e=this.m_props;this.m_img=new u({tag:"img",attrs:{draggable:!1,alt:e.alt??"",decoding:e.lazy?"async":void 0},style:{objectFit:e.alignment?e.alignment:void 0}}),e.overlays?(e.overlays.forEach(t=>t.addClass("@fit")),this.setContent([this.m_img,...e.overlays])):this.setContent(this.m_img)}setImage(e,t){e?this.removeClass("empty"):(e=Zi,this.addClass("empty")),this.m_props.lazy?(t||this.m_lazysrc!=e)&&(Es(e)?(this.m_props.src=e,this.m_lazysrc=e,this.m_img.dom&&this.m_img.dom.setAttribute("src",this.m_props.src)):(this.m_props.src=Zi,this.m_img.dom&&this.m_img.dom.setAttribute("src",this.m_props.src),this.m_lazysrc=e,this.dom&&this._update_image())):(this.m_props.src=e,this.m_lazysrc=e,this.m_img.dom&&this.m_img.dom.setAttribute("src",e))}_update_image(){console.assert(!!this.dom),this.m_lazysrc&&!Es(this.m_lazysrc)&&(be.lazy_images_waiting.push({el:this,src:this.m_lazysrc}),be.lazy_image_timer===void 0&&(be.lazy_image_timer=setInterval(be.lazyWatch,10)))}static lazyWatch(){let e=[],t=0;be.lazy_images_waiting.forEach(i=>{let s=i.el.dom,n=i.src;if(!s||s.offsetParent===null)return;let r=s.getBoundingClientRect();!t&&s.offsetParent!==null&&r.bottom>=0&&r.right>=0&&r.top<=(window.innerHeight||f.documentElement.clientHeight)&&r.left<=(window.innerWidth||f.documentElement.clientWidth)?(s.firstChild.setAttribute("src",n),i.el.removeClass("empty"),t++):e.push(i)}),be.lazy_images_waiting=e,e.length==0&&(clearInterval(be.lazy_image_timer),be.lazy_image_timer=void 0)}},Re=be;l(Re,"Image"),F(Re,"lazy_images_waiting",[]),F(Re,"lazy_image_timer");var Lt=class extends w{constructor(e){super(e)}clear(){this.m_props.value=""}};l(Lt,"FileUpload");var fi=class extends Lt{m_path;m_ui_img;m_ui_input;render(e){let t="up"+this.uid;this.setContent([new u({tag:"label",attrs:{for:t},content:[this.m_ui_img=new Re({src:this.m_props.value})]}),this.m_ui_input=new j({cls:"@hidden",id:t,type:"file",name:this.m_props.name,value_hook:{get:()=>this._get_value(),set:i=>{this._set_value(i)}},attrs:{accept:"image/*"},dom_events:{change:i=>{this._handleChange(i)}}})])}clear(){super.clear(),this.m_ui_input.dom.value="",this.m_ui_img.setImage(null,!1)}_get_value(){return this.m_path}_set_value(e){debugger}_handleChange(e){let t=this;function i(a){let h=new FileReader;h.addEventListener("load",m=>{t.m_ui_img.setImage(h.result.toString())}),h.readAsDataURL(a)}l(i,"createThumbnail");let s=["png","jpg","jpeg","gif"],n=e.target.files,r=n.length;for(let a=0;a<r;a++){let h=n[a].name.split(".");if(h=h[h.length-1],h=h.toLowerCase(),s.indexOf(h)!=-1){i(n[a]),this.m_path=n[a];break}}}};l(fi,"ImageUpload");var Bt=null;function ys(){return Bt||(Bt=new u({tag:"input",style:{display:"none",id:"fileDialog"},attrs:{type:"file"}}),f.body.appendChild(Bt._build())),Bt.clearDomEvent("change"),Bt}l(ys,"_createFileInput");function Hn(o,e,t=!1){let i=ys();i.removeAttribute("nwsaveas"),i.setAttribute("accept",o),i.setAttribute("multiple",t),i.setDomEvent("change",s=>{let n=i.dom.files;e(n)}),i.dom.click()}l(Hn,"openFileDialog");function Rn(o,e,t){let i=ys();i.setAttribute("nwsaveas",o),i.setAttribute("accept",e),i.setDomEvent("change",s=>{let n=i.dom.files;t(n[0])}),i.dom.click()}l(Rn,"saveFileDialog");var Ji,gi;function Fs(o){o?gi=new Intl.NumberFormat(Ji,{style:"currency",currency:o}):gi=new Intl.NumberFormat(Ji,{style:"decimal",useGrouping:!0,minimumFractionDigits:2,maximumFractionDigits:2})}l(Fs,"setCurrencySymbol");function zn(o){if(o==null||o==="")return"";let e=new Date(Date.parse(o)),t={month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return e.toLocaleDateString(Ji,t)}l(zn,"sql_date_formatter");function Vn(o){if(o==null||o==="")return"";let e=typeof o=="string"?new Date(Date.parse(o)):o;return G(e)}l(Vn,"date_formatter");function On(o){if(o==null||o==="")return"";let e=Oe(typeof o=="string"?parseFloat(o):o,2);return Object.is(e,-0)&&(e=0),gi.format(e)}l(On,"money_formatter");function Wn(o){if(o==null||o==="")return"";let e=Oe(typeof o=="string"?parseFloat(o):o,2);return e?gi.format(e):""}l(Wn,"money_formatter_nz");function Nn(o){return o?"oui":"-"}l(Nn,"bool_formatter");Fs(null);var nc=Symbol("update");function ks(o,e){return S({rec:o,chk:e})}l(ks,"EvGridCheck");var _i=class extends u{m_sens;m_sorted;constructor(e,t){super(e),this.m_sorted=!1,this.m_sens="dn",this.setContent([new u({tag:"span",content:t}),new L({ref:"sorter",cls:"@hidden sort",icon:"var( --x4-icon-arrow-down )"})])}get sorted(){return this.m_sorted}sort(e,t){this.m_sorted=e,this.m_sens=t;let i=this.itemWithRef("sorter");i.icon=this.m_sens=="up"?"var( --x4-icon-arrow-down )":"var( --x4-icon-arrow-up )",i.show(e)}get sens(){return this.m_sens}toggleSens(){this.m_sens=this.m_sens=="up"?"dn":"up",this.itemWithRef("sorter").icon=this.m_sens=="up"?"var( --x4-icon-arrow-down )":"var( --x4-icon-arrow-up )"}};l(_i,"ColHeader");var xi=class extends H{m_dataview;m_data_cx;m_columns;m_view_el;m_container;m_header;m_footer;m_empty_msg;m_empty_text;m_selection;m_itemHeight;m_topIndex;m_visible_rows;m_hasMarks;m_marks;m_recycler;m_rowClassifier;constructor(e){super(e),this.m_columns=e.columns,this.m_hasMarks=e.hasMarks??!1,this.m_marks=new Set,this.m_hasMarks&&this.m_columns.unshift({id:"id",title:"",width:30,renderer:t=>this._renderCheck(t)}),this.setAttribute("tabindex",0),this.m_topIndex=0,this.m_itemHeight=0,this.m_recycler=[],this.m_rowClassifier=e.calcRowClass,this.m_empty_text=e.empty_text??k.global.empty_list,this.setDomEvent("click",t=>this._itemClick(t)),this.setDomEvent("dblclick",t=>this._itemDblClick(t)),this.setDomEvent("contextmenu",t=>this._itemMenu(t)),this.setDomEvent("keydown",t=>this._handleKey(t)),this.setStore(e.store)}componentCreated(){this._updateScroll(!0)}_moveSel(e,t=!0){let i=this.m_selection,s=null;if(i===void 0)i=this.m_dataview.getByIndex(0).getID();else{let n=this.m_dataview.indexOfId(this.m_selection);e==1?n++:e==-1?n--:e==2?n+=this.m_visible_rows.length-1:e==-2&&(n-=this.m_visible_rows.length-1),e<0?s="start":s="end",n<0?n=0:n>=this.m_dataview.count&&(n=this.m_dataview.count-1),i=this.m_dataview.getByIndex(n).getID()}return this.m_selection!=i&&t&&this._selectItem(i,null,s),i}_handleKey(e){if(!(!this.m_dataview||this.m_dataview.count==0))switch(e.key){case"ArrowDown":case"Down":{this._moveSel(1);break}case"ArrowUp":case"Up":{this._moveSel(-1);break}case"PageUp":{this._moveSel(-2);break}case"PageDown":{this._moveSel(2);break}}}getNextSel(e){return this._moveSel(e,!1)}_scrollIntoView(e,t){let i=this._findItem(e);i?i.scrollIntoView({block:"center"}):(this.m_topIndex=this.m_dataview.indexOfId(e),this.m_view_el.dom.scrollTop=this.m_topIndex*this.m_itemHeight,this._buildItems(),this._scrollIntoView(e))}setStore(e){this.m_selection=void 0,e instanceof Le?this.m_dataview=e.createView():this.m_dataview=e,this.m_hasMarks&&this.clearMarks(),this.m_data_cx&&this.m_data_cx.dispose(),this.m_dataview&&(this.m_data_cx=this.m_dataview.on("view_change",t=>{t.action=="change"&&(this.m_selection=void 0),this._updateScroll(!0)}),this._updateScroll(!0))}getView(){return this.m_dataview}getSelection(){return this.m_selection}getSelRec(){return this.m_selection?this.m_dataview.getById(this.m_selection):null}setSelection(e){this._selectItem(e,null,"center")}render(){this.m_recycler=[],this.m_container=new u({cls:"content"}),this.m_empty_msg=new I({cls:"empty-msg",text:""}),this.m_view_el=new u({cls:"@scroll-view",flex:1,dom_events:{sizechange:()=>this._updateScroll(!0),scroll:()=>this._updateScroll(!1)},content:this.m_container});let e=!1,t=this.m_columns.map((s,n)=>{let r="@cell";s.cls&&(r+=" "+s.cls);let a=new _i({cls:r,flex:s.flex,sizable:"right",style:{width:s.width},dom_events:{click:m=>{J(m.target).hasClass("@sizer-overlay")||(this._sortCol(s),m.preventDefault())}}},s.title),h=l(m=>{if(this._on_col_resize(n,m.size.width),this.m_footer){let c=u.getElement(this.m_footer.dom.childNodes[n]);c&&c.setStyleValue("width",m.size.width)}},"resizeCol");return new _e({target:a,sens:"right",events:{resize:m=>h(m)}}),s.flex&&(e=!0),s.$hdr=a,a});t.push(new Ee({ref:"flex",cls:e?"@hidden":""}));let i=0;if(this.m_columns.forEach(s=>{i+=s.width??0}),this.m_header=new w({cls:"@header",content:t,style:{minWidth:i}}),this.m_props.hasFooter){let s=this.m_columns.map((n,r)=>{let a="@cell";n.align&&(a+=" "+n.align),n.cls&&(a+=" "+n.cls);let h=new u({cls:a,data:{col:r},flex:n.flex,style:{width:n.width}});return n.$ftr=h,h});s.push(new Ee({ref:"flex",cls:e?"@hidden":""})),this.m_footer=new w({cls:"@footer",content:s,style:{minWidth:i}})}else this.m_footer=null;this.setContent([this.m_header,this.m_view_el,this.m_footer,this.m_empty_msg])}_on_col_resize(e,t){let i=this.m_columns[e],s=!1;if(t>=0?(i.width=t,i.flex&&(i.$hdr.removeClass("@flex"),i.$ftr?.removeClass("@flex"),i.flex=void 0,s=!0)):t<0&&!i.flex&&(i.$hdr.addClass("@flex"),i.$ftr?.addClass("@flex"),i.flex=1,s=!0),s){let n=!1;this.m_columns.forEach(r=>{r.flex&&(n=!0)}),this.m_header.itemWithRef("flex")?.show(!n),this.m_footer&&this.m_footer.itemWithRef("flex")?.show(!n)}this._updateScroll(!0)}sortCol(e,t=!0){let i=this.m_columns.find(s=>s.id==e);if(i===void 0){console.assert(!1,"unknown field "+e+" in grid.sortCol");return}this._sortCol(i,t?"dn":"up")}_sortCol(e,t="up"){if(e.sortable===!1)return;this.m_columns.forEach(s=>{s!==e&&s.$hdr.sort(!1,"dn")});let i=e.$hdr;i.sorted?i.toggleSens():i.sort(!0,t),this.m_dataview&&this.m_dataview.sort([{field:e.id,ascending:i.sens!="dn"}])}_computeItemHeight(){let e=f.createElement("div");e.classList.add("x-row");let t=f.createElement("div");t.classList.add("x-grid-view"),t.style.position="absolute",t.style.top="-1000px",t.appendChild(e),this.dom.appendChild(t);let i=e.getBoundingClientRect();this.dom.removeChild(t),this.m_itemHeight=i.height}_createRow(e){let t;if(this.m_recycler.length){t=this.m_recycler.pop(),t.clearClasses(),t.addClass(e.cls),t.setContent(e.content),t.setStyle(e.style);for(let i in e.data)t.setData(i,e.data[i])}else t=new w(e);return t.dom||this.m_container.appendChild(t),t}_buildItems(e=!0){let t=this.getBoundingRect(),i=this.m_header.getBoundingRect(),s=t.height-i.height+this.m_itemHeight;this.m_itemHeight==0&&this._computeItemHeight();let n=this.m_topIndex*this.m_itemHeight,r=0,a=0,h=this.m_topIndex,m=this.m_dataview?this.m_dataview.count:0,c=0,d=!!(this.m_topIndex&1);if(this.m_columns.forEach(_=>{c+=_.width??0}),(m+1)*this.m_itemHeight>=s){let _=u.getScrollbarSize();this.m_header.setStyleValue("paddingRight",_),this.m_footer?.setStyleValue("paddingRight",_)}else this.m_header.setStyleValue("paddingRight",0),this.m_footer?.setStyleValue("paddingRight",0);this.m_visible_rows&&this.m_visible_rows.forEach(_=>{this.m_recycler.push(_)}),this.m_visible_rows=[];let p=100;for(;r<s&&h<m&&--p>0;){let _=this.m_dataview.getByIndex(h),y=_.getID(),A=e?this.m_recycler.findIndex(P=>P.getData("row-id")==y):-1;if(A>=0){let P=this.m_recycler.splice(A,1)[0];P.setStyle({top:r+n,minWidth:c}),this.m_hasMarks&&P.setClass("@marked",this.m_marks.has(y)),P.removeClass("@hidden"),P.setClass("@selected",this.m_selection===y),this.m_visible_rows[a]=P}else{let P=this.m_columns.map(b=>{let E="@cell";b.align&&(E+=" "+b.align),b.cls&&(E+=" "+b.cls);let N;if(b.renderer)N=b.renderer(_),N&&(N.addClass(E),N.setStyleValue("width",b.width),b.flex!==void 0&&(N.addClass("@flex"),N.setStyleValue("flex",b.flex)));else{let C=b.formatter,T;C&&C instanceof Function?T=C(_.getRaw(b.id),_):T=_.getField(b.id),N=new u({cls:E,width:b.width,content:st`<span>${T}</span>`,flex:b.flex})}return N}),W="@row @hlayout center";this.m_hasMarks&&this.m_marks.has(y)&&(W+=" @marked"),this.m_selection===y&&(W+=" @selected");let D=this.m_visible_rows[a]=this._createRow({cls:W,content:P,style:{top:r+n,minWidth:c},data:{"row-id":y,"row-idx":h}});D.addClass(d?"even":"odd"),d=!d,this.m_rowClassifier&&this.m_rowClassifier(_,D)}r+=this.m_itemHeight,h++,a++}this.m_recycler.forEach(_=>{_.addClass("@hidden")});let g=!m,x=this.m_empty_text instanceof Function?this.m_empty_text():this.m_empty_text;this.m_empty_msg.text=x,g&&x.length==0&&(g=!1),this.m_empty_msg.show(g),c<t.width?(this.m_header.setStyleValue("width",null),this.m_footer?.setStyleValue("width",null),this.m_container.setStyle({height:m*this.m_itemHeight,width:null})):(this.m_header.setStyleValue("width",c+1e3),this.m_footer?.setStyleValue("width",c+1e3),this.m_container.setStyle({height:m*this.m_itemHeight,width:c}))}_updateScroll(e){if(!this.m_view_el||!this.m_view_el.dom)return;let t=l(()=>{if(!this.dom)return;let i=Math.floor(this.m_view_el.dom.scrollTop/(this.m_itemHeight||1));(i!=this.m_topIndex||e)&&(this.m_topIndex=i,this._buildItems(!e));let s=this.m_view_el.dom.scrollLeft;this.m_header.setStyleValue("left",-s),this.m_footer?.setStyleValue("left",-s)},"update");e?this.singleShot(t,10):t()}_rowFromTarget(e){let t=this.dom;for(;e&&e!=t;){let i=u.getElement(e);if(i){let s=i.getData("row-id");if(s!==void 0)return{id:s,itm:i}}e=e.parentElement}}_itemClick(e){let t=this._rowFromTarget(e.target);t?this._selectItem(t.id,t.itm):this._selectItem(void 0,void 0)}_itemDblClick(e){let t=this._rowFromTarget(e.target);if(t){this._selectItem(t.id,t.itm);let i=this.m_dataview.getById(t.id);this.emit("dblClick",ye(i)),this.m_hasMarks&&this._toggleMark(i)}}_itemMenu(e){let t=e.target,i=this.dom;for(;t&&t!=i;){let s=u.getElement(t),n=s?.getData("row-id");if(n!==void 0){this._selectItem(n,s);let r=s.getData("row-idx"),a=this.m_dataview.getByIndex(r);this._showItemContextMenu(e,a),e.preventDefault();return}t=t.parentElement}}_findItem(e){for(let t=0;t<this.m_visible_rows.length;t++){let i=this.m_visible_rows[t];if(i.getData("row-id")===e)return i}return null}_selectItem(e,t,i){if(this.m_selection!==void 0){let s=this._findItem(this.m_selection);s&&s.removeClass("@selected")}if(this.m_selection=e,e){i&&this._scrollIntoView(e,i),t||(t=this._findItem(e)),t&&t.addClass("@selected");let s=this.m_dataview.getById(e);this.emit("selectionChange",ie(s))}else this.emit("selectionChange",ie(null))}_showItemContextMenu(e,t){this.emit("contextMenu",pe(e,t))}clearSelection(){this._selectItem(null,null)}exportData(e){let t="",i="	",s=`\r
`,n="";this.m_columns.map(a=>{n.length&&(n+=i),n+=a.title}),t+=n+s;let r=this.m_dataview.count;for(let a=0;a<r;a++){let h=this.m_dataview.getByIndex(a);n="";let m=this.m_columns.map(c=>{let d=h.getField(c.id),p=c.formatter;p&&p instanceof Function&&(d=p(d,h)),n.length>0&&(n+=i),n+=d});t+=n+s}t=t.replace(/[]/gm,"a"),t=t.replace(/[]/gm,"e"),t=t.replace(/[]/gm,"i"),t=t.replace(/[]/gm,"u"),t=t.replace(//gm," "),Oi(t,"text/csv",e)}set empty_text(e){this.m_empty_msg.text=e}_renderCheck(e){let t="--x4-icon-square";return this.m_marks.has(e.getID())&&(t="--x4-icon-square-check"),new L({icon:`var(${t})`})}_toggleMark(e){let t=e.getID(),i=!1;this.m_marks.has(t)?this.m_marks.delete(t):(this.m_marks.add(t),i=!0),this.emit("gridCheck",ks(e,i)),this._buildItems(!1)}getMarks(){let e=[];for(let t of this.m_marks.values())e.push(t);return e}clearMarks(){this.m_marks.size&&(this.m_marks=new Set,this._buildItems(!1))}setFooterData(e){this.m_footer&&this.m_footer.enumChilds(t=>{let i=t.getData("col");if(i){let s=this.m_columns[i],n=e[s.id];if(n!==void 0)if(Z(n))n(t);else{let r,a=s.formatter;a&&a instanceof Function?r=a(n,e):r=n,t.setContent(r,!1)}}})}};l(xi,"GridView");var bi=class extends u{constructor(e){super(e),this.setDomEvent("click",()=>this._handleClick()),this.mapPropEvents(e,"click")}_handleClick(){this.emit("click",ne())}render(e){let t=e.text??"",i=e.href??"#";this.setTag("a"),this.setAttribute("tabindex",0),this.setAttribute("href",i),this.setAttribute("target",e.target),t&&this.setContent(le(t)?t:st`<span>${t}</span>`)}set text(e){this.m_props.text=e,this.update()}};l(bi,"Link");var oe=class{static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){let t=oe.hexChars,i=oe.hexOut,s,n,r,a;for(a=0;a<4;a+=1)for(n=a*8,s=e[a],r=0;r<8;r+=2)i[n+1+r]=t.charAt(s&15),s>>>=4,i[n+0+r]=t.charAt(s&15),s>>>=4;return i.join("")}static _md5cycle(e,t){let i=e[0],s=e[1],n=e[2],r=e[3];i+=(s&n|~s&r)+t[0]-680876936|0,i=(i<<7|i>>>25)+s|0,r+=(i&s|~i&n)+t[1]-389564586|0,r=(r<<12|r>>>20)+i|0,n+=(r&i|~r&s)+t[2]+606105819|0,n=(n<<17|n>>>15)+r|0,s+=(n&r|~n&i)+t[3]-1044525330|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&r)+t[4]-176418897|0,i=(i<<7|i>>>25)+s|0,r+=(i&s|~i&n)+t[5]+1200080426|0,r=(r<<12|r>>>20)+i|0,n+=(r&i|~r&s)+t[6]-1473231341|0,n=(n<<17|n>>>15)+r|0,s+=(n&r|~n&i)+t[7]-45705983|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&r)+t[8]+1770035416|0,i=(i<<7|i>>>25)+s|0,r+=(i&s|~i&n)+t[9]-1958414417|0,r=(r<<12|r>>>20)+i|0,n+=(r&i|~r&s)+t[10]-42063|0,n=(n<<17|n>>>15)+r|0,s+=(n&r|~n&i)+t[11]-1990404162|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&r)+t[12]+1804603682|0,i=(i<<7|i>>>25)+s|0,r+=(i&s|~i&n)+t[13]-40341101|0,r=(r<<12|r>>>20)+i|0,n+=(r&i|~r&s)+t[14]-1502002290|0,n=(n<<17|n>>>15)+r|0,s+=(n&r|~n&i)+t[15]+1236535329|0,s=(s<<22|s>>>10)+n|0,i+=(s&r|n&~r)+t[1]-165796510|0,i=(i<<5|i>>>27)+s|0,r+=(i&n|s&~n)+t[6]-1069501632|0,r=(r<<9|r>>>23)+i|0,n+=(r&s|i&~s)+t[11]+643717713|0,n=(n<<14|n>>>18)+r|0,s+=(n&i|r&~i)+t[0]-373897302|0,s=(s<<20|s>>>12)+n|0,i+=(s&r|n&~r)+t[5]-701558691|0,i=(i<<5|i>>>27)+s|0,r+=(i&n|s&~n)+t[10]+38016083|0,r=(r<<9|r>>>23)+i|0,n+=(r&s|i&~s)+t[15]-660478335|0,n=(n<<14|n>>>18)+r|0,s+=(n&i|r&~i)+t[4]-405537848|0,s=(s<<20|s>>>12)+n|0,i+=(s&r|n&~r)+t[9]+568446438|0,i=(i<<5|i>>>27)+s|0,r+=(i&n|s&~n)+t[14]-1019803690|0,r=(r<<9|r>>>23)+i|0,n+=(r&s|i&~s)+t[3]-187363961|0,n=(n<<14|n>>>18)+r|0,s+=(n&i|r&~i)+t[8]+1163531501|0,s=(s<<20|s>>>12)+n|0,i+=(s&r|n&~r)+t[13]-1444681467|0,i=(i<<5|i>>>27)+s|0,r+=(i&n|s&~n)+t[2]-51403784|0,r=(r<<9|r>>>23)+i|0,n+=(r&s|i&~s)+t[7]+1735328473|0,n=(n<<14|n>>>18)+r|0,s+=(n&i|r&~i)+t[12]-1926607734|0,s=(s<<20|s>>>12)+n|0,i+=(s^n^r)+t[5]-378558|0,i=(i<<4|i>>>28)+s|0,r+=(i^s^n)+t[8]-2022574463|0,r=(r<<11|r>>>21)+i|0,n+=(r^i^s)+t[11]+1839030562|0,n=(n<<16|n>>>16)+r|0,s+=(n^r^i)+t[14]-35309556|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^r)+t[1]-1530992060|0,i=(i<<4|i>>>28)+s|0,r+=(i^s^n)+t[4]+1272893353|0,r=(r<<11|r>>>21)+i|0,n+=(r^i^s)+t[7]-155497632|0,n=(n<<16|n>>>16)+r|0,s+=(n^r^i)+t[10]-1094730640|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^r)+t[13]+681279174|0,i=(i<<4|i>>>28)+s|0,r+=(i^s^n)+t[0]-358537222|0,r=(r<<11|r>>>21)+i|0,n+=(r^i^s)+t[3]-722521979|0,n=(n<<16|n>>>16)+r|0,s+=(n^r^i)+t[6]+76029189|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^r)+t[9]-640364487|0,i=(i<<4|i>>>28)+s|0,r+=(i^s^n)+t[12]-421815835|0,r=(r<<11|r>>>21)+i|0,n+=(r^i^s)+t[15]+530742520|0,n=(n<<16|n>>>16)+r|0,s+=(n^r^i)+t[2]-995338651|0,s=(s<<23|s>>>9)+n|0,i+=(n^(s|~r))+t[0]-198630844|0,i=(i<<6|i>>>26)+s|0,r+=(s^(i|~n))+t[7]+1126891415|0,r=(r<<10|r>>>22)+i|0,n+=(i^(r|~s))+t[14]-1416354905|0,n=(n<<15|n>>>17)+r|0,s+=(r^(n|~i))+t[5]-57434055|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~r))+t[12]+1700485571|0,i=(i<<6|i>>>26)+s|0,r+=(s^(i|~n))+t[3]-1894986606|0,r=(r<<10|r>>>22)+i|0,n+=(i^(r|~s))+t[10]-1051523|0,n=(n<<15|n>>>17)+r|0,s+=(r^(n|~i))+t[1]-2054922799|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~r))+t[8]+1873313359|0,i=(i<<6|i>>>26)+s|0,r+=(s^(i|~n))+t[15]-30611744|0,r=(r<<10|r>>>22)+i|0,n+=(i^(r|~s))+t[6]-1560198380|0,n=(n<<15|n>>>17)+r|0,s+=(r^(n|~i))+t[13]+1309151649|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~r))+t[4]-145523070|0,i=(i<<6|i>>>26)+s|0,r+=(s^(i|~n))+t[11]-1120210379|0,r=(r<<10|r>>>22)+i|0,n+=(i^(r|~s))+t[2]+718787259|0,n=(n<<15|n>>>17)+r|0,s+=(r^(n|~i))+t[9]-343485551|0,s=(s<<21|s>>>11)+n|0,e[0]=i+e[0]|0,e[1]=s+e[1]|0,e[2]=n+e[2]|0,e[3]=r+e[3]|0}_dataLength;_bufferLength;_state=new Int32Array(4);_buffer=new ArrayBuffer(68);_buffer8;_buffer32;constructor(){this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(oe.stateIdentity),this}appendStr(e){let t=this._buffer8,i=this._buffer32,s=this._bufferLength,n,r;for(r=0;r<e.length;r+=1){if(n=e.charCodeAt(r),n<128)t[s++]=n;else if(n<2048)t[s++]=(n>>>6)+192,t[s++]=n&63|128;else if(n<55296||n>56319)t[s++]=(n>>>12)+224,t[s++]=n>>>6&63|128,t[s++]=n&63|128;else{if(n=(n-55296)*1024+(e.charCodeAt(++r)-56320)+65536,n>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[s++]=(n>>>18)+240,t[s++]=n>>>12&63|128,t[s++]=n>>>6&63|128,t[s++]=n&63|128}s>=64&&(this._dataLength+=64,oe._md5cycle(this._state,i),s-=64,i[0]=i[16])}return this._bufferLength=s,this}appendAsciiStr(e){let t=this._buffer8,i=this._buffer32,s=this._bufferLength,n,r=0;for(;;){for(n=Math.min(e.length-r,64-s);n--;)t[s++]=e.charCodeAt(r++);if(s<64)break;this._dataLength+=64,oe._md5cycle(this._state,i),s=0}return this._bufferLength=s,this}appendByteArray(e){let t=this._buffer8,i=this._buffer32,s=this._bufferLength,n,r=0;for(;;){for(n=Math.min(e.length-r,64-s);n--;)t[s++]=e[r++];if(s<64)break;this._dataLength+=64,oe._md5cycle(this._state,i),s=0}return this._bufferLength=s,this}getState(){let e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(e){let t=e.buffer,i=e.state,s=this._state,n;for(this._dataLength=e.length,this._bufferLength=e.buflen,s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],n=0;n<t.length;n+=1)this._buffer8[n]=t.charCodeAt(n)}end(e=!1){let t=this._bufferLength,i=this._buffer8,s=this._buffer32,n=(t>>2)+1,r;if(this._dataLength+=t,i[t]=128,i[t+1]=i[t+2]=i[t+3]=0,s.set(oe.buffer32Identity.subarray(n),n),t>55&&(oe._md5cycle(this._state,s),s.set(oe.buffer32Identity)),r=this._dataLength*8,r<=4294967295)s[14]=r;else{let a=r.toString(16).match(/(.*?)(.{0,8})$/);if(a===null)return;let h=parseInt(a[2],16),m=parseInt(a[1],16)||0;s[14]=h,s[15]=m}return oe._md5cycle(this._state,s),e?this._state:oe._hex(this._state)}},Pe=oe;l(Pe,"Md5"),F(Pe,"stateIdentity",new Int32Array([1732584193,-271733879,-1732584194,271733878])),F(Pe,"buffer32Identity",new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),F(Pe,"hexChars","0123456789abcdef"),F(Pe,"hexOut",[]),F(Pe,"onePassHasher",new oe);var Me=class extends De{m_label;constructor(e){let t=e.icon??"var( --x4-icon-exclamation )";e.icon=void 0;let i=e.buttons===void 0?["ok"]:e.buttons;e.buttons=void 0,super(e);let s=e.message;this.form.updateContent(new w({style:{padding:8},content:[t?new L({cls:"icon",icon:t}):null,this.m_label=new I({cls:"text",text:s,multiline:!0})]}),i),this.on("btnClick",n=>{this.m_props.click&&ce(()=>{this.m_props.click(n.button)})})}set text(e){this.m_label.text=e}static show(e){let t;return B(e)||le(e)?t=new Me({message:e,click:()=>{}}):t=new Me(e),t.show(),t}static async showAsync(e){return new Promise((t,i)=>{let s,n=l(a=>{t(a)},"cb");B(e)||le(e)?s={message:e,click:n}:s={...e,click:n},new Me(s).show()})}static alert(e,t=null){new Me({cls:"warning",title:t,message:e,buttons:["ok"],click:()=>{}}).show()}};l(Me,"MessageBox");var $e=class extends De{m_edit;constructor(e){e.buttons=void 0,e.width=e.width??500,super(e),this.form.updateContent(new w({cls:"panel",content:[this.m_edit=new U({flex:1,autoFocus:!0,label:e.message,value:e.value})]}),["ok","cancel"]),e.click&&this.on("btnClick",t=>{t.button==="ok"&&ce(()=>{this.m_props.click(this.m_edit.value)})})}set text(e){this.m_edit.label=e}static show(e,t){let i;return B(e)||le(e)?i=new $e({message:e,click:t}):i=new $e(e),i.show(),i}};l($e,"PromptDialogBox");var vi=class extends H{m_ui_title;m_ui_body;constructor(e){super(e);let t=e?.sens=="horizontal"?"@hlayout":"@vlayout";this.m_ui_title=new I({cls:"title",text:this.m_props.title}),this.m_ui_body=new u({cls:"body "+t,content:this.m_props.content,style:e.bodyStyle})}render(){let e=this.m_props.gadgets??[],t=this.m_props.icon?new L({icon:this.m_props.icon}):null;super.setContent([new w({cls:"title",content:[t,this.m_ui_title,...e]}),this.m_ui_body])}setContent(e){this.m_ui_body.setContent(e)}set title(e){this.m_ui_title.text=e}};l(vi,"Panel");var Ht=class{text;cls};l(Ht,"CellData"),F(Ht,"empty_cell",{text:""});var pt=class extends H{m_columns;m_row_limit;m_cells_data;m_rows_data;m_view;m_container;m_header;m_itemHeight;m_topIndex;m_visible_cells;m_row_count;m_selection;m_editor;m_autoedit;m_lockupdate;m_auto_row_count;m_recycler;m_used_cells;constructor(e){super(e),this.m_columns=e.columns,this.m_autoedit=e.autoedit,this.m_lockupdate=0,this.m_cells_data=new Map,this.m_rows_data=new Map,this.m_itemHeight=0,this.m_selection={row:0,col:0},this.m_row_count=0,this.m_auto_row_count=!1,this.m_recycler=[],this.m_used_cells=[],e.maxrows===void 0?(this.m_row_limit=0,this.m_auto_row_count=!0):e.maxrows<0?(this.m_row_limit=0,this.m_auto_row_count=!0):this.m_row_limit=e.maxrows,this.setAttribute("tabindex",0),this.setDomEvent("click",t=>this._itemClick(t)),this.setDomEvent("dblclick",t=>this._itemDblClick(t)),this.setDomEvent("keydown",t=>this._handleKey(t)),this.setDomEvent("keypress",t=>this._keyPress(t)),this.setDomEvent("focus",()=>this._focus(!0)),this.setDomEvent("focusout",()=>this._focus(!1)),this.setDomEvent("contextmenu",t=>this._ctxMenu(t)),this.mapPropEvents(e,"dblClick","selectionChange","contextMenu","change")}componentCreated(){super.componentCreated(),this._updateScroll(!0)}setColWidth(e,t){this._on_col_resize(e,t),this.update(10)}getColWidth(e){if(this.m_columns[e])return this.m_columns[e].width}setColTitle(e,t){console.assert(this.m_columns[e]!==void 0),this.m_columns[e].title=t,this.update(10)}reset(e){e&&(this.m_columns=e),this.m_cells_data=new Map,this.m_rows_data=new Map,this.update(10)}insertRow(e){let t=new Map;this.m_cells_data.forEach((s,n)=>{let{row:r,col:a}=Ci(n);r>=e?t.set(ve(r+1,a),s):t.set(n,s)});let i=new Map;this.m_rows_data.forEach((s,n)=>{n>=e?i.set(n+1,s):i.set(n,s)}),this.m_cells_data=t,this.m_rows_data=i,this._buildItems()}deleteRow(e){let t=new Map,i=new Map;this.m_cells_data.forEach((s,n)=>{let{row:r,col:a}=Ci(n);r>e?t.set(ve(r-1,a),s):r<e&&t.set(n,s)}),this.m_rows_data.forEach((s,n)=>{n>e?i.set(n-1,s):n<e&&i.set(n,s)}),this.m_cells_data=t,this.m_rows_data=i,this._buildItems()}insertCol(e,t){let i=e;if(i<0&&(i=this.m_columns.length+1),this.m_columns.splice(i,0,t),e>=0){let s=new Map;this.m_cells_data.forEach((n,r)=>{let{row:a,col:h}=Ci(r);h>=e?s.set(ve(a,h+1),n):s.set(r,n)}),this.m_cells_data=s}this.update()}deleteCol(e){this.m_columns.splice(e,1);let t=new Map;this.m_cells_data.forEach((i,s)=>{let{row:n,col:r}=Ci(s);r>e?t.set(ve(n,r-1),i):r<e&&t.set(s,i)}),this.m_cells_data=t,this.update()}_getCellData(e,t,i=!1){let s=this.m_cells_data.get(ve(e,t));return s===void 0?i?null:Ht.empty_cell:s}_focus(e){this.setClass("@focus",e)}_ctxMenu(e){let t=e.target,i=this.dom;for(;t&&t!=i;){let s=u.getElement(t),n=s.getData("row-id"),r=s.getData("col-id");if(n!==void 0){this._selectItem(n,r),this.emit("contextMenu",pe(e,{row:n,col:r,item:s})),e.preventDefault();return}t=t.parentElement}}render(){this.m_recycler=[],this.m_container=new u({cls:"content"}),this.m_view=new u({cls:"@scroll-view",flex:1,dom_events:{sizechange:()=>this._updateScroll(!0),scroll:()=>this._updateScroll(!1)},content:this.m_container});let e=this.m_columns.map((t,i)=>{let s=new u({cls:"@cell c"+i,content:t.title?t.title:"&nbsp",flex:t.width<0?-t.width:void 0,attrs:{title:t.title},style:{width:t.width>=0?t.width:void 0,minWidth:t.min_width}});return new _e({target:s,sens:"right",resize:n=>{this._on_col_resize(i,n.size.width)}}),t.$col=s,s});this.m_header=new w({cls:"@header",content:e}),this.setContent([this.m_header,this.m_view])}_on_col_resize(e,t){this.m_columns[e]&&(t<=0?this.m_columns[e].width=-1:this.m_columns[e].width=t,this._updateScroll(!0))}_computeItemHeight(){let e=f.createElement("div");e.classList.add("x-spreadsheet");let t=f.createElement("div");t.classList.add("content");let i=f.createElement("div");i.classList.add("x-cell"),i.append("&nbsp;"),t.appendChild(i),e.appendChild(t),this.dom.appendChild(e);let s=i.getBoundingClientRect();this.dom.removeChild(e),this.m_itemHeight=s.height}_calcColWidths(e){let t=0,i=0,s=new Int32Array(this.m_columns.length),n=new Int32Array(this.m_columns.length),r=new Int32Array(this.m_columns.length);if(this.m_columns.forEach((a,h)=>{let m=Math.max(10,a.min_width??0);if(a.width>0){let c=Math.max(a.width,m);t+=c,s[h]=c}else{let c=-a.width;n[h]=c,i+=c}r[h]=m}),i){let a=e-t;for(let h=0;h<this.m_columns.length&&i;h++)if(!s[h]){let m=Math.round(a/i)*n[h];m<r[h]&&(m=r[h]),s[h]=m,a-=m,i-=n[h]}}return s}_createCell(){let e;return this.m_recycler.length?(e=this.m_recycler.pop(),e.clearClasses(),e.addClass("@comp")):e=new u({cls:"@cell"}),e.dom||this.m_container.appendChild(e),e}_buildItems(){let e=this.getBoundingRect(),t=this.m_header.getBoundingRect(),i=e.height-t.height;this.m_itemHeight==0&&this._computeItemHeight();let s=this.m_topIndex*this.m_itemHeight,n=0,r=0,a=this.m_topIndex,h=this.m_row_limit;this.m_auto_row_count&&(this.m_row_limit=h=this.getMaxRowCount());let m=0;if(h*this.m_itemHeight>i){let x=u.getScrollbarSize();e.width-=x,m=x}let c=!!(this.m_topIndex&1);this.m_visible_cells=new Map,this.m_used_cells.forEach(x=>{this.m_recycler.push(x)}),this.m_used_cells=[];let d=this._calcColWidths(e.width),p=0;for(let x=0;x<d.length;x++)p+=d[x];p<=e.width?(this.m_view.setStyleValue("overflow-x","hidden"),this.m_header.setStyleValue("width",e.width),this.m_container.setStyleValue("width",e.width),this.m_container.setStyle({height:h*this.m_itemHeight})):(this.m_header.setStyleValue("width",p),this.m_container.setStyleValue("width",p),this.m_view.setStyleValue("overflow-x","visible"),this.m_container.setStyle({height:h*this.m_itemHeight,width:p})),this.m_view.addClass("@hidden");let g=100;for(;n<i&&a<h&&--g>0;){let x=this.m_rows_data.get(a),_=0,y=this.m_columns.map((A,P)=>{let W="@cell c"+P;A.align&&(W+=" "+A.align),A.cls&&(W+=" "+A.cls);let D,b=this._getCellData(a,P),E=b.text;return A.renderer&&E.length&&(E=A.renderer(E,{row:a,col:P})),W+=c?" even":" odd",x&&(W+=" "+x),D=this._createCell(),this.m_used_cells.push(D),D.setContent(E),D.addClass(W),D.setStyle({left:_,top:s+n,width:d[P],height:this.m_itemHeight}),this.m_selection.row==a&&this.m_selection.col==P&&D.addClass("@selected"),D.setData("row-id",a),D.setData("col-id",P),b.cls&&D.addClass(b.cls),this.m_visible_cells.set(ve(a,P),D),_+=d[P],D});c=!c,n+=this.m_itemHeight,a++,r++}this.m_recycler.forEach(x=>{x.addClass("@hidden")}),this.m_row_count=r,this.m_view.removeClass("@hidden"),this.setClass("empty",h==0)}_itemClick(e){let t=e.target;if(this.m_editor&&this.m_editor.dom.contains(t))return;let i=u.getElement(t,u);if(!i)return;let s=i.getData("row-id"),n=i.getData("col-id");s===void 0||n===void 0||this._selectItem(s,n)}_itemDblClick(e){let t=e.target;if(this.m_editor&&this.m_editor.dom.contains(t))return;let i=u.getElement(t),s=i.getData("row-id"),n=i.getData("col-id");s===void 0||n===void 0||(this.emit("dblClick",ye({row:s,col:n})),this.editCell(s,n))}_selectItem(e,t,i){e<0&&(e=0),e>this.m_row_limit-1&&(e=this.m_row_limit-1),t<0&&(t=0);let s=this.m_columns.length-1;t>s&&(t=s),!(this.m_selection.row==e&&this.m_selection.col==t)&&this.select(e,t,i)}_scrollIntoView(e,t){let i=l((n,r="nearest")=>{n.scrollIntoView({block:r})},"doscroll"),s=this.m_topIndex+this.m_row_count-1;e<this.m_topIndex?(this.m_topIndex=e,this.m_view.dom.scrollTop=this.m_topIndex*this.m_itemHeight,this._buildItems(),i(this._findItem(e,t),"start")):e>s?(this.m_topIndex=e-this.m_row_count+1,this.m_view.dom.scrollTop=this.m_topIndex*this.m_itemHeight,this._buildItems(),i(this._findItem(e,t),"end")):i(this._findItem(e,t))}_findItem(e,t){return this.m_visible_cells?this.m_visible_cells.get(ve(e,t)):null}_updateScroll(e){if(!this?.m_view?.dom)return;let t=Math.floor(this.m_view.dom.scrollTop/(this.m_itemHeight||1));(t!=this.m_topIndex||e)&&(this.m_topIndex=t,this._buildItems());let i=this.m_view.dom.scrollLeft;this.m_header.setStyleValue("left",-i)}_moveSel(e,t){let i=this.m_selection,s=i.row??0,n=i.col??0;if(e==1?s++:e==-1?s--:e==2?s+=this.m_row_count-1:e==-2?s-=this.m_row_count-1:e==3?s=this.m_row_limit-1:e==-3&&(s=0),t==1)n++;else if(t==-1)n--;else if(t==2)n=this.m_columns.length-1;else if(t==-2)n=0;else if(t==3){n++;let r=this.m_columns.length-1;e:for(let a=0;a<2;a++){for(;n<r;){if(this.m_columns[n].createEditor!==null)break e;n++}n>r&&(s++,n=0)}}else if(t==-3){n--;let r=this.m_columns.length-1;e:for(let a=0;a<2;a++){for(;n>=0;){if(this.m_columns[n].createEditor!==null)break e;n--}n<0&&(s--,n=r)}}this._selectItem(s,n,!0)}_handleKey(e){let t=e.target;if(!(this.m_editor&&this.m_editor.dom.contains(t)))switch(e.key){case"ArrowDown":case"Down":{this._moveSel(1,0);break}case"ArrowUp":case"Up":{this._moveSel(-1,0);break}case"PageUp":{this._moveSel(-2,0);break}case"PageDown":{this._moveSel(2,0);break}case"ArrowLeft":case"Left":{this._moveSel(0,-1);break}case"ArrowRight":case"Right":{this._moveSel(0,1);break}case"Home":{e.ctrlKey?this._moveSel(-3,0):this._moveSel(0,-2);break}case"End":{e.ctrlKey?this._moveSel(3,0):this._moveSel(0,2);break}case"Enter":{this.editCurCell(),e.stopPropagation(),e.preventDefault();break}case"Delete":{this.clearCell(this.m_selection.row,this.m_selection.col);break}default:break}}_keyPress(e){let t=e.target;this.m_editor&&this.m_editor.dom.contains(t)||e.ctrlKey||e.altKey||this.editCurCell(e.key)}getSelection(){return this.m_selection}select(e,t,i=!0){if(this.m_selection.row==e&&this.m_selection.col==t)return;let s=this._findItem(this.m_selection.row,this.m_selection.col);s&&s.removeClass("@selected"),this.m_selection={row:e,col:t},i&&this._scrollIntoView(e,t);let n=this._findItem(e,t);n&&n.addClass("@selected"),this.emit("selectionChange",ie({row:e,col:t}))}rowCount(){return this.m_row_limit}getMaxRowCount(){let e=0;return this.m_cells_data.forEach((t,i)=>{let s=Math.round(i/1e3)+1;e<s&&(e=s)}),e}getColCount(){return this.m_columns.length}setRowStyle(e,t){this.m_rows_data.set(e,t),this.m_lockupdate==0&&this._buildItems()}getRowStyle(e){return this.m_rows_data.get(e)}setCellStyle(e,t,i){let s=this._getCellData(e,t,!0);if(s||(s={text:""},this.m_cells_data.set(ve(e,t),s)),s.cls=i,this.m_lockupdate==0&&this.m_visible_cells){let n=this._findItem(e,t);n?n.setClass(i,!0):this._buildItems()}}getCellText(e,t){return this._getCellData(e,t).text}getCellNumber(e,t){let i=this._getCellData(e,t).text;return Vi(i)}clearRow(e){for(let t=0;t<this.m_columns.length;t++)this.clearCell(e,t);this.update(10)}clearCell(e,t){this.setCellText(e,t,null)}editCurCell(e){this.editCell(this.m_selection.row,this.m_selection.col,e)}editCell(e,t,i){if(!this.m_autoedit||this.m_columns[t].createEditor===null)return;this._scrollIntoView(e,t);let n=this._findItem(e,t).dom,r=n.parentElement,a=n.getBoundingClientRect(),h=r.getBoundingClientRect(),m=this._getCellData(e,t,!0),c=l((p,g,x)=>new U(p),"edtBuilder");this.m_columns[t].createEditor&&(c=this.m_columns[t].createEditor);let d=i||(m?m.text:"");this.m_editor=c({cls:"@editor",style:{left:a.left-h.left,top:a.top-h.top,width:a.width-1,height:a.height-1},tabIndex:!1,value:d,data:{row:e,col:t}},e,t),this.m_editor&&(r.appendChild(this.m_editor._build()),this._setupEditor(),this.m_editor.setData("old-value",d),this.m_editor.focus(),this.m_editor instanceof U&&this.m_editor.selectAll())}_setupEditor(){let e=l((t,i)=>{Ni(()=>{this.killEditor(!0),this._moveSel(t,i),this.editCurCell()})},"movesel");if(this.m_editor instanceof U){let i=this.m_editor.input;i.setDomEvent("blur",()=>{this.killEditor(!0)}),i.setDomEvent("keydown",s=>{if(!s.defaultPrevented)switch(s.key){case"Escape":{this.killEditor(!1),s.stopPropagation(),s.preventDefault();break}case"Enter":case"Tab":{let n=3;s.shiftKey&&(n=-3),e(0,n),s.stopPropagation(),s.preventDefault();break}case"ArrowUp":case"Up":{e(-1,0),s.stopPropagation(),s.preventDefault();break}case"ArrowDown":case"Down":{e(1,0),s.stopPropagation(),s.preventDefault();break}}})}else if(this.m_editor instanceof Ie){let t=this.m_editor.input;t.setDomEvent("blur",()=>{this.killEditor(!0)}),t.setDomEvent("keydown",i=>{switch(i.key){case"Escape":{this.killEditor(!1),i.stopPropagation(),i.preventDefault();break}case"Enter":case"Tab":{let s=3;i.shiftKey&&(s=-3),e(0,s),i.stopPropagation(),i.preventDefault();break}}}),this.m_editor.showPopup(),this.m_editor.on("change",i=>{this.killEditor(!0)}),this.m_editor.on("cancel",i=>{this.killEditor(!1)})}}killEditor(e){if(this.m_editor){if(e){let i,s;this.m_editor instanceof U?i=this.m_editor.value:this.m_editor instanceof Ie&&(s=this.m_editor.value,i=this.m_editor.valueText);let n=this.m_editor.getData("row"),r=this.m_editor.getData("col"),a=this.m_editor.getData("old-value");this.setCellText(n,r,i);let h=M(i,{row:n,col:r,oldValue:a,id:s});this.emit("change",h),h.defaultPrevented&&this.setCellText(n,r,a)}let t=this.m_editor;ce(()=>{t.dispose()}),this.m_editor=null,this.focus()}}clearData(){this.m_cells_data=new Map,this.m_rows_data=new Map}setCellText(e,t,i){if(i==null||i.length==0)this.m_cells_data.delete(ve(e,t)),i="";else{let s=this._getCellData(e,t,!0);s||(s={}),s.text=i,this.m_cells_data.set(ve(e,t),s)}if(this.m_lockupdate==0&&this.m_visible_cells){let s=this._findItem(e,t);s?(this.m_columns[t].renderer&&(i=this.m_columns[t].renderer(i,{row:e,col:t})),s.setContent(i)):this._buildItems()}}lockUpdate(e){e?this.m_lockupdate++:--this.m_lockupdate==0&&this._updateScroll(!0)}};l(pt,"Spreadsheet");function ve(o,e){return o*1e3+e}l(ve,"_mkid");function Ci(o){return{row:Math.floor(o/1e3)|0,col:o%1e3|0}}l(Ci,"_getid");var wi=class extends u{m_fields;m_record;m_sheet;m_label_w;constructor(e){super(e),this.mapPropEvents(e,"change")}render(e){this.m_record=e.record,this.m_fields=e.fields??[],this.m_label_w=e.labelWidth,this.m_sheet=new pt({cls:"@fit",columns:[{title:k.global.property,width:this.m_label_w>0?this.m_label_w:-1,cls:"property"},{title:k.global.value,width:-1,createEditor:(...t)=>this._editCell(...t),renderer:(...t)=>this._renderCell(...t)}],autoedit:!0,change:t=>this._cellChange(t)}),this._updateProperties(),this.setContent(this.m_sheet)}setFields(e){e?(this.m_fields=e,this._updateProperties()):this.m_sheet.clearData()}setRecord(e){this.m_record=e,this._updateProperties()}_updateProperties(){this.m_sheet.lockUpdate(!0),this.m_sheet.clearData(),this.m_fields.forEach((e,t)=>{this.m_sheet.setCellText(t,0,e.title),this.m_record?this.m_sheet.setCellText(t,1,this.m_record.getField(e.id)):this.m_sheet.setCellText(t,1,e.value)}),this.m_sheet.lockUpdate(!1)}_cellChange(e){let t=e.context,i=e.value;if(t.col!=1)return;let s=this.m_fields[t.row];switch(s.type){default:case"string":break;case"number":break;case"password":break;case"boolean":break;case"choice":break}this.m_record?this.m_record.setField(s.id,i):s.value=i,this.emit("change",M(i,s))}_renderCell(e,t){switch(this.m_fields[t.row].type){default:case"string":break;case"number":break;case"password":{e="\u25CF\u25CF\u25CF\u25CF\u25CF\u25CF";break}case"boolean":break;case"choice":break}return e}_editCell(e,t,i){let s=this.m_fields[t],n;switch(s.type){default:case"string":{n=new U(e);break}case"number":{n=new U(e);break}case"password":{e.type="password",e.value=this.m_record.getField(s.id),n=new j(e);break}case"boolean":{n=new ke(e);break}case"choice":break}return n}_choicesFromArray(e){return e.map(i=>typeof i=="object"?{id:i.id,text:i.value}:{id:i,text:""+i})}_choicesFromStore(e,t){let i=[];for(let s=0,n=e.count;s<n;s++){let r=e.getByIndex(s);i.push({id:r.getID(),text:r.getField(t)})}return i}};l(wi,"PropertyEditor");var ft=class extends u{m_ui_input;constructor(e){super(e),this.mapPropEvents(e,"change")}render(e){let t=e.text??"",i=e.name??e.group,s=e.labelWidth??-1,n=e.checked??!1,r=e.align??"left",a=e.value,h=e.icon;this.setTag("label"),this.addClass("@hlayout"),this.addClass(r),this._setTabIndex(e.tabIndex),n&&this.addClass("checked"),this.setContent([this.m_ui_input=new j({type:"radio",name:i,tabIndex:e.tabIndex,value:a,attrs:{checked:n?"":void 0},dom_events:{change:()=>this._change(),focus:()=>this.m_ui_input.focus()}}),new I({ref:"label",icon:h,text:t,width:s==="flex"?void 0:s,flex:s==="flex"?1:void 0,style:{order:r=="right"?-1:void 0}})])}_change(){let t=".x-input[name="+this.m_props.name+"]";f.querySelectorAll(t).forEach(n=>{u.getElement(n,ft).removeClass("checked")});let s=this.m_ui_input.dom;this.setClass("checked",s.checked),this.emit("change",M(!0))}get check(){return this.m_ui_input?this.m_ui_input.dom.checked:this.m_props.checked}set check(e){let t=this.m_ui_input.dom;e?(t&&(t.checked=!0),this.m_props.checked=!0):(t&&(t.checked=!1),this.m_props.checked=!1)}get text(){return this.itemWithRef("label").text}set text(e){this.itemWithRef("label").text=e}};l(ft,"RadioBtn");var Ei=class extends w{m_els;m_input;constructor(e){super(e),e.steps=e.steps??5}render(e){let t=e.shape??"star",i=e.value??0;this.m_input=new j({cls:"@hidden",name:e.name,value:""+i}),this.addClass(t),this.setDomEvent("click",s=>this._onclick(s)),this.m_els=[];for(let s=0;s<e.steps;s++){let n="item";s+1<=i&&(n+=" checked");let r=new u({tag:"option",cls:n,data:{value:s+1}});this.m_els.push(r)}this.m_els.push(this.m_input),this.setContent(this.m_els)}getValue(){return this.m_props.value??0}set value(e){this.m_props.value=e;for(let t=0;t<this.m_props.steps;t++)this.m_els[t].setClass("checked",this.m_els[t].getData("value")<=e);this.m_input.value=""+this.m_props.value}set steps(e){this.m_props.steps=e,this.update()}set shape(e){this.removeClass(this.m_props.shape),this.m_props.shape=e,this.addClass(this.m_props.shape)}_onclick(e){let t=!0;for(let i=this.dom.firstChild;i;i=i.nextSibling){let s=u.getElement(i);s.setClass("checked",t),i==e.target&&(this.m_input.value=s.getData("value"),t=!1)}this.emit("change",M(this.m_props.value))}};l(Ei,"Rating");var yi=class extends Be{m_sidebar;m_content;constructor(e){super(e),this.addClass("@hlayout"),this.m_sidebar=new H({cls:"@side-bar",width:e.bar_width??void 0}),this.m_content=new w({flex:1,cls:"@tab-container"})}render(){let e=[];this.m_cards.forEach(t=>{e.push(t.selector)}),this.m_sidebar.setContent(new H({flex:1,cls:"content",content:[this.m_props.logo,...e]})),this.setContent([this.m_sidebar,this.m_props.bar_sizable?new rt({orientation:"horizontal",sizing:"before"}):void 0,this.m_content])}_prepareSelector(e){return new z({text:e.title,icon:e.icon,tooltip:e.title,click:()=>{this.switchTo(e.name)}})}_preparePage(e){super._preparePage(e),e.dom||this.m_content.appendChild(e)}};l(yi,"SideBarView");var jn=/^-?\d+(\.\d+)?$/;function Un(o){return o*Math.PI/180}l(Un,"d2r");function Is(o,e,t,i){let s=Un(i);return{x:o+t*Math.cos(s),y:e+t*Math.sin(s)}}l(Is,"p2c");function se(o){return Math.round(o*1e3)/1e3}l(se,"num");function Qi(o,...e){return e=e.map(t=>typeof t=="number"&&isFinite(t)?se(t):t),String.raw(o,...e)}l(Qi,"clean");var Se=class{m_tag;m_attrs;m_style;constructor(e){this.m_tag=e,this.m_attrs=new Map,this.m_style=new Map}render(){return`<${this.m_tag} ${this.renderAttrs()} ${this.renderStyle()}>${this.renderContent()}</${this.m_tag}>`}stroke(e,t){return this.attr("stroke",e),t!==void 0&&this.attr("stroke-width",t+"px"),this}strokeWidth(e){return this.attr("stroke-width",e+"px"),this}fill(e){return this.attr("fill",e),this}attr(e,t){return this.m_attrs.set(e,t),this}style(e,t){return t===void 0||t===""||t===void 0?(this.m_style.delete(e),this):(!$t[e]&&(tt(t)||jn.test(t))&&(t=t+"px"),this.m_style.set(e,""+t),this)}class(e){let t=this.m_attrs.get("class");return this.m_attrs.set("class",(t??" "+e).trim()),this}renderAttrs(){if(!this.m_attrs.size)return"";let e="";return this.m_attrs.forEach((t,i)=>{e+=` ${i} = "${t}"`}),e}renderStyle(){if(!this.m_style.size)return"";let e='style="';return this.m_style.forEach((t,i)=>{e+=`${i}:${t};`}),e+'"'}renderContent(){return""}clip(e){return this.attr("clip-path",`url(#${e})`),this}transform(e){return this.attr("transform",e),this}rotate(e,t,i){return this.transform(`rotate( ${e} ${t} ${i} )`),this}translate(e,t){return this.transform(`translate( ${e} ${t} )`),this}scale(e){return this.transform(`scale( ${e} )`),this}};l(Se,"SVGItem");var zt=class extends Se{m_path;constructor(){super("path"),this.m_path=""}renderAttrs(){return this.attr("d",this.m_path),super.renderAttrs()}moveTo(e,t){return this.m_path+=Qi`M${e},${t}`,this}lineTo(e,t){return this.m_path+=Qi`L${e},${t}`,this}closePath(){return this.m_path+="Z",this}arc(e,t,i,s,n){let r=Is(e,t,i,s-90),a=Is(e,t,i,n-90),h=n-s<=180?"0":"1";return this.m_path+=Qi`M${r.x},${r.y}A${i},${i} 0 ${h} 1 ${a.x},${a.y}`,this}};l(zt,"SVGPath");var Vt=class extends Se{m_text;constructor(e,t,i){super("text"),this.m_text=i,this.attr("x",se(e)+""),this.attr("y",se(t)+"")}font(e){return this.attr("font-family",e),this}fontSize(e){return this.attr("font-size",e+""),this}fontWeight(e){return this.attr("font-weight",e),this}textAlign(e){let t;switch(e){case"left":t="start";break;case"center":t="middle";break;case"right":t="end";break;default:return this}return this.attr("text-anchor",t),this}verticalAlign(e){let t;switch(e){case"top":t="hanging";break;case"center":t="middle";break;case"bottom":t="baseline";break;default:return}return this.attr("alignment-baseline",t),this}renderContent(){return this.m_text}};l(Vt,"SVGText");var _t=class extends Se{constructor(e){super(e)}};l(_t,"SVGShape");var ki=class extends Se{m_id;m_stops;constructor(e,t,i,s){super("linearGradient"),this.m_id="gx-"+ki.g_id,this.attr("id",this.m_id),this.attr("x1",B(e)?e:se(e)+""),this.attr("x2",B(i)?i:se(i)+""),this.attr("y1",B(t)?t:se(t)+""),this.attr("y2",B(s)?s:se(s)+""),this.m_stops=[],ki.g_id++}get id(){return"url(#"+this.m_id+")"}addStop(e,t){return this.m_stops.push({offset:e,color:t}),this}renderContent(){let e=[];return this.m_stops.forEach(t=>{e.push(`<stop offset="${t.offset}%" stop-color="${t.color}"></stop>`)}),e.join(`
`)}},gt=ki;l(gt,"SVGGradient"),F(gt,"g_id",1);var ze=class extends Se{m_items;constructor(e="g"){super(e),this.m_items=[]}path(){let e=new zt;return this.m_items.push(e),e}text(e,t,i){let s=new Vt(e,t,i);return this.m_items.push(s),s}ellipse(e,t,i,s=i){let n=new _t("ellipse");return n.attr("cx",se(e)+""),n.attr("cy",se(t)+""),n.attr("rx",se(i)+""),n.attr("ry",se(s)+""),this.m_items.push(n),n}rect(e,t,i,s){let n=new _t("rect");return n.attr("x",se(e)+""),n.attr("y",se(t)+""),n.attr("width",se(i)+""),n.attr("height",se(s)+""),this.m_items.push(n),n}group(){let e=new ze;return this.m_items.push(e),e}linear_gradient(e,t,i,s){let n=new gt(e,t,i,s);return this.m_items.push(n),n}clear(){this.m_items=[]}renderContent(){let e=[];return this.m_items.forEach(t=>{e.push(t.render())}),e.join(`
`)}};l(ze,"SVGGroup");var es=class extends ze{constructor(){super("")}addClip(e,t,i,s){let n="c-"+es.g_clip_id++,r=new ze("clipPath");return r.attr("id",n),r.rect(e,t,i,s),this.m_items.push(r),n}render(){let e=[];return this.m_items.forEach(t=>{e.push(t.render())}),e.join(`
`)}},Rt=es;l(Rt,"SVGPathBuilder"),F(Rt,"g_clip_id",1);var Fi=class extends u{constructor(e){super(e),this.setTag("svg","http://www.w3.org/2000/svg"),this.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.setAttributes({viewBox:e.viewBox}),this.setContent(e.path)}};l(Fi,"SVGComponent");var Ii=class extends O{m_pages;m_curPage;constructor(e){super(e),this.m_pages=[],this.m_curPage=null,this.mapPropEvents(e,"change"),e.vertical?this.addClass("@vlayout"):this.addClass("@hlayout"),this.m_props.pages?.forEach(t=>this.addPage(t))}componentCreated(){this.m_props.default&&this.select(this.m_props.default,!0)}addPage(e){this.m_pages.push({...e}),this._updateContent()}render(){let e=[];this.m_pages.forEach(t=>{t.btn=new z({cls:t===this.m_curPage?"selected":"",text:t.title,icon:t.icon,click:()=>this._select(t,!0)}),e.push(t.btn)}),this.setContent(e)}select(e,t=!1){if(e){let i=this.m_pages.find(s=>s.id===e);return i?(this._select(i,t),!0):!1}else return this._select(null,t),!0}_select(e,t){if(this.m_curPage!=e){if(!this.dom){this.m_props.default=e.id;return}this.m_curPage&&(this.m_curPage.btn.removeClass("selected"),this.m_curPage.page&&this.m_curPage.page.hide()),this.m_curPage=e,t&&this.signal("change",M(e?e.id:null)),this.m_curPage&&(this.m_curPage.btn.addClass("selected"),this.m_curPage.page&&this.m_curPage.page.show())}}get selection(){return this.m_curPage?.page}};l(Ii,"TabBar");var Di=class extends Be{m_tab_selector;m_menu;constructor(e){super(e),this.m_tab_selector=!!e.tab_selector,this.m_menu=e.menu,this.addClass("@vlayout")}render(){let e=[],t=[];this.m_menu&&(this.m_menu.addClass("@button @tab-btn"),this.m_menu.removeClass("@menu-item"),e.push(this.m_menu)),this.m_cards.forEach(i=>{e.push(i.selector),i.page instanceof Function||t.push(i.page)}),this.m_tab_selector&&t.unshift(new w({cls:"@tab-switch",content:e})),this.setContent(t)}_updateSelector(){}_prepareSelector(e){return new z({cls:"@tab-btn",text:e.title,icon:e.icon,click:()=>{this.switchTo(e.name)}})}_preparePage(e){super._preparePage(e),e.dom||this.appendChild(e)}};l(Di,"TabView");var Pi=class extends u{constructor(e){super(e),this.mapPropEvents(e,"change")}render(e){e.text=e.text??"",this.setAttribute("tabindex",e.tabIndex??0),e.spellcheck===!1&&this.setAttribute("spellcheck","false"),e.readOnly!==void 0&&this.setAttribute("readonly",e.readOnly),e.rows&&this.setAttribute("rows",e.rows),e.placeHolder&&this.setAttribute("placeholder",e.placeHolder),e.autoFocus&&this.setAttribute("autofocus",e.autoFocus),e.name&&this.setAttribute("name",e.name),e.autoGrow&&(this.m_props.autoGrow=!0,this.setAttribute("rows",this._calcHeight(e.text)),this.setDomEvent("keydown",()=>{ce(()=>this._updateHeight())})),this.setDomEvent("keydown",t=>{t.stopPropagation()}),this.setTag("textarea"),this.setDomEvent("input",()=>this._change())}_change(){this.emit("change",M(this.value))}componentCreated(){this.value=this.m_props.text}get value(){return this.dom?this.dom.value:this.m_props.text}set value(e){this.m_props.text=e??"",this.dom&&(this.dom.value=this.m_props.text,this.m_props.autoGrow&&this.setAttribute("rows",this._calcHeight(this.m_props.text)))}get text(){return this.value}set text(e){this.value=e}_calcHeight(e){return 1+(e.match(/\n/g)||[]).length}_updateHeight(){let e=this.value,t=this._calcHeight(e);this.getData("lines")!=t&&(this.setAttribute("rows",t),this.setData("lines",t))}insertText(e){this.appendText(e)}appendText(e){if(this.dom){let t=this.dom,i=t.selectionEnd;t.setRangeText(e,i,i,"end")}}replaceText(e){this.dom&&this.dom.setRangeText(e)}getSelection(){if(this.dom){let e=this.dom;return{start:e.selectionStart,end:e.selectionEnd}}else return{start:0,end:0}}setSelection(e){if(this.dom){let t=this.dom;e.start!==void 0&&(t.selectionStart=e.start),e.end!==void 0&&(t.selectionEnd=e.end)}}getStoreValue(){return this.value}setStoreValue(e){this.value=e}};l(Pi,"TextArea");var Mi=class extends q{m_message;m_icon;constructor(e){super(e),this.m_message=e.message,this.m_icon=e.icon,this.enableMask(!1),this.addClass("@non-maskable")}render(){this.addClass("@hlayout"),this.setContent([new I({icon:this.m_icon,text:this.m_message})])}show(){this.show=super.show,this.displayAt(9999,9999,"br",{x:0,y:-24});let e=1;this.startTimer("fadeout",2e3,!1,()=>{this.startTimer("opacity",100,!0,()=>{this.setStyleValue("opacity",e),e-=.1,e<0&&this.dispose()})})}};l(Mi,"Toaster");function Kn(o){return S({node:o})}l(Kn,"EvExpand");var Si=class extends H{m_view;m_container;m_selection;constructor(e){super(e),e.root=e.root,e.indent=e.indent??8,e.gadgets=e.gadgets,e.sort=e.sort??!1,this.m_selection=null,this.m_container=new O({cls:"@scroll-container"}),this.m_view=new O({cls:"@scroll-view",flex:1,content:this.m_container}),this.setContent([this.m_view,e.gadgets?new w({cls:"gadgets",content:e.gadgets}):null]),this.setDomEvent("click",t=>this._click(t)),this.setDomEvent("dblclick",t=>this._click(t)),this.setDomEvent("contextmenu",t=>this._handleCtxMenu(t)),e.canDragItems&&(this.setDomEvent("dragstart",t=>{let s=u.getElement(t.target,u)?.getData("node");s?(t.dataTransfer.effectAllowed="move",t.dataTransfer.items.add(JSON.stringify({type:"treeview",id:s.id}),"string")):(t.preventDefault(),t.stopPropagation())}),this.setDomEvent("dragover",t=>this._dragEnter(t)),this.setDomEvent("dragenter",t=>this._dragEnter(t)),this.setDomEvent("dragend",t=>this._dragLeave(t)),this.setDomEvent("dragleave",t=>this._dragLeave(t)),this.setDomEvent("drop",t=>this._dragLeave(t)),this.setDomEvent("drop",t=>this._drop(t))),this.mapPropEvents(e,"dblclick","drag","selectionchange","contextMenu")}_dragEnter(e){e.preventDefault();let t=u.getElement(e.target,u);t?.getData("node")&&(t.addClass("@drag-over"),e.dataTransfer.dropEffect="move")}_dragLeave(e){let t=u.getElement(e.target,u);t?.getData("node")&&t.removeClass("@drag-over")}_drop(e){let t=u.getElement(e.target,u),i=t?.getData("node");if(i||(i=this.m_props.root),i){let s;i.children?s=i:s=t.getData("parent");for(let n=0;n<e.dataTransfer.items.length;n++)e.dataTransfer.items[0].getAsString(r=>{let a=JSON.parse(r);this.emit("drag",Bi(i,a,s))})}}render(){this.__update()}__update(){if(this.m_props.root){let e=[];this._buildBranch(this.m_props.root,-1,e,this.m_props.root),this.m_container.setContent(e)}}updateElement(e){let{node:t,item:i}=this._getNode(e);if(t){let s=t.dom.parentNode,n=this._makeNode(i,t.dom.classList.value,t.getData("icon"),t.getData("level")),r=n._build();s.replaceChild(r,t.dom),this.m_selection?.el===t&&(this.m_selection.el=n)}}set root(e){this.m_props.root=e,this.update()}openAll(e=!0){this.forEach(t=>{t.children&&(t.open=e)}),this.__update()}refreshRoot(e){let t=[];this.forEach(s=>(s.open&&t.push(s.id),!1));let i=this.selection;e&&(this.m_props.root=e),this.forEach(s=>(t.indexOf(s.id)>=0&&(s.open=!0),!1)),this.__update()}_buildBranch(e,t,i,s){let n="@tree-item";e.cls&&(n+=" "+e.cls),!e.open&&e.children&&(n+=" collapsed"),e.children&&(n+=" folder",e.children.length==0&&(n+=" empty"));let r=e.icon;if(r===void 0&&e.children&&(e.open===!0?r="var(--x4-icon-chevron-down)":r="var(--x4-icon-chevron-right)"),t>=0){let a=this._makeNode(e,n,r,t);this.m_selection?.id==e.id&&(this.m_selection.el=a,a.addClass("selected")),i.push(a)}(t==-1||e.open)&&e.children&&(this.m_props.sort&&(e.children=e.children.sort((a,h)=>{let m=(a.children?"0"+a.text:a.text)?.toLocaleLowerCase(),c=(h.children?"0"+h.text:h.text)?.toLocaleLowerCase();return m<c?-1:m>c?1:0})),e.children.forEach(a=>{this._buildBranch(a,t+1,i,e)}))}_renderDef(e){return new I({cls:"tree-label",flex:1,text:e.text})}_makeNode(e,t,i,s){return new w({cls:t,content:[new L({cls:"tree-icon",icon:i}),this.m_props.renderItem?this.m_props.renderItem(e):this._renderDef(e)],data:{node:e,level:s,icon:i},style:{paddingLeft:4+s*this.m_props.indent},attrs:{draggable:this.m_props.canDragItems?!0:void 0}})}forEach(e){let t=null;function i(s){if(e(s)==!0)return!0;if(s.children){for(let n=0;n<s.children.length;n++)if(i(s.children[n]))return!0}}return l(i,"scan"),this.m_props.root&&i(this.m_props.root),t}ensureVisible(e){let{node:t}=this._getNode(e);t&&t.scrollIntoView()}set selection(e){this.select(e,!1)}select(e,t=!0){if(this.m_selection?.el&&this.m_selection.el.removeClass("selected"),this.m_selection=null,e!==void 0){let{node:i}=this._getNode(e);if(i&&(this.m_selection={id:e,el:i},i.addClass("selected"),i.scrollIntoView(),t)){let s=i.getData("node");this.emit("selectionchange",ie(s))}}else t&&this.emit("selectionchange",ie(null))}_getNode(e){let t={node:null,item:null};return this.m_container.enumChilds(i=>{let s=i.getData("node");if(s?.id==e)return t={node:i,item:s},!0}),t}get selection(){return this.m_selection?.id}getNodeWithId(e){return this.forEach(t=>t.id==e)}_click(e){let t=e.target,i=t,s=!1;for(t.tabIndex!==-1&&(s=!0);t!=this.dom;){let n=u.getElement(t),r=n?.getData("node");if(r){if(r.children&&!s){(n.hasClass("selected")||i.classList.contains("tree-icon"))&&(r.open=!r.open),this.m_selection={id:r.id,el:null};let a=this.m_view?.dom?.scrollTop;this.update(),a&&this.m_view.dom.scrollTo(0,a),this.emit("expand",Kn(r))}else this.selection=r.id,s||(e.type=="click"?this.emit("click",ne(r)):this.emit("dblclick",ye(r)));this.emit("selectionchange",ie(r));return}t=t.parentElement}e.type=="click"&&(this.m_selection=null,this.update(),this.emit("selectionchange",ie(null)))}_handleCtxMenu(e){e.preventDefault();let t=e.target,i=t;for(;t!=this.dom;){let n=u.getElement(t)?.getData("node");if(n){if(n.children&&i.classList.contains("tree-icon"))return;this.selection=n.id,this.emit("click",ne(n)),this.emit("contextMenu",pe(e,n));return}t=t.parentElement}this.selection=null,this.emit("contextMenu",pe(e,null))}static buildFromStrings(e,t="/"){let i={id:0,text:"<root>",children:[]};function s(n,r){let a=r.indexOf(t),h=r.substr(0,a<0?void 0:a),m;a>=0&&(m=n.find(c=>c.text==h)),m||(m={id:r,text:h},n.push(m)),a>=0&&(m.children||(m.children=[]),s(m.children,r.substr(a+t.length)))}return l(s,"insert"),e.forEach(n=>{s(i.children,n)}),i}static buildFromHierarchy(e,t){let i={id:0,text:"<root>",children:[]},s=[];function n(r){let a,h;r.parent>0?(h=s.find(m=>m.id==r.parent),h||(h={id:r.parent,text:"",children:[]},s.push(h)),h.children||(h.children=[])):h=i,a=s.find(m=>m.id==r.id),a?(a.text=r.name,a.parent=r.parent):(a={id:r.id,text:r.name,parent:r.parent,cls:r.cls,icon:r.icon,data:r.data},r.leaf?a.icon=null:a.children=[]),s.push(a),h.children.push(a)}return l(n,"insert"),e.forEach(n),t&&s.forEach(t),i}};l(Si,"TreeView");var Gn=l((o,e,...t)=>{let i;return o==Ps||o==Ds?t:(o instanceof Function?i=new o(e):i=new u({tag:o,...e}),t&&t.length&&i.setContent(t),i)},"createElement"),Ds=Symbol("fragment"),Ps=l(()=>null,"createFragment"),$n={createElement:Gn,createFragment:Ps,Fragment:Ds},Ai=class extends u{render(e){let t=this.renderTSX(e);t&&this.setContent(t)}};l(Ai,"TSXComponent");var Ms=Symbol("msg_sent");function qn(o){let e=window.location.protocol==="https:"?"wss://":"ws://",t=new WebSocket(`${e}${window.location.hostname}:${window.location.port}`,"messaging"),i=xe.instance();i.on("global",s=>{s[Ms]||t.send(JSON.stringify({msg:s.msg,params:s.params}))}),t.onmessage=s=>{if(s.data!="ping"){let n=JSON.parse(s.data);n[Ms]=!0,i.signal("global",n)}},t.onclose=s=>{console.log("websocket closed:",s),o()},t.onerror=s=>{console.log("websocket error:",s)}}l(qn,"setupWSMessaging");var Yn="1.5.36";
/**
*  ___   ___ __
*  \  \_/  /  / _
*   \     /  /_| |_
*   /  _  \____   _|  
*  /__/ \__\   |_|
*        
* @file md5.ts
* @author Etienne Cochard 
* @license
*
* Copyright (c) 2019-2022 R-libre ingenierie
*
* Permission is hereby granted, free of charge, to any person obtaining a copy 
* of this software and associated documentation files (the "Software"), to deal 
* in the Software without restriction, including without limitation the rights 
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
* of the Software, and to permit persons to whom the Software is furnished to do so, 
* subject to the following conditions:
* The above copyright notice and this permission notice shall be included in all copies
* or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
* INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
* PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
**/
//# sourceMappingURL=index.js.map
